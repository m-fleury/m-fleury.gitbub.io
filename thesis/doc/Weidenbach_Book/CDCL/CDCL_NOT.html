<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory CDCL_NOT (Isabelle2019: June 2019)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory CDCL_NOT</h1>

<span class="command">theory</span> <span class="name">CDCL_NOT</span><br/>
<span class="keyword">imports</span> <a href="Wellfounded_More.html"><span class="name">Wellfounded_More</span></a> <a href="Partial_Annotated_Herbrand_Interpretation.html"><span class="name">Partial_Annotated_Herbrand_Interpretation</span></a> <a href="CDCL_WNOT_Measure.html"><span class="name">CDCL_WNOT_Measure</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">theory</span></span><span> </span><span>CDCL_NOT</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span>
</span><span>  </span><span>Weidenbach_Book_Base.WB_List_More</span><span>
</span><span>  </span><span>Weidenbach_Book_Base.Wellfounded_More</span><span>
</span><span>  </span><span>Entailment_Definition.Partial_Annotated_Herbrand_Interpretation</span><span>
</span><span>  </span><span>CDCL_WNOT_Measure</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;NOT&#39;s CDCL&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Auxiliary Lemmas and Measure&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;We define here some more simplification rules, or rules that have been useful as help
  for some tactic&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>atms_of_uminus_lit_atm_of_lit_of</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of {# -lit_of x. x &#8712;# A#} = atm_of ` (lit_of ` (set_mset A))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>atms_of_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Fun.image_comp</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>atms_of_ms_single_image_atm_of_lit_of</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_ms (unmark_s A) = atm_of ` (lit_of ` A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>atms_of_ms_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Initial Definitions&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;The State&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;We define here an abstraction over operation on the state we are manipulating.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>dpll_state_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>state<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lit list &#215; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;state<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8801; (trail S, clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;NOT&#39;s state is basically a pair composed of the trail (i.e.\ the candidate model) and the
  set of clauses. We abstract this state to convert this state to other states. like Weidenbach&#39;s
  five-tuple.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>dpll_state</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>dpll_state_ops</span><span>
</span><span>    </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="comment">&#8213; &#8249;related to the state&#8250;</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>prepend_trail<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;state<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (prepend_trail L st) = (L # trail st, clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> st)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;state<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (tl_trail st) = (tl (trail st), clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> st)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;state<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C st) = (trail st, add_mset C (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> st))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;state<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C st) = (trail st, removeAll_mset C (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> st))&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span>
</span><span>  </span><span>trail_prepend_trail</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (prepend_trail L st) = L # trail st&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>trail_tl_trail<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (tl_trail st) = tl (trail st)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>trail_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C st) = trail st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>trail_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C st) = trail st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>
</span><span>  </span><span>clauses_prepend_trail</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (prepend_trail L st) = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> st&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>clauses_tl_trail</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (tl_trail st) = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>clauses_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C st) = add_mset C (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> st)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>clauses_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C st) = removeAll_mset C (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> st)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prepend_trail<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span>L</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>tl_trail<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span>C</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span>C</span><span> </span><span>st</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;state<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> st&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;We define the following function doing the backtrack in the trail:&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">function</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;a list &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S =
  (if length (trail S) = length F &#8744; trail S = [] then S else reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (tl_trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">termination</span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>relation</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;measure (&#955;(_, S). length (trail S))&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span class="delimiter">[</span><span>simp</span><span> </span><span>del</span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Then we need several lemmas about the @{term reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>}.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_Nil</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = [] &#10233; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S = S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_eq_length</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail S) = length F &#10233; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S = S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_length_ne</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail S) &#8800; length F &#10233; trail S &#8800; [] &#10233;
    reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S = reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (tl_trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>trail_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_length_le</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length F &gt; length (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S) = []&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>F</span><span> </span><span>S</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>less_imp_diff_less</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>trail_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_Nil</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> [] S) = []&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;[]&#8250;</span></span></span><span> </span><span>S</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>less_imp_diff_less</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>clauses_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_Nil</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> [] S) = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;[]&#8250;</span></span></span><span> </span><span>S</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>less_imp_diff_less</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>trail_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_drop</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S) =
    (if length (trail S) &#8805; length F
    then drop (length (trail S) - length F) (trail S)
    else [])&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>F</span><span> </span><span>S</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rename_tac</span><span> </span><span>F</span><span> </span><span>S</span><span class="delimiter">,</span><span> </span><span>case_tac</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rename_tac</span><span> </span><span>list</span><span class="delimiter">,</span><span> </span><span>case_tac</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Suc (length list) &gt; length F&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span> </span><span>2</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subgoal_tac</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Suc (length list) - length F = Suc (length list - length F)&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_skip_beginning</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ F&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S) = F&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>trail_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_drop</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S) = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>F</span><span> </span><span>S</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>less_imp_diff_less</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>trail_eq_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_eq</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = trail T &#10233; trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S) = trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>F</span><span> </span><span>S</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>T</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>trail_tl_trail<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_eq_length</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_length_ne</span><span>
</span><span>    </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_Nil</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>trail_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S) &#10233;
    trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S)) = trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>trail_eq_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_eq</span><span class="delimiter">)</span><span> </span><span>simp</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail_tl_trail_decomp</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ Decided K # F &#10233;
     trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (tl_trail S)) = F&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_skip_beginning</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl (F&#39; @ Decided K # [])&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>F&#39;</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>tl_append</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_skip_beginning</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_length</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length M = length M&#39; &#10233; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> M S = reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> M&#39; S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>M</span><span> </span><span>S</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>trail_weight</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail_weight S &#8801; map ((&#955;l. 1 + length l) o snd) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;As we are defining abstract states, the Isabelle equality about them is too strong: we want
  the weaker equivalence stating that two states are equal if they cannot be distinguished, i.e.\
  given the getter @{term trail} and @{term clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>} do not distinguish them.&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">infix</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8764;&quot;</span></span></span><span> </span><span>50</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;S &#8764; T &#10231; trail S = trail T &#8743; clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_ref</span><span class="delimiter">[</span><span>intro</span><span class="delimiter">,</span><span> </span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;S &#8764; S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_sym</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;S &#8764; T &#10231; T &#8764; S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trans</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;S &#8764; T &#10233; T &#8764; U &#10233; S &#8764; U&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;S &#8764; T &#10233; trail S = trail T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;S &#8764; T &#10233; clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>state_simp<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span> </span><span class="delimiter">=</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_compatible</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ST</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;S &#8764; T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F T&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S) = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ST</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S) = trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>trail_eq_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_eq</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>F</span><span class="delimiter">]</span><span> </span><span>ST</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>state_simp<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment">&#8213; &#8249;End on locale @{locale dpll_state}.&#8250;</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Definition of the Transitions&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Each possible is in its own locale.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>propagate_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>dpll_state</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;add_mset L C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10233; trail S &#8872;as CNot C
    &#10233; undefined_lit (trail S) L
    &#10233; propagate_conds (Propagated L ()) S T
    &#10233; T &#8764; prepend_trail (Propagated L ()) S
    &#10233; propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>decide_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>dpll_state</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit (trail S) L &#10233;
  atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#10233;
  T &#8764; prepend_trail (Decided L) S &#10233;
  decide_conds S T &#10233;
  decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39;&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>backjumping_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>dpll_state</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>backjump_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>backjump</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ Decided K # F
   &#10233; T &#8764; prepend_trail (Propagated L ()) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S)
   &#10233; C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S
   &#10233; trail S &#8872;as CNot C
   &#10233; undefined_lit F L
   &#10233; atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))
   &#10233; clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm add_mset L C&#39;
   &#10233; F &#8872;as CNot C&#39;
   &#10233; backjump_conds C C&#39; L S T
   &#10233; backjump S T&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>backjumpE</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump S T&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;The condition @{term &#8249;atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;}
  is not implied by the the condition @{term &#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm add_mset L C&#39;&#8250;} (no negation).&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;DPLL with Backjumping&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>dpll_with_backjumping_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>propagate_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>propagate_conds</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>decide_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>decide_conds</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>backjumping_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>backjump_conds</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>backjump_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>bj_can_jump</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;S C F&#39; K F L.
        inv S &#10233;
        trail S = F&#39; @ Decided K # F &#10233;
        C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10233;
        trail S &#8872;as CNot C &#10233;
        undefined_lit F L &#10233;
        atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (F&#39; @ Decided K # F)) &#10233;
        clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm add_mset L C&#39; &#10233;
        F &#8872;as CNot C&#39; &#10233;
        &#172;no_step backjump S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>can_propagate_or_decide_or_backjump</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#10233;
      undefined_lit (trail S) L &#10233;
      satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)) &#10233;
      inv S &#10233;
      no_dup (trail S) &#10233;
      &#8707;T. decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8744; propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8744; backjump S T&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;We cannot add a like condition @{term &#8249;atms_of C&#39; &#8838; atms_of_ms N&#8250;} to ensure that we
  can backjump even if the last decision variable has disappeared from the set of clauses.

  The part of the condition @{term &#8249;atm_of L &#8712; atm_of ` (lits_of_l (F&#39; @ Decided K # F))&#8250;} is
  important, otherwise you are not sure that you can backtrack.&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Definition&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;We define dpll with backjumping:&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>dpll_bj</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>S</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;st</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>bj_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39; &#10233; dpll_bj S S&#39;&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>bj_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39; &#10233; dpll_bj S S&#39;&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>bj_backjump</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump S S&#39; &#10233; dpll_bj S S&#39;&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>dpll_bj_induct</span><span> </span><span class="delimiter">=</span><span> </span><span>dpll_bj.induct</span><span class="delimiter">[</span><span>split_format</span><span class="delimiter">(</span><span>complete</span><span class="delimiter">)</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">thm</span></span><span> </span><span>dpll_bj_induct</span><span class="delimiter">[</span><span>OF</span><span> </span><span>dpll_with_backjumping_ops_axioms</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_all_induct</span><span class="delimiter">[</span><span>consumes</span><span> </span><span>2</span><span class="delimiter">,</span><span> </span><span>case_names</span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>backjump</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;L T. undefined_lit (trail S) L &#10233; atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)
      &#10233; T &#8764; prepend_trail (Decided L) S
      &#10233; P S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;C L T. add_mset L C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10233; trail S &#8872;as CNot C &#10233; undefined_lit (trail S) L
      &#10233; T &#8764; prepend_trail (Propagated L ()) S
      &#10233; P S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;C F&#39; K F L C&#39; T. C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10233; F&#39; @ Decided K # F &#8872;as CNot C
      &#10233; trail S = F&#39; @ Decided K # F
      &#10233; undefined_lit F L
      &#10233; atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (F&#39; @ Decided K # F))
      &#10233; clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm add_mset L C&#39;
      &#10233; F &#8872;as CNot C&#39;
      &#10233; T &#8764; prepend_trail (Propagated L ()) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S)
      &#10233; P S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;P S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>T</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>dpll_bj_induct</span><span class="delimiter">[</span><span>OF</span><span> </span><span>local.dpll_with_backjumping_ops_axioms</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>backjumpE</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Basic properties&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;First, some better suited induction principle&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_clauses</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;No duplicates in the trail&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_no_dup</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>defined_lit_map</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_skip_beginning</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>no_dup_appendD</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Valuations&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_sat_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I &#8872;sm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Clauses&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_atms_of_ms_clauses_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) = atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_atms_in_trail</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail S)) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>in_plus_implies_atm_of_on_atms_of_ms</span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_skip_beginning</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>in_plus_implies_atm_of_on_atms_of_ms</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_all_decomposition_implies_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>2</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span>dpll_bj_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>decomp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>C</span><span> </span><span>L</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>propa</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>undef</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?M&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (prepend_trail (Propagated L ()) S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?N</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>y</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ay</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition ?M&#39; = (a, y) # l&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition ?M&#39;&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>fastforce</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>M&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M&#39; = y @ a&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_all_ann_decomposition_decomp</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?M&#39;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition (trail S) = (a, tl y) # l&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ay</span><span> </span><span>undef</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249; get_all_ann_decomposition (trail S)&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>y<span class="hidden">&#8681;</span><sub>0</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;y = (Propagated L ()) # (tl y)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ay</span><span> </span><span>undef</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>M</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>arg_cong</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>set</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>y</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set y = insert (Propagated L ()) (set (tl y))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tr_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = tl y @ a&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>arg_cong</span><span class="delimiter">[</span><span>OF</span><span> </span><span>M&#39;</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>tl</span><span class="delimiter">]</span><span> </span><span>y<span class="hidden">&#8681;</span><sub>0</sub></span><span> </span><span>M</span><span> </span><span>get_all_ann_decomposition_decomp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a_Un_N_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset ?N &#8872;ps unmark_l (tl y)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>decomp</span><span> </span><span>ay</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>all_decomposition_implies_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>M</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset ?N &#8872;p {#L#}&#8250;</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8872;p _&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>true_clss_cls_plus_CNot</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8872;p add_mset L C&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>propa</span><span> </span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.prems</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>true_clss_clss_in_imp_true_clss_cls</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l ?M&#39; &#8872;ps CNot C&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span>undef</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>true_annots_true_clss_clss</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; unmark_l (tl y) &#8872;ps CNot C&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>tr_S</span><span> </span><span>true_annots_true_clss_clss</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>image_Un</span><span> </span><span>sup_commute</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;ps unmark_l a &#8746; unmark_l (tl y)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a_Un_N_M</span><span> </span><span>true_clss_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;ps CNot C&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>true_clss_clss_left_right</span><span> </span><span>true_clss_clss_union_and</span><span>
</span><span>          </span><span>true_clss_clss_union_l_r</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset ?N &#8872;ps unmark_l ?M&#39;&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>all_in_true_clss_clss</span><span> </span><span>image_Un</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>decomp</span><span> </span><span>T</span><span> </span><span>M</span><span> </span><span>undef</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>ay</span><span> </span><span>all_decomposition_implies_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ay</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>backjump</span><span> </span><span>C</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>L</span><span> </span><span>D</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>confl</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>tr</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>undef</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>L</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>N_C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>vars_D</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition F)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>decomp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>tr</span><span> </span><span>all_decomposition_implies_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>get_all_ann_decomposition.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>      </span><span>get_all_ann_decomposition_never_empty</span><span> </span><span>hd_Cons_tl</span><span> </span><span>insert_iff</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>list.set</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>      </span><span>tl_get_all_ann_decomposition_skip_some</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>li</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>F</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition F = (a, b) # li&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition F&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F = b @ a&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_all_ann_decomposition_decomp</span><span class="delimiter">[</span><span>of</span><span> </span><span>F</span><span> </span><span>a</span><span> </span><span>b</span><span class="delimiter">]</span><span> </span><span>F</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a_N_b</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;ps unmark_l b&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>decomp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>all_decomposition_implies_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>F</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F_D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l F &#8872;ps CNot D&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot D&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>true_annots_true_clss_clss</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; unmark_l b &#8872;ps CNot D&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F = b @ a&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>image_Un</span><span> </span><span>sup.commute</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a_N_CNot_D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;ps CNot D &#8746; unmark_l b&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>true_clss_clss_left_right</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a_N_b</span><span> </span><span>F_D</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F = b @ a&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>image_Un</span><span> </span><span>ac_simps</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a_N_D_L</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;p add_mset L D&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>N_C</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;p {#L#}&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a_N_D_L</span><span> </span><span>a_N_CNot_D</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>blast</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>true_clss_cls_plus_CNot</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>decomp</span><span> </span><span>T</span><span> </span><span>tr</span><span> </span><span>undef</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>all_decomposition_implies_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>F</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Termination&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Using a proper measure&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>length_get_all_ann_decomposition_append_Decided</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (get_all_ann_decomposition (F&#39; @ Decided K # F)) =
    length (get_all_ann_decomposition F&#39;)
    + length (get_all_ann_decomposition (Decided K # F))
    - 1&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>F&#39;</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>ann_lit_list_induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>take_length_get_all_ann_decomposition_decided_sandwich</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;take (length (get_all_ann_decomposition F))
      (map (f o snd) (rev (get_all_ann_decomposition (F&#39; @ Decided K # F))))
      =
     map (f o snd) (rev (get_all_ann_decomposition F))
    &#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>F&#39;</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>ann_lit_list_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Decided</span><span> </span><span>K</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>length_get_all_ann_decomposition_append_Decided</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Propagated</span><span> </span><span>L</span><span> </span><span>m</span><span> </span><span>F&#39;</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>F&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition (F&#39; @ Decided K # F) = (a, b) # l&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition (F&#39; @ Decided K # F)&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (get_all_ann_decomposition F) - length l = 0&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>length_get_all_ann_decomposition_append_Decided</span><span class="delimiter">[</span><span>of</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>F&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition F&#39;&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>F&#39;</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>length_get_all_ann_decomposition_length</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (get_all_ann_decomposition M) &#8804; 1 + length M&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>M</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>ann_lit_list_induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>length_in_get_all_ann_decomposition_bounded</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i &#8712; set (trail_weight S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i &#8804; Suc (length (trail S))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(a, b) &#8712; set (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>ib</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i = Suc (length b)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = c @ b @ a&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_all_ann_decomposition_exists_prepend&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>arg_cong</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>length</span><span class="delimiter">]</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i</span><span> </span><span>ib</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Well-foundedness&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;The bounds are the following:
  &#9642; @{term &#8249;1+card (atms_of_ms A)&#8250;}: @{term &#8249;card (atms_of_ms A)&#8250;} is an upper bound on the length
  of the list. As @{term get_all_ann_decomposition} appends an possibly empty couple at the end,
  adding one is needed.
  &#9642; @{term &#8249;2+card (atms_of_ms A)&#8250;}: @{term &#8249;card (atms_of_ms A)&#8250;} is an upper bound on the number
  of elements, where adding one is necessary for the same reason as for the bound on the list, and
  one is needed to have a strict bound.
  &#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>unassigned_lit</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;b clause set &#8658; &#39;a list &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unassigned_lit N M &#8801; card (atms_of_ms N) - length M&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_trail_mes_increasing_prop</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>M</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lits &#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>N</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clauses&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>NA</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>MA</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight T)
    &gt; &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>2</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>C</span><span> </span><span>L</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>CLN</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>MC</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>undef_L</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>incl</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (Propagated L () # trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span> </span><span>bj_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>NA</span><span> </span><span>MA</span><span> </span><span>CLN</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>in_plus_implies_atm_of_on_atms_of_ms</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>no_dup</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (Propagated L () # trail S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>defined_lit_map</span><span> </span><span>n_d</span><span> </span><span>undef_L</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition (trail S) = (a, b) # l&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition (trail S)&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b_le_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length b &#8804; length (trail S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_all_ann_decomposition_decomp</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>M</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (atms_of_ms A)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (Propagated L () # trail S) &#8804; card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>incl</span><span> </span><span>finite</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>no_dup_length_eq_card_atm_of_lits_of_l</span><span class="delimiter">[</span><span>OF</span><span> </span><span>no_dup</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>card_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>latm</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unassigned_lit A b = Suc (unassigned_lit A (Propagated L () # b))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b_le_M</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>undef_L</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>latm</span><span> </span><span>M</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>_cons</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>L</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>undef_L</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>MC</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>incl</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (Decided L # (trail S)) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span> </span><span>bj_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>OF</span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span class="delimiter">]</span><span> </span><span>NA</span><span> </span><span>MA</span><span> </span><span>MC</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>no_dup</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (Decided L # (trail S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>defined_lit_map</span><span> </span><span>n_d</span><span> </span><span>undef_L</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition (trail S) = (a, b) # l&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition (trail S)&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (Decided L # (trail S)) &#8804; card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>incl</span><span> </span><span>finite</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>no_dup_length_eq_card_atm_of_lits_of_l</span><span class="delimiter">[</span><span>OF</span><span> </span><span>no_dup</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>card_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>undef_L</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>_cons</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>backjump</span><span> </span><span>C</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>L</span><span> </span><span>C&#39;</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>undef_L</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>MC</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>tr_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>L</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>incl</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (Propagated L () # F) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span> </span><span>NA</span><span> </span><span>MA</span><span> </span><span>L</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tr_S</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>no_dup</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (Propagated L () # F)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>defined_lit_map</span><span> </span><span>n_d</span><span> </span><span>undef_L</span><span> </span><span>tr_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>no_dup_appendD</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition (trail S) = (a, b) # l&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition (trail S)&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b_le_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length b &#8804; length (trail S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_all_ann_decomposition_decomp</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>M</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fin_atms_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (atms_of_ms A)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>F_le_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (Propagated L () # F) &#8804; card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>incl</span><span> </span><span>finite</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>no_dup_length_eq_card_atm_of_lits_of_l</span><span class="delimiter">[</span><span>OF</span><span> </span><span>no_dup</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>card_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tr_S_le_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail S) &#8804; card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>n_d</span><span> </span><span>MA</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fin_atms_A</span><span> </span><span>card_mono</span><span> </span><span>no_dup_length_eq_card_atm_of_lits_of_l</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>F</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition F = (a, b) # l&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_all_ann_decomposition F&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F = b @ a&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_all_ann_decomposition_decomp</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Propagated L () # F&#8250;</span></span></span><span> </span><span>a</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Propagated L () # b&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>latm</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unassigned_lit A b = Suc (unassigned_lit A (Propagated L () # b))&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_le_A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>rem</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>rem</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;map (&#955;a. Suc (length (snd a))) (rev (get_all_ann_decomposition (F&#39; @ Decided K # F)))
    = map (&#955;a. Suc (length (snd a))) (rev (get_all_ann_decomposition F)) @ rem&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>take_length_get_all_ann_decomposition_decided_sandwich</span><span class="delimiter">[</span><span>of</span><span> </span><span>F</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;a. Suc (length a)&#8250;</span></span></span><span> </span><span>F&#39;</span><span> </span><span>K</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>o_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_take_drop_id</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>rem</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;map (&#955;a. Suc (length (snd a)))
      (get_all_ann_decomposition (F&#39; @ Decided K # F))
    = rev rem @ map (&#955;a. Suc (length (snd a))) ((get_all_ann_decomposition F))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rev_map</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>rev_swap</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (rev rem @ map (&#955;a. Suc (length (snd a))) (get_all_ann_decomposition F))
          &#8804; Suc (card (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>arg_cong</span><span class="delimiter">[</span><span>OF</span><span> </span><span>rem</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>length</span><span class="delimiter">]</span><span> </span><span>tr_S_le_A</span><span>
</span><span>    </span><span>length_get_all_ann_decomposition_length</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F&#39; @ Decided K # F&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>tr_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span class="delimiter">::</span><span> </span><span>nat</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xs</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;a list&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i &lt; length xs &#10233; length xs - Suc i &lt; length xs&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i&lt;length xs &#10233; rev xs ! i &#8712; set xs&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rev_nth</span><span class="delimiter">[</span><span>of</span><span> </span><span>i</span><span> </span><span>xs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>in_set_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>in_set_conv_nth</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>H</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;i&lt;length rem. rev rem ! i &lt; card (atms_of_ms A) + 2&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tr_S_le_A</span><span> </span><span>length_in_get_all_ann_decomposition_bounded</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>S</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>tr_S</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>o_def</span><span> </span><span>rem</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>H</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>length_get_all_ann_decomposition_length</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>_bounded</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;rev rem&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (atms_of_ms A)+2&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unassigned_lit A l&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>T</span><span> </span><span>undef_L</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rem</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>_append</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>_cons</span><span> </span><span>F</span><span> </span><span>tr_S</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_trail_mes_decreasing_prop</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>dpll</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>N_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>M_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>nd</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>fin_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))
               - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight T)
            &lt; (2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))
               - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight S)&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?b</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;2+card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?s</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;1+card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?&#956;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>M&#39;_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>M_A</span><span> </span><span>N_A</span><span> </span><span>dpll</span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span> </span><span>inv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>nd&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span>dpll_bj_no_dup</span><span> </span><span>nd</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span class="delimiter">::</span><span> </span><span>nat</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xs</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;a list&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i &lt; length xs &#10233; length xs - Suc i &lt; length xs&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i&lt;length xs &#10233; xs ! i &#8712; set xs&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rev_nth</span><span class="delimiter">[</span><span>of</span><span> </span><span>i</span><span> </span><span>xs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>in_set_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>in_set_conv_nth</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>H</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_M_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail S) &#8804; card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fin_A</span><span> </span><span>M_A</span><span> </span><span>card_mono</span><span> </span><span>no_dup_length_eq_card_atm_of_lits_of_l</span><span> </span><span>nd</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_M&#39;_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail T) &#8804; card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fin_A</span><span> </span><span>M&#39;_A</span><span> </span><span>card_mono</span><span> </span><span>no_dup_length_eq_card_atm_of_lits_of_l</span><span> </span><span>nd&#39;</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_trail_weight_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail_weight T) &#8804; 1+card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_M&#39;_A</span><span> </span><span>length_get_all_ann_decomposition_length</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail T&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bounded_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;i&lt;length (trail_weight T). (trail_weight T)! i &lt; card (atms_of_ms A) + 2&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>length_in_get_all_ann_decomposition_bounded</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>T</span><span class="delimiter">]</span><span> </span><span>l_M&#39;_A</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>H</span><span> </span><span>Nat.le_trans</span><span> </span><span>add_2_eq_Suc&#39;</span><span> </span><span>not_le</span><span> </span><span>not_less_eq_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>dpll_bj_trail_mes_increasing_prop</span><span class="delimiter">[</span><span>OF</span><span> </span><span>dpll</span><span> </span><span>inv</span><span> </span><span>N_A</span><span> </span><span>M_A</span><span> </span><span>nd</span><span> </span><span>fin_A</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b (trail_weight S) &lt; &#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b (trail_weight T)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>_bounded</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bounded_M</span><span> </span><span>l_trail_weight_M</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b (trail_weight T) &#8804; ?b ^ ?s&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wf_dpll_bj</span><span class="delimiter">:</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete"><a id="wf_dpll_bj"></a></span></span></span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>fin</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S). dpll_bj S T
    &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A
    &#8743; no_dup (trail S) &#8743; inv S}&#8250;</span></span></span><span>
</span><span>  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf ?A&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wf_bounded_measure</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span>
</span><span>        </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;_. (2 + card (atms_of_ms A))^(1 + card (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>        </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S. &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight S)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?b</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;2+card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?s</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;1+card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?&#956;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ab</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(b, a) &#8712; ?A&#8250;</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fin_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fin</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span>dpll_bj</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj a b&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>N_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> a) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>M_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail a) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>nd</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail a)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv a&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ab</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>M&#39;_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail b) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>M_A</span><span> </span><span>N_A</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj a b&#8250;</span></span></span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span> </span><span>inv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>nd&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail b)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj a b&#8250;</span></span></span><span> </span><span>dpll_bj_no_dup</span><span> </span><span>nd</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span class="delimiter">::</span><span> </span><span>nat</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xs</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;a list&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i &lt; length xs &#10233; length xs - Suc i &lt; length xs&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i&lt;length xs &#10233; xs ! i &#8712; set xs&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rev_nth</span><span class="delimiter">[</span><span>of</span><span> </span><span>i</span><span> </span><span>xs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>in_set_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>in_set_conv_nth</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>H</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_M_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail a) &#8804; card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fin_A</span><span> </span><span>M_A</span><span> </span><span>card_mono</span><span> </span><span>no_dup_length_eq_card_atm_of_lits_of_l</span><span> </span><span>nd</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_M&#39;_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail b) &#8804; card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fin_A</span><span> </span><span>M&#39;_A</span><span> </span><span>card_mono</span><span> </span><span>no_dup_length_eq_card_atm_of_lits_of_l</span><span> </span><span>nd&#39;</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_trail_weight_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail_weight b) &#8804; 1+card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_M&#39;_A</span><span> </span><span>length_get_all_ann_decomposition_length</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail b&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bounded_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;i&lt;length (trail_weight b). (trail_weight b)! i &lt; card (atms_of_ms A) + 2&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>length_in_get_all_ann_decomposition_bounded</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>b</span><span class="delimiter">]</span><span> </span><span>l_M&#39;_A</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Nat.le_trans</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>add.right_neutral</span><span> </span><span>add_Suc_right</span><span>
</span><span>      </span><span>le_imp_less_Suc</span><span> </span><span>less_eq_Suc_le</span><span> </span><span>nth_mem</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>dpll_bj_trail_mes_increasing_prop</span><span class="delimiter">[</span><span>OF</span><span> </span><span>dpll_bj</span><span> </span><span>inv</span><span> </span><span>N_A</span><span> </span><span>M_A</span><span> </span><span>nd</span><span> </span><span>fin</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b (trail_weight a) &lt; &#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b (trail_weight b)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>_bounded</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bounded_M</span><span> </span><span>l_trail_weight_M</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b (trail_weight b) &#8804; ?b ^ ?s&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?b ^ ?s &#8804; ?b ^ ?s &#8743;
           &#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b (trail_weight b) &#8804; ?b ^ ?s &#8743;
           &#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b (trail_weight a) &lt; &#956;<span class="hidden">&#8681;</span><sub>C</sub> ?s ?b (trail_weight b)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Alternative termination proof&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>DPLL_mes<span class="hidden">&#8681;</span><sub>W</sub></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;DPLL_mes<span class="hidden">&#8681;</span><sub>W</sub> A M &#8801;
    map (&#955;L. if is_decided L then 2::nat else 1) (rev M) @ replicate (card A - length M) 3&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>distinctcard_atm_of_lit_of_eq_length</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;no_dup S&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;card (atm_of ` lits_of_l S) = length S&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>S</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>image_image</span><span> </span><span>lits_of_def</span><span> </span><span>no_dup_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_trail_mes_decreasing_less_than</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>dpll</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>N_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>M_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>nd</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(DPLL_mes<span class="hidden">&#8681;</span><sub>W</sub> (atms_of_ms A) (trail T), DPLL_mes<span class="hidden">&#8681;</span><sub>W</sub> (atms_of_ms A) (trail S)) &#8712;
    lexn less_than (card ((atms_of_ms A)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>2</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>L</span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">define</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;n = card (atms_of_ms A) - card (atm_of ` lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (trail S) = card (atm_of ` lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>nd</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>no_dup_def</span><span> </span><span>lits_of_def</span><span> </span><span>image_image</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>distinct_card</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of L &#8713; atm_of ` lits_of_l (trail S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>defined_lit_map</span><span> </span><span>imageE</span><span> </span><span>in_lits_of_l_defined_litD</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (atms_of_ms A) &gt; card (atm_of ` lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>N_A</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of L &#8713; atm_of ` lits_of_l (trail S)&#8250;</span></span></span><span> </span><span>atms_of_ms_finite</span><span> </span><span>card_seteq</span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>        </span><span>M_A</span><span> </span><span>fin_A</span><span> </span><span>not_le</span><span> </span><span>subsetCE</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span>n_0</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;n &gt; 0&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_Suc</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (atms_of_ms A) - Suc (card (atm_of ` lits_of_l (trail S))) = n - 1&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>n_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fin_A</span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>n_0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail</span><span class="delimiter">[</span><span>OF</span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>n</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>prepend_same_lexn</span><span> </span><span>n_def</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>n_Suc</span><span> </span><span>lexn_Suc</span><span>
</span><span>        </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>state_simp<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>lexn.simps</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>C</span><span> </span><span>L</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>undef</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (atms_of_ms A) &gt; length (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;atm_of L &#8712; atms_of_ms A&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>N_A</span><span> </span><span>C</span><span> </span><span>in_m_in_literals</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;undefined_lit (trail S) (- L)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>undef</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f7</span><span> </span><span>nd</span><span> </span><span>fin_A</span><span> </span><span>M_A</span><span> </span><span>undef</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>atm_of_in_atm_of_set_in_uminus</span><span> </span><span>atms_of_ms_finite</span><span>
</span><span>          </span><span>card_seteq</span><span> </span><span>in_lits_of_l_defined_litD</span><span> </span><span>leI</span><span> </span><span>no_dup_length_eq_card_atm_of_lits_of_l</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fin_A</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail</span><span class="delimiter">[</span><span>OF</span><span> </span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (atms_of_ms A) - length (trail S)&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>prepend_same_lexn</span><span> </span><span>lexn_Suc</span><span>
</span><span>        </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>state_simp<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>lexn.simps</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>backjump</span><span> </span><span>C</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>L</span><span> </span><span>C&#39;</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>tr_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S) = F&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>tr_S</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup F&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>nd</span><span> </span><span>tr_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>no_dup_appendD</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>card_A_F</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (atms_of_ms A) &gt; length F&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>distinctcard_atm_of_lit_of_eq_length</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>card_mono</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>M_A</span><span class="delimiter">]</span><span> </span><span>fin_A</span><span> </span><span>nd</span><span> </span><span>tr_S</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (F&#39; @ F)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>nd</span><span> </span><span>tr_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>no_dup_appendD</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup F&#39;&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>asm</span><span class="delimiter">)</span><span> </span><span>no_dup_rev</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>nd</span><span> </span><span>tr_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>no_dup_appendD</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>card_A_F&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (atms_of_ms A) &gt; length F&#39; + length F&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>distinctcard_atm_of_lit_of_eq_length</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>card_mono</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>M_A</span><span class="delimiter">]</span><span> </span><span>fin_A</span><span> </span><span>nd</span><span> </span><span>tr_S</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>card_A_F</span><span> </span><span>card_A_F&#39;</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail</span><span class="delimiter">[</span><span>OF</span><span> </span><span>backjump</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (atms_of_ms A) - length F&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tr_S</span><span> </span><span>prepend_same_lexn</span><span> </span><span>lexn_Suc</span><span> </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>state_simp<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>lexn.simps</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>fin</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S). dpll_bj S T
    &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A
    &#8743; no_dup (trail S) &#8743; inv S}&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf ?A&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conj_commute</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj _ _&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wf_wf_if_measure&#39;</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S. DPLL_mes<span class="hidden">&#8681;</span><sub>W</sub> ((atms_of_ms A)) (trail S)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wf_lexn</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wf_less_than</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>dpll_bj_trail_mes_decreasing_less_than</span><span class="delimiter">;</span><span> </span><span>use</span><span> </span><span>fin</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>simp</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Normal Forms&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;
  We prove that given a normal form of DPLL, with some structural invariants, then either @{term N}
  is satisfiable and the built valuation @{term M} is a model; or @{term N} is unsatisfiable.

  Idea of the proof: We have to prove tat @{term &#8249;satisfiable N&#8250;}, @{term &#8249;&#172;M&#8872;as N&#8250;}
  and there is no remaining step is incompatible.
  &#9656; The @{term decide} rule tells us that every variable in @{term N} has a value.
  &#9656; The assumption @{term &#8249;&#172;M&#8872;as N&#8250;} implies that there is conflict.
  &#9656; There is at least one decision in the trail (otherwise, @{term M} would be a model of the set
    of clauses @{term N}).
  &#9656; Now if we build the clause with all the decision literals of the trail, we can apply the
  @{term backjump} rule.

  The assumption are saying that we have a finite upper bound @{term A} for the literals, that we
  cannot do any step @{term &#8249;no_step dpll_bj S&#8250;}&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>dpll_backjump_final_state</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>A</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_s</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step dpll_bj S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
    &#8744; (trail S &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?N</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?M</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">consider</span></span><span>
</span><span>      </span><span class="delimiter">(</span><span>sat</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;satisfiable ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M &#8872;as ?N&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">|</span><span> </span><span class="delimiter">(</span><span>sat&#39;</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;satisfiable ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?M &#8872;as ?N&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">|</span><span> </span><span class="delimiter">(</span><span>unsat</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable ?N&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>sat&#39;</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>sat</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>M</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>C</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;?M &#8872;a C&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>M</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_annots_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>I</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v literal set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>        </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;s ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>cons</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp I&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>tot</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m I ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>atm_I_N</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `I &#8838; atms_of_ms ?N&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sat</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>satisfiable_def_min</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?I</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8746; {P| P. P &#8712; lits_of_l ?M &#8743; atm_of P &#8713; atm_of ` I}&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?O</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{unmark L |L. is_decided L &#8743; L &#8712; set ?M &#8743; atm_of (lit_of L) &#8713; atms_of_ms ?N}&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cons_I&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp ?I&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cons</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup ?M&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>consistent_interp_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atm_of_in_atm_of_set_iff_in_set_or_uminus_in_set</span><span> </span><span>lits_of_def</span><span>
</span><span>          </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>no_dup_cannot_not_lit_and_uminus</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tot_I&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m ?I (?N &#8746; unmark_l ?M)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span>atm_I_N</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>total_over_m_def</span><span> </span><span>total_over_set_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>image_iff</span><span> </span><span>lits_of_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{P |P. P &#8712; lits_of_l ?M &#8743; atm_of P &#8713; atm_of ` I} &#8872;s ?O&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;s ?N&#8250;</span></span></span><span> </span><span>atm_I_N</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atm_of_eq_atm_of</span><span> </span><span>true_clss_def</span><span> </span><span>lits_of_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>I&#39;_N</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8872;s ?N &#8746; ?O&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;s ?N&#8250;</span></span></span><span> </span><span>true_clss_union_increase</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tot&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m ?I (?N&#8746;?O)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atm_I_N</span><span> </span><span>tot</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>total_over_m_def</span><span> </span><span>total_over_set_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lits_of_def</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>is_decided_ex_Decided</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>atms_N_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_ms ?N &#8838; atm_of ` lits_of_l ?M&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?thesis&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;v</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>          </span><span>l_N</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;l &#8712; atms_of_ms ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>l_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;l &#8713; atm_of ` lits_of_l ?M&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit ?M (Pos l)&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_M</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Decided_Propagated_in_iff_in_lits_of_l</span><span>
</span><span>              </span><span>atm_of_in_atm_of_set_iff_in_set_or_uminus_in_set</span><span> </span><span>literal.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_N</span><span> </span><span>n_s</span><span> </span><span>can_propagate_or_decide_or_backjump</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Pos l&#8250;</span></span></span><span> </span><span>S</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>sat</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>dpll_bj.intros</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M &#8872;as CNot C&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>all_variables_defined_not_imply_cnot</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; trail S &#8872;a C&#8250;</span></span></span><span>
</span><span>           </span><span>atms_N_M</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>atms_of_atms_of_ms_mono</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;l &#8712; set ?M. is_decided l&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?O</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{unmark L |L. is_decided L &#8743; L &#8712; set ?M &#8743; atm_of (lit_of L) &#8713; atms_of_ms ?N}&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#952;</span><span class="delimiter">[</span><span>iff</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;I. total_over_m I (?N &#8746; ?O &#8746; unmark_l ?M)
            &#10231; total_over_m I (?N &#8746;unmark_l ?M)&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>total_over_set_def</span><span> </span><span>total_over_m_def</span><span> </span><span>atms_of_ms_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?thesis&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{unmark L |L. is_decided L &#8743; L &#8712; set ?M}
            = {unmark L |L. is_decided L &#8743; L &#8712; set ?M &#8743; atm_of (lit_of L) &#8713; atms_of_ms ?N}&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?O &#8872;ps unmark_l ?M&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_decomposition_implies_propagated_lits_are_implied</span><span class="delimiter">[</span><span>OF</span><span> </span><span>decomp</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8872;s unmark_l ?M&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cons_I&#39;</span><span> </span><span>I&#39;_N</span><span> </span><span>tot_I&#39;</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8872;s ?N &#8746; ?O&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#952;</span><span> </span><span>true_clss_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lits_of_l ?M &#8838; ?I&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_def</span><span> </span><span>lits_of_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M &#8872;as ?N&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>I&#39;_N</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; ?N&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?M &#8872;a C&#8250;</span></span></span><span> </span><span>cons_I&#39;</span><span> </span><span>atms_N_M</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span>consistent_CNot_not</span><span> </span><span>rev_subsetD</span><span> </span><span>sup_ge1</span><span> </span><span>true_annot_def</span><span>
</span><span>              </span><span>true_annots_def</span><span> </span><span>true_cls_mono_set_mset_l</span><span> </span><span>true_clss_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>M</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>List.split_list_first_propE</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">]</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>K</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v literal&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>F</span><span> </span><span>F&#39;</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>        </span><span>M_K</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M = F&#39; @ Decided K # F&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>nm</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;f&#8712;set F&#39;. &#172;is_decided f&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>is_decided_ex_Decided</span><span> </span><span>old.unit.exhaust</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?K</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Decided K :: (&#39;v, unit) ann_lit&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?K &#8712; set ?M&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?C</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;image_mset lit_of {#L&#8712;#mset ?M. is_decided L &#8743; L&#8800;?K#} :: &#39;v clause&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?C&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (image_mset (&#955;L::&#39;v literal. {#L#}) (?C + unmark ?K))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; {unmark L |L. is_decided L &#8743; L &#8712; set ?M} &#8872;ps unmark_l ?M&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_decomposition_implies_propagated_lits_are_implied</span><span class="delimiter">[</span><span>OF</span><span> </span><span>decomp</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?C&#39; = {unmark L |L. is_decided L &#8743; L &#8712; set ?M}&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>standard</span><span> </span><span>force</span><span class="delimiter">+</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>N_C_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?C&#39; &#8872;ps unmark_l ?M&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>N_M_False</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; (&#955;L. unmark L) ` (set ?M) &#8872;ps {{#}}&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_clss_def</span><span> </span><span>true_annots_def</span><span> </span><span>Ball_def</span><span> </span><span>true_annot_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>allI</span><span> </span><span>impI</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>LL</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;v literal set&quot;</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>          </span><span>tot</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m LL (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; unmark_l (trail S) &#8746; {{#}})&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>cons</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp LL&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>LL</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;LL &#8872;s set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; unmark_l (trail S)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m LL (CNot C)&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span>insert_absorb</span><span> </span><span>tot</span><span> </span><span>total_over_m_CNot_toal_over_m</span><span>
</span><span>              </span><span>total_over_m_insert</span><span> </span><span>total_over_m_union</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;total_over_m LL (unmark_l (trail S) &#8746; CNot C)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;LL &#8872;s {{#}}&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span>cons</span><span> </span><span>LL</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span>consistent_CNot_not</span><span>
</span><span>                </span><span>true_annots_true_clss_clss</span><span> </span><span>true_clss_clss_def</span><span> </span><span>true_clss_def</span><span> </span><span>true_clss_union</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit F K&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup ?M&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>defined_lit_map</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?C&#39; &#8872;ps {{#}}&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?C&#39; &#8746; unmark_l ?M = ?N &#8746; unmark_l ?M&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>true_clss_clss_left_right</span><span class="delimiter">[</span><span>OF</span><span> </span><span>N_C_M</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{{#}}&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>N_M_False</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8872;p image_mset uminus ?C + {#-K#}&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_cls_def</span><span> </span><span>true_clss_clss_def</span><span> </span><span>total_over_m_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>allI</span><span> </span><span>impI</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>I</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>              </span><span>tot</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_set I (atms_of_ms (?N &#8746; {image_mset uminus ?C+ {#- K#}}))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>cons</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp I&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;s ?N&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(K &#8712; I &#8743; -K &#8713; I) &#8744; (-K &#8712; I &#8743; K &#8713; I)&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cons</span><span> </span><span>tot</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>consistent_interp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>K</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249; {a &#8712; set (trail S). is_decided a &#8743; a &#8800; Decided K} =
              set (trail S) &#8745; {L. is_decided L &#8743; L &#8800; Decided K}&#8250;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tot&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_set I
               (atm_of ` lit_of ` (set ?M &#8745; {L. is_decided L &#8743; L &#8800; Decided K}))&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atms_of_uminus_lit_atm_of_lit_of</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>                </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lit_of x &#8713; I&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; set ?M&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_decided x&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8800; Decided K&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Pos (atm_of (lit_of x)) &#8712; I &#8744; Neg (atm_of (lit_of x)) &#8712; I&#8250;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>a4</span><span> </span><span>tot&#39;</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>total_over_set_def</span><span> </span><span>atms_of_s_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f6</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Neg (atm_of (lit_of x)) = - Pos (atm_of (lit_of x))&#8250;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;- lit_of x &#8712; I&#8250;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f6</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>atm_of_in_atm_of_set_iff_in_set_or_uminus_in_set</span><span>
</span><span>                  </span><span>literal.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>H</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;I &#8872;s ?C&#39;&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?C&#39; &#8872;ps {{#}}&#8250;</span></span></span><span> </span><span>tot</span><span> </span><span>cons</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;s ?N&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_clss_def</span><span> </span><span>total_over_m_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atms_of_uminus_lit_atm_of_lit_of</span><span> </span><span>atms_of_ms_single_image_atm_of_lit_of</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872; image_mset uminus ?C + {#- K#}&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_def</span><span> </span><span>true_cls_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(K &#8712; I &#8743; -K &#8713; I) &#8744; (-K &#8712; I &#8743; K &#8713; I)&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>H</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot (image_mset uminus ?C)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>nm</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_annots_def</span><span> </span><span>CNot_def</span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lits_of_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj_can_jump</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>C</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;-K&#8250;</span></span></span><span>
</span><span>          </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;image_mset uminus (image_mset lit_of {# L :# mset ?M. is_decided L &#8743; L &#8800; Decided K#})&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C&#8712;?N&#8250;</span></span></span><span> </span><span>n_s</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M &#8872;as CNot C&#8250;</span></span></span><span> </span><span>bj_backjump</span><span> </span><span>inv</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span>sat</span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment">&#8213; &#8249;End of the locale @{locale dpll_with_backjumping_ops}.&#8250;</span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>dpll_with_backjumping</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>dpll_with_backjumping_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>inv</span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span>backjump_conds</span><span> </span><span>propagate_conds</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>backjump_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span>  </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>dpll_bj_inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;S T. dpll_bj S T &#10233; inv S &#10233; inv T&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_dpll_bj_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dpll_bj_no_dup</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>dpll_bj_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_dpll_bj_no_dup</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dpll_bj_no_dup</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>rtranclp_dpll_bj_inv</span><span> </span><span>dpll_bj_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_dpll_bj_atms_of_ms_clauses_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) = atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>rtranclp_dpll_bj_inv</span><span> </span><span>dpll_bj_atms_of_ms_clauses_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_dpll_bj_atms_in_trail</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail S)) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj_atms_in_trail</span><span> </span><span>dpll_bj_atms_of_ms_clauses_inv</span><span> </span><span>rtranclp_dpll_bj_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_dpll_bj_sat_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I &#8872;sm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>dpll_bj_sat_iff</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>rtranclp_dpll_bj_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_dpll_bj_atms_in_trail_in_set</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>rtranclp_dpll_bj_inv</span><span>
</span><span>    </span><span>simp</span><span class="delimiter">:</span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span> </span><span>rtranclp_dpll_bj_atms_of_ms_clauses_inv</span><span> </span><span>rtranclp_dpll_bj_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_dpll_bj_all_decomposition_implies_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_decomposition_implies_inv</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>rtranclp_dpll_bj_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_dpll_bj_inv_incl_dpll_bj_inv_trancl</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{(T, S). dpll_bj<span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T
    &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A
    &#8743; no_dup (trail S) &#8743; inv S}
     &#8838; {(T, S). dpll_bj S T &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A
        &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A &#8743; no_dup (trail S) &#8743; inv S}<span class="hidden">&#8679;</span><sup>+</sup>&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?A &#8838; ?B<span class="hidden">&#8679;</span><sup>+</sup>&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>standard</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>x_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; ?A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>S</span><span> </span><span>T</span><span class="delimiter">::</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>x</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x = (T, S)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>x</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>x_A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; ?B<span class="hidden">&#8679;</span><sup>+</sup>&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>x</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>tranclp_induct</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>step</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ST</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span>-</span><span>7</span><span class="delimiter">)</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>N_A</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>M_A</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>nd</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) = atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span> </span><span>rtranclp_dpll_bj_atms_of_ms_clauses_inv</span><span> </span><span>tranclp_into_rtranclp</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>local.step</span><span> </span><span>nd</span><span> </span><span>rtranclp_dpll_bj_no_dup</span><span> </span><span>tranclp_into_rtranclp</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>inv</span><span> </span><span>M_A</span><span> </span><span>N_A</span><span> </span><span>local.step</span><span> </span><span>rtranclp_dpll_bj_atms_in_trail_in_set</span><span>
</span><span>          </span><span>tranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>local.step</span><span> </span><span>rtranclp_dpll_bj_inv</span><span> </span><span>tranclp_into_rtranclp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(U, T) &#8712; ?B&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ST</span><span> </span><span>N_A</span><span> </span><span>M_A</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>trancl_into_trancl2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wf_tranclp_dpll_bj</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>fin</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S). dpll_bj<span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T
    &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A
    &#8743; no_dup (trail S) &#8743; inv S}&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>wf_trancl</span><span class="delimiter">[</span><span>OF</span><span> </span><span>wf_dpll_bj</span><span class="delimiter">[</span><span>OF</span><span> </span><span>fin</span><span class="delimiter">]</span><span class="delimiter">]</span><span> </span><span>rtranclp_dpll_bj_inv_incl_dpll_bj_inv_trancl</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wf_subset</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dpll_bj_sat_ext_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S T &#10233; inv S &#10233; I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dpll_bj_clauses</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_dpll_bj_sat_ext_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10233; inv S &#10233; I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rtranclp_dpll_bj_inv</span><span> </span><span>dpll_bj_sat_ext_iff</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>full_dpll_backjump_final_state</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>A</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>full</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
  &#8744; (trail T &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step dpll_bj T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_S</span><span> </span><span>inv</span><span> </span><span>rtranclp_dpll_bj_atms_of_ms_clauses_inv</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_S</span><span> </span><span>atms_trail</span><span> </span><span>inv</span><span> </span><span>rtranclp_dpll_bj_atms_in_trail_in_set</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>n_d</span><span> </span><span>inv</span><span> </span><span>rtranclp_dpll_bj_no_dup</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>rtranclp_dpll_bj_inv</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span>decomp</span><span> </span><span>rtranclp_dpll_bj_all_decomposition_implies_inv</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))
    &#8744; (trail T &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span> </span><span>dpll_backjump_final_state</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span>rtranclp_dpll_bj_sat_iff</span><span> </span><span>satisfiable_carac</span><span> </span><span>st</span><span> </span><span>true_annots_true_cls</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">corollary</span></span><span> </span><span>full_dpll_backjump_final_state_from_init_state</span><span class="delimiter">:</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete"><a id="full_dpll_backjump_final_state_from_init_state"></a></span></span></span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>A</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>full</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full dpll_bj S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = []&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S = N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset N) &#8744; (trail T &#8872;asm N &#8743; satisfiable (set_mset N))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>full_dpll_backjump_final_state</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset N&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tranclp_dpll_bj_trail_mes_decreasing_prop</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>dpll</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj<span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>N_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>M_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>fin_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))
               - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight T)
            &lt; (2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))
               - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>N_A</span><span> </span><span>M_A</span><span> </span><span>n_d</span><span> </span><span>dpll_bj_trail_mes_decreasing_prop</span><span> </span><span>fin_A</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>dpll</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) = atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_dpll_bj_atms_of_ms_clauses_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>dpll_bj_clauses</span><span> </span><span>dpll_bj_inv</span><span> </span><span>inv</span><span> </span><span>st</span><span>
</span><span>      </span><span>tranclpD</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>N_A&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>N_A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>M_A&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>M_A</span><span> </span><span>N_A</span><span> </span><span>inv</span><span> </span><span>rtranclp_dpll_bj_atms_in_trail_in_set</span><span> </span><span>st</span><span> </span><span>dpll</span><span>
</span><span>      </span><span>tranclp.r_into_trancl</span><span> </span><span>tranclp_into_rtranclp</span><span> </span><span>tranclp_trans</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>nd</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>rtranclp_dpll_bj_no_dup</span><span> </span><span>st</span><span> </span><span>tranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>dpll</span><span> </span><span>dpll_bj_inv</span><span> </span><span>inv</span><span> </span><span>rtranclp_dpll_bj_inv</span><span> </span><span>st</span><span> </span><span>tranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span>dpll_bj_trail_mes_decreasing_prop</span><span class="delimiter">[</span><span>of</span><span> </span><span>T</span><span> </span><span>U</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span>dpll</span><span> </span><span>fin_A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment">&#8213; &#8249;End of the locale @{locale dpll_with_backjumping}.&#8250;</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;CDCL&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;In this section we will now define the conflict driven clause learning above DPLL: we first
  introduce the rules learn and forget, and the add these rules to the DPLL calculus.&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Learn and Forget&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Learning adds a new clause where all the literals are already included in the clauses.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>learn_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>dpll_state</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>learn_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>learn</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_rule</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm C &#10233;
  atms_of C &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S)) &#10233;
  learn_conds C S &#10233;
  T &#8764; add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S &#10233;
  learn S T&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S T&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>learn_&#956;<span class="hidden">&#8681;</span><sub>C</sub>_stable</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub> A B (trail_weight S) = &#956;<span class="hidden">&#8681;</span><sub>C</sub> A B (trail_weight T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>elim</span><span class="delimiter">:</span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Forget removes an information that can be deduced from the context (e.g.\ redundant clauses,
  tautologies)&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>forget_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>dpll_state</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>forget_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;removeAll_mset C(clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;pm C &#10233;
  forget_conds C S &#10233;
  C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10233;
  T &#8764; remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S &#10233;

  forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>forget_&#956;<span class="hidden">&#8681;</span><sub>C</sub>_stable</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub> A B (trail_weight S) = &#956;<span class="hidden">&#8681;</span><sub>C</sub> A B (trail_weight T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>learn_and_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>learn_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>learn_conds</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>forget_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>forget_conds</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>learn_conds</span><span> </span><span>forget_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>learn_and_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>lf_learn</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S T &#10233; learn_and_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>lf_forget</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#10233; learn_and_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Definition of CDCL&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>conflict_driven_clause_learning_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>dpll_with_backjumping_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>    </span><span>inv</span><span> </span><span>decide_conds</span><span> </span><span>backjump_conds</span><span> </span><span>propagate_conds</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>learn_and_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>learn_conds</span><span>
</span><span>    </span><span>forget_conds</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>backjump_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>learn_conds</span><span> </span><span>forget_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>S</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;st</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>c_dpll_bj</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj S S&#39; &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39;&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>c_learn</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S S&#39; &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39;&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>c_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39; &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39;&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_induct</span><span class="delimiter">[</span><span>consumes</span><span> </span><span>1</span><span class="delimiter">,</span><span> </span><span>case_names</span><span> </span><span>dpll_bj</span><span> </span><span>learn</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>dpll</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;T. dpll_bj S T &#10233; P S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>learning</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;C T. clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm C &#10233;
      atms_of C &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S)) &#10233;
      T &#8764; add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S &#10233;
      P S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>forgetting</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;C T. removeAll_mset C (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;pm C &#10233;
      C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10233;
      T &#8764; remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S &#10233;
      P S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;P S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>assms</span><span class="delimiter">(</span><span>2</span><span class="delimiter">,</span><span> </span><span>3</span><span class="delimiter">,</span><span> </span><span>4</span><span class="delimiter">)</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_induct</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>dpll_bj_no_dup</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Consistency of the trail&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_consistent</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp (lits_of_l (trail T))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span>distinct_consistent_interp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;The subtle problem here is that tautologies can be removed, meaning that some variable can
  disappear of the problem. It is also means that some variable of the trail might not be present
  in the clauses anymore.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_atms_of_ms_clauses_decreasing</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>dpll_bj_atms_of_ms_clauses_inv</span><span> </span><span>set_mp</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atms_of_ms_def</span><span> </span><span>Union_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_atms_in_trail</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail S)) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_induct</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dpll_bj_atms_in_trail</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_atms_in_trail_in_set</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_induct</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span> </span><span>dpll_bj_atms_of_ms_clauses_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_decomposition_implies</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>2</span><span class="delimiter">,</span><span>3</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>dpll_bj</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj_all_decomposition_implies_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>learn</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>all_decomposition_implies_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>C</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>cls_C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>all_decomposition_implies_def</span><span> </span><span>Ball_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>allI</span><span class="delimiter">,</span><span> </span><span>clarify</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(a, b) &#8712; set (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;ps unmark_l b&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>decomp</span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>all_decomposition_implies_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S)&#8250;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8872;ps set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>clauses_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cls_C</span><span> </span><span>insert_Diff</span><span> </span><span>order_refl</span><span>
</span><span>          </span><span>set_mset_minus_replicate_mset</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>true_clss_clss_def</span><span> </span><span>true_clss_clss_insert</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unmark_l a &#8746; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)
        &#8872;ps unmark_l b&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>true_clss_clss_generalise_true_clss_clss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Extension of models&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bj_sat_ext_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>dpll_bj</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dpll_bj_clauses</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>learn</span><span> </span><span>C</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>J</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8838; J&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>tot</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m J (set_mset (add_mset C (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>cons</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp J&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;J &#8872;sm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_ext_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8872;pm C&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;J &#8872; C&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span>cons</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_cls_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;J &#8872;sm {#C#} + clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sextm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#10233; I &#8872;sext insert C (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_ext_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>standard</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>H</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Diff_insert_absorb</span><span> </span><span>insert_subset</span><span> </span><span>subsetI</span><span> </span><span>subset_antisym</span><span>
</span><span>      </span><span>true_clss_ext_decrease_right_remove_r</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>C</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>cls_C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>J</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sext set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) - {C}&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8838; J&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>tot</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m J (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>cons</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp J&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;J &#8872;s set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) - {C}&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_ext_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Diff_subset</span><span> </span><span>total_over_m_subset</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>cls_C</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;J &#8872; C&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span>cons</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_cls_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Un_commute</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>insert_Diff</span><span> </span><span>insert_is_Un</span><span> </span><span>order_refl</span><span>
</span><span>          </span><span>set_mset_minus_replicate_mset</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;J &#8872;sm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>insert_Diff_single</span><span> </span><span>true_clss_insert</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sext set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) - {C} &#10233; I &#8872;sextm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_ext_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>true_clss_ext_decrease_right_remove_r</span><span> </span><span>H</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment">&#8213; &#8249;End of the locale @{locale conflict_driven_clause_learning_ops}.&#8250;</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;CDCL with invariant&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>conflict_driven_clause_learning</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>conflict_driven_clause_learning_ops</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;S T. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#10233; inv S &#10233; inv T&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>dpll_with_backjumping</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>unfold_locales</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10233; inv S &#10233; inv T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail_clauses_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>cdcl</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_clauses_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; A &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_clauses_S</span><span> </span><span>atms_trail_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>st</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U) &#8838; A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_atms_of_ms_clauses_decreasing</span><span class="delimiter">[</span><span>OF</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span> </span><span>IH</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail U)) &#8838; A&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_atms_in_trail_in_set</span><span class="delimiter">[</span><span>OF</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>A</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>atms_trail_S</span><span> </span><span>atms_clauses_S</span><span> </span><span>IH</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_decomposition_implies</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_decomposition_implies</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bj_sat_ext_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bj_sat_ext_iff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A S &#10231; (finite A &#8743; inv S &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A
    &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A &#8743; no_dup (trail S))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail_clauses_bound</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* is the same as learn_and_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>learn_or_forget</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn_or_forget S T &#8801; learn S T &#8744; forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_learn_or_forget_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn_or_forget<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_mono</span><span class="delimiter">[</span><span>of</span><span> </span><span>learn_or_forget</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>blast</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.c_learn</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.c_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>learn_or_forget_dpll_&#956;<span class="hidden">&#8681;</span><sub>C</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>l_f</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn_or_forget<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>dpll</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj T U&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))
      - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight U)
    &lt; (2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))
      - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight S)&#8250;</span></span></span><span>
</span><span>     </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?&#956; U &lt; ?&#956; S&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?&#956; S = ?&#956; T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_f</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>T</span><span class="delimiter">]</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv_def</span><span> </span><span>inv</span><span>
</span><span>        </span><span>rtranclp_learn_or_forget_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>forget_&#956;<span class="hidden">&#8681;</span><sub>C</sub>_stable</span><span> </span><span>learn_&#956;<span class="hidden">&#8681;</span><sub>C</sub>_stable</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A T&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_learn_or_forget_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv</span><span> </span><span>l_f</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj_trail_mes_decreasing_prop</span><span class="delimiter">[</span><span>of</span><span> </span><span>T</span><span> </span><span>U</span><span> </span><span>A</span><span class="delimiter">,</span><span> </span><span>OF</span><span> </span><span>dpll</span><span class="delimiter">]</span><span> </span><span>finite</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>infinite_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_exists_learn_and_forget_infinite_chain</span><span class="delimiter">:</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* \htmlink{infinite_cdcl_NOT_exists_learn_and_forget_infinite_chain} *)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;i. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f(Suc i))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A (f 0)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;j. &#8704;i&#8805;j. learn_or_forget (f i) (f (Suc i))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))
    - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight (f 0))&#8250;</span></span></span><span>
</span><span>    </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>f</span><span>
</span><span>    </span><span>rule</span><span class="delimiter">:</span><span> </span><span>nat_less_induct_case</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>&#956;</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">consider</span></span><span>
</span><span>    </span><span class="delimiter">(</span><span>dpll_end</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;j. &#8704;i&#8805;j. learn_or_forget (f i) (f (Suc i))&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">|</span><span> </span><span class="delimiter">(</span><span>dpll_more</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;(&#8707;j. &#8704;i&#8805;j. learn_or_forget (f i) (f (Suc i)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>dpll_end</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>dpll_more</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;i. &#172; learn (f i) (f (Suc i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>      </span><span>i_learn_forget</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;learn (f i) (f (Suc i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;k&lt;i. learn_or_forget (f k) (f (Suc k))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i<span class="hidden">&#8681;</span><sub>0</sub></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; learn (f i<span class="hidden">&#8681;</span><sub>0</sub>) (f (Suc i<span class="hidden">&#8681;</span><sub>0</sub>)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i<span class="hidden">&#8681;</span><sub>0</sub>) (f (Suc i<span class="hidden">&#8681;</span><sub>0</sub>))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{i. i&#8804;i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; &#172; learn (f i) (f (Suc i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i))} &#8800; {}&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?I</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{i. i&#8804;i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; &#172; learn (f i) (f (Suc i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i))}&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?i</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Min ?I&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite ?I&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; learn (f ?i) (f (Suc ?i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f ?i) (f (Suc ?i))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Min_in</span><span class="delimiter">[</span><span>OF</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite ?I&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8800; {}&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;k&lt;?i. learn_or_forget (f k) (f (Suc k))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Min.coboundedI</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{i. i &#8804; i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; &#172; learn (f i) (f (Suc i)) &#8743; &#172; forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i)
            (f (Suc i))}&#8250;</span></span></span><span class="delimiter">,</span><span> </span><span>simplified</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; learn (f i<span class="hidden">&#8681;</span><sub>0</sub>) (f (Suc i<span class="hidden">&#8681;</span><sub>0</sub>)) &#8743; &#172; forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i<span class="hidden">&#8681;</span><sub>0</sub>) (f (Suc i<span class="hidden">&#8681;</span><sub>0</sub>))&#8250;</span></span></span><span> </span><span>less_imp_le</span><span>
</span><span>            </span><span>dual_order.trans</span><span> </span><span>not_le</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>that</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">define</span></span><span> </span><span>g</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;g = (&#955;n. f (n + Suc i))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj (f i) (g 0)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_learn_forget</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.cases</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>g_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;j &#8804; i&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn_or_forget<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (f 0) (f j)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_leD</span><span> </span><span>Suc_le_lessD</span><span> </span><span>rtranclp.simps</span><span>
</span><span>            </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;k&lt;i. learn (f k) (f (Suc k)) &#8744; forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f k) (f (Suc k))&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn_or_forget<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (f 0) (f i)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
      - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A)) (trail_weight (g 0))
      &lt; (2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
      - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A)) (trail_weight (f 0))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learn_or_forget_dpll_&#956;<span class="hidden">&#8681;</span><sub>C</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f 0&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f i&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;g 0&#8250;</span></span></span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj (f i) (g 0)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_i</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (f 0) (g 0)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_learn_or_forget_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f 0&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f i&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn_or_forget<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (f 0) (f i)&#8250;</span></span></span><span>
</span><span>        </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>g_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;i. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (g i) (g (Suc i))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>g_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A (g 0)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_i</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail_clauses_bound</span><span> </span><span>g_def</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;i. i&#8805;j &#10233; learn_or_forget (g i) (g (Suc i))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;k &#8805; j + Suc i&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn_or_forget (f k) (f (Suc k))&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;k-Suc i&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>g_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;k&#8805;j+Suc i. learn_or_forget (f k) (f (Suc k))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>H</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?case&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;i. &#172; learn (f i) (f (Suc i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;learn (f i) (f (Suc i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;k&lt;i. learn_or_forget (f k) (f (Suc k))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i<span class="hidden">&#8681;</span><sub>0</sub></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; learn (f i<span class="hidden">&#8681;</span><sub>0</sub>) (f (Suc i<span class="hidden">&#8681;</span><sub>0</sub>)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i<span class="hidden">&#8681;</span><sub>0</sub>) (f (Suc i<span class="hidden">&#8681;</span><sub>0</sub>))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{i. i&#8804;i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; &#172; learn (f i) (f (Suc i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i))} &#8800; {}&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?I</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{i. i&#8804;i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; &#172; learn (f i) (f (Suc i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i))}&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?i</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Min ?I&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite ?I&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; learn (f ?i) (f (Suc ?i)) &#8743; &#172;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f ?i) (f (Suc ?i))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Min_in</span><span class="delimiter">[</span><span>OF</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite ?I&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8800; {}&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;k&lt;?i. learn_or_forget (f k) (f (Suc k))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Min.coboundedI</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{i. i &#8804; i<span class="hidden">&#8681;</span><sub>0</sub> &#8743; &#172; learn (f i) (f (Suc i)) &#8743; &#172; forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i)
            (f (Suc i))}&#8250;</span></span></span><span class="delimiter">,</span><span> </span><span>simplified</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; learn (f i<span class="hidden">&#8681;</span><sub>0</sub>) (f (Suc i<span class="hidden">&#8681;</span><sub>0</sub>)) &#8743; &#172; forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i<span class="hidden">&#8681;</span><sub>0</sub>) (f (Suc i<span class="hidden">&#8681;</span><sub>0</sub>))&#8250;</span></span></span><span> </span><span>less_imp_le</span><span>
</span><span>            </span><span>dual_order.trans</span><span> </span><span>not_le</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>that</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj (f i) (f (Suc i))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; learn (f i) (f (Suc i)) &#8743; &#172; forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i))&#8250;</span></span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.cases</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;j &#8804; i&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn_or_forget<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (f 0) (f j)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_leD</span><span> </span><span>Suc_le_lessD</span><span> </span><span>rtranclp.simps</span><span>
</span><span>            </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;k&lt;i. learn (f k) (f (Suc k)) &#8744; forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f k) (f (Suc k))&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn_or_forget<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (f 0) (f i)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learn_or_forget_dpll_&#956;<span class="hidden">&#8681;</span><sub>C</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f 0&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f i&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f (Suc i)&#8250;</span></span></span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>0</span><span>
</span><span>        </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dpll_bj (f i) (f (Suc i))&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wf_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_learn_and_forget_infinite_chain</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>no_infinite_lf</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;f j. &#172; (&#8704;i&#8805;j. learn_or_forget (f i) (f (Suc i)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S). cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A S}&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S). cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8743; ?inv S}&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>wf_iff_no_infinite_down_chain</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; &#172; (&#8707;f. &#8704;i. (f (Suc i), f i) &#8712; {(T, S). cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8743; ?inv S})&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>f</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;i. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (f i) (f (Suc i)) &#8743; ?inv (f i)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;j. &#8704;i&#8805;j. learn_or_forget (f i) (f (Suc i))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>infinite_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_exists_learn_and_forget_infinite_chain</span><span class="delimiter">[</span><span>of</span><span> </span><span>f</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>meson</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_infinite_lf</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>inv_and_tranclp_cdcl_<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_tranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A S &#10231; (&#955;S T. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A S)<span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T&#8250;</span></span></span><span>
</span><span>  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?A &#8743; ?I &#10231; ?B&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?A &#8743; ?I&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?A</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="var">?I</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?B</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>induction</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>tranclp.r_into_trancl</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>tranclp.simps</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv</span><span> </span><span>tranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?B</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>induction</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?I</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?B&#8250;</span></span></span><span> </span><span>tranclpD</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?A &#8743; ?I&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wf_tranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_learn_and_forget_infinite_chain</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>no_infinite_lf</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;f j. &#172; (&#8704;i&#8805;j. learn_or_forget (f i) (f (Suc i)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S). cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A S}&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>wf_trancl</span><span class="delimiter">[</span><span>OF</span><span> </span><span>wf_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_learn_and_forget_infinite_chain</span><span class="delimiter">[</span><span>OF</span><span> </span><span>no_infinite_lf</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wf_subset</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>trancl_set_tranclp</span><span> </span><span>inv_and_tranclp_cdcl_<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_tranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_final_state</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>n_s</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
    &#8744; (trail S &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>n_s&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step dpll_bj S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>n_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>dpll_backjump_final_state</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>A</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>decomp</span><span> </span><span>n_s&#39;</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>full_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_final_state</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>full</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))
    &#8744; (trail T &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_s</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>n_s&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv A T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv</span><span> </span><span>inv</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv_def</span><span> </span><span>decomp</span><span> </span><span>inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_decomposition_implies</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_final_state</span><span> </span><span>n_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment">&#8213; &#8249;End of the locale @{locale conflict_driven_clause_learning}.&#8250;</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Termination&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;To prove termination we need to restrict learn and forget. Otherwise we could forget and
  relearn the exact same clause over and over. A first idea is to forbid removing clauses that
  can be used to backjump. This does not change the rules of the calculus. A second idea is to
  ``merge&#39;&#39; backjump and learn: that way, though closer to implementation, needs a change of the
  rules, since the backjump-rule learns the clause used to backjump.&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Restricting learn and forget&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>conflict_driven_clause_learning_learning_before_backjump_only_distinct_learnt</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>dpll_state</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>conflict_driven_clause_learning</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>    </span><span>inv</span><span> </span><span>decide_conds</span><span> </span><span>backjump_conds</span><span> </span><span>propagate_conds</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;C S. distinct_mset C &#8743; &#172;tautology C &#8743; learn_restrictions C S &#8743;
    (&#8707;F K d F&#39; C&#39; L. trail S = F&#39; @ Decided K # F &#8743; C = add_mset L C&#39; &#8743; F &#8872;as CNot C&#39;
      &#8743; add_mset L C&#39; &#8713;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;C S. &#172;(&#8707;F&#39; F K d L. trail S = F&#39; @ Decided K # F &#8743; F &#8872;as CNot (remove1_mset L C))
    &#8743; forget_restrictions C S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>backjump_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>learn_restrictions</span><span> </span><span>forget_restrictions</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_learn_all_induct</span><span class="delimiter">[</span><span>consumes</span><span> </span><span>1</span><span class="delimiter">,</span><span> </span><span>case_names</span><span> </span><span>dpll_bj</span><span> </span><span>learn</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>dpll</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;T. dpll_bj S T &#10233; P S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>learning</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;C F K F&#39; C&#39; L T. clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm C &#10233;
        atms_of C &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S)) &#10233;
        distinct_mset C &#10233;
        &#172; tautology C &#10233;
        learn_restrictions C S &#10233;
        trail S = F&#39; @ Decided K # F &#10233;
        C = add_mset L C&#39; &#10233;
        F &#8872;as CNot C&#39; &#10233;
        add_mset L C&#39; &#8713;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10233;
        T &#8764; add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S &#10233;
        P S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>forgetting</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;C T. removeAll_mset C (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8872;pm C &#10233;
      C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10233;
      &#172;(&#8707;F&#39; F K L. trail S = F&#39; @ Decided K # F &#8743; F &#8872;as CNot (C - {#L#})) &#10233;
      T &#8764; remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S &#10233;
      forget_restrictions C S &#10233;
      P S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;P S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>assms</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>learn_ops_axioms</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>learn_ops.learn.cases</span><span class="delimiter">[</span><span>OF</span><span> </span><span>learn_ops_axioms</span><span class="delimiter">]</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>assms</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>forget_ops.forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.cases</span><span class="delimiter">[</span><span>OF</span><span> </span><span>forget_ops_axioms</span><span class="delimiter">]</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>assms</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10233; inv S &#10233; inv T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflict_driven_clause_learning_def</span><span>
</span><span>  </span><span>conflict_driven_clause_learning_axioms_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>learn_always_simple_clauses</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>learn</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T - clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)
    &#8838; simple_clss (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>C</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T - clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct_mset C&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;tautology C&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learn</span><span> </span><span>C</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; simple_clss (atms_of C)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>distinct_mset_not_tautology_implies_in_simple_clss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of C &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learn</span><span> </span><span>C</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>atms_of_ms_def</span><span> </span><span>atms_of_def</span><span> </span><span>image_Un</span><span>
</span><span>      </span><span>true_annots_CNot_all_atms_defined</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; simple_clss (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>simple_clss_mono</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>insert_subset</span><span> </span><span>mk_disjoint_insert</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss S &#8801;
   {C+{#L#} |C L. C+{#L#} &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; distinct_mset (C+{#L#})
   &#8743; &#172;tautology (C+{#L#})
     &#8743; (&#8707;F&#39; K F. trail S = F&#39; @ Decided K # F &#8743; F &#8872;as CNot C)}&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conflicting_bj_clss_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss (remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S) = conflicting_bj_clss S - {C}&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conflicting_bj_clss_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>&#39;</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S &#10233; conflicting_bj_clss T = conflicting_bj_clss S - {C}&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conflicting_bj_clss_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_state_eq</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C&#39; S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss T
    = conflicting_bj_clss S
      &#8746; (if &#8707;C L. C&#39; = add_mset L C &#8743; distinct_mset (add_mset L C) &#8743; &#172;tautology (add_mset L C)
     &#8743; (&#8707;F&#39; K d F. trail S = F&#39; @ Decided K # F &#8743; F &#8872;as CNot C)
     then {C&#39;} else {})&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">define</span></span><span> </span><span>P</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;P = (&#955;C L T. distinct_mset (add_mset L C) &#8743; &#172; tautology (add_mset L C) &#8743;
    (&#8707;F&#39; K F. trail T = F&#39; @ Decided K # F &#8743; F &#8872;as CNot C))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>conf</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;T. conflicting_bj_clss T = {add_mset L C |C L. add_mset L C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#8743; P C L T}&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span>P_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>P_S_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;C L. P C L T = P C L S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>P_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>P</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss T = {add_mset L C |C L. add_mset L C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; P C L T} &#8746;
     {add_mset L C |C L. add_mset L C &#8712;# {#C&#39;#} &#8743; P C L T}&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conf</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{add_mset L C |C L. add_mset L C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; P C L T} = conflicting_bj_clss S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>P_def</span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{add_mset L C |C L. add_mset L C &#8712;# {#C&#39;#} &#8743; P C L T} =
    (if &#8707;C L. C&#39; = add_mset L C &#8743; P C L S then {C&#39;} else {})&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>n_d</span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>P_S_T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>P_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conflicting_bj_clss_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S) &#10233;
  conflicting_bj_clss (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C&#39; S)
    = conflicting_bj_clss S
      &#8746; (if &#8707;C L. C&#39; = C +{#L#}&#8743; distinct_mset (C+{#L#}) &#8743; &#172;tautology (C+{#L#})
     &#8743; (&#8707;F&#39; K d F. trail S = F&#39; @ Decided K # F &#8743; F &#8872;as CNot C)
     then {C&#39;} else {})&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conflicting_bj_clss_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_state_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conflicting_bj_clss_incl_clauses</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss S &#8838; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_conflicting_bj_clss</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (conflicting_bj_clss S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conflicting_bj_clss_incl_clauses</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span class="delimiter">]</span><span> </span><span>rev_finite_subset</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>learn_conflicting_increasing</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S) &#10233; learn S T &#10233; conflicting_bj_clss S &#8838; conflicting_bj_clss T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>conflicting_bj_clss_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_state_eq</span><span class="delimiter">[</span><span>of</span><span> </span><span>T</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss_yet b S &#8801;
  3 ^ b - card (conflicting_bj_clss S)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>L</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat &#8658; &#39;st &#8658; nat &#215; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>L</sub> b S &#8801; (conflicting_bj_clss_yet b S, card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>do_not_forget_before_backtrack_rule_clause_learned_clause_untouched</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss S = conflicting_bj_clss T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>rule</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>conflicting_bj_clss_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>&#39;</span><span class="delimiter">[</span><span>of</span><span> </span><span>T</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>simp</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span>remove1_mset_add_mset_If</span><span> </span><span>split</span><span class="delimiter">:</span><span> </span><span>if_splits</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>forget_&#956;<span class="hidden">&#8681;</span><sub>L</sub>_decrease</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#956;<span class="hidden">&#8681;</span><sub>L</sub> b T, &#956;<span class="hidden">&#8681;</span><sub>L</sub> b S) &#8712; less_than &lt;*lex*&gt; less_than&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)) &gt; 0&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>size_mset_removeAll_mset_le_iff</span><span> </span><span>card_gt_0_iff</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)) &lt; card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>size_mset_removeAll_mset_le_iff</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>do_not_forget_before_backtrack_rule_clause_learned_clause_untouched</span><span class="delimiter">[</span><span>OF</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>set_condition_or_split</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{a. (a = b &#8744; Q a) &#8743; S a} = (if S b then {b} else {}) &#8746; {a. Q a &#8743; S a}&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>set_insert_neq</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;A &#8800; insert a A &#10231; a &#8713; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>learn_&#956;<span class="hidden">&#8681;</span><sub>L</sub>_decrease</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>learnST</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>fin_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#956;<span class="hidden">&#8681;</span><sub>L</sub> (card A) T, &#956;<span class="hidden">&#8681;</span><sub>L</sub> (card A) S) &#8712; less_than &lt;*lex*&gt; less_than&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8746; atm_of ` lits_of_l (trail T))
    = (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learnST</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8746; atm_of ` lits_of_l (trail T))
    = card (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>card_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>3</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(3::nat) ^ card (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8746; atm_of ` lits_of_l (trail T))
    = 3 ^ card (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>power_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss S &#8838; conflicting_bj_clss T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learnST</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>learn_conflicting_increasing</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss S &#8800; conflicting_bj_clss T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learnST</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">,</span><span> </span><span>goal_cases</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>1</span><span> </span><span>C</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>clss_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>F</span><span> </span><span>K</span><span> </span><span>F&#39;</span><span> </span><span>C&#39;</span><span> </span><span>L</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>        </span><span>tr_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ Decided K # F&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C = add_mset L C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>F</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>C_S</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;add_mset L C&#39; &#8713;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct_mset C&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; tautology C&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;add_mset L C&#39; &#8712; conflicting_bj_clss T&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;add_mset L C&#39; &#8713; conflicting_bj_clss S&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C_S</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fin_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (conflicting_bj_clss T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learnST</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>induction</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>conflicting_bj_clss_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (conflicting_bj_clss T) &#8805; card (conflicting_bj_clss S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>card_mono</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fin&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8746; atm_of ` lits_of_l (trail T))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>1</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_ms (conflicting_bj_clss T) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span>atms_of_ms_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>2</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;x. x&#8712; conflicting_bj_clss T &#10233; &#172; tautology x &#8743; distinct_mset x&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss T
    &#8838; simple_clss (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8746; atm_of ` lits_of_l (trail T))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>standard</span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>1</span><span> </span><span>2</span><span> </span><span>fin&#39;</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (conflicting_bj_clss T)&#8250;</span></span></span><span> </span><span>simple_clss_mono</span><span>
</span><span>        </span><span>distinct_mset_set_def</span><span> </span><span>simplified_in_simple_clss</span><span> </span><span>subsetCE</span><span> </span><span>sup.coboundedI1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>#</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;3 ^ card (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8746; atm_of ` lits_of_l (trail T))
        &#8805; card (conflicting_bj_clss T)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Nat.le_trans</span><span> </span><span>simple_clss_card</span><span> </span><span>simple_clss_finite</span><span> </span><span>card_mono</span><span> </span><span>fin&#39;</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8746; atm_of ` lits_of_l (trail T) &#8838; A&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">[</span><span>OF</span><span> </span><span>learnST</span><span class="delimiter">]</span><span> </span><span>A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;3 ^ (card A) &#8805; card (conflicting_bj_clss T)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>#</span><span> </span><span>fin_A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>simple_clss_card</span><span> </span><span>simple_clss_finite</span><span>
</span><span>        </span><span>simple_clss_mono</span><span> </span><span>calculation</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>card_mono</span><span> </span><span>dual_order.trans</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>psubset_card_mono</span><span class="delimiter">[</span><span>OF</span><span> </span><span>fin_T</span><span> </span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>less_than_iff</span><span> </span><span>lex_prod_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>clarify</span><span>
</span><span>      </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss S &#8800; conflicting_bj_clss T&#8250;</span></span></span><span>
</span><span>        </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss S &#8838; conflicting_bj_clss T&#8250;</span></span></span><span>
</span><span>        </span><span>diff_less_mono2</span><span> </span><span>le_less_trans</span><span> </span><span>not_le</span><span> </span><span>psubsetI</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;We have to assume the following:
  &#9642; @{term &#8249;inv S&#8250;}: the invariant holds in the inital state.
  &#9642; @{term A} is a (finite @{term &#8249;finite A&#8250;}) superset of the literals in the trail
  @{term &#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;}
  and in the clauses @{term &#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;}. This can the the set of all
  the literals in the starting set of clauses.
  &#9642; @{term &#8249;no_dup (trail S)&#8250;}: no duplicate in the trail. This is invariant along the path.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub> A T &#8801; ((2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))
               - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight T),
            conflicting_bj_clss_yet (card (atms_of_ms A)) T, card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_decreasing_measure</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atm_clss</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atm_lits</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub> A T, &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub> A S)
            &#8712; less_than &lt;*lex*&gt; (less_than &lt;*lex*&gt; less_than)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>c_dpll_bj</span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>dpll_bj_trail_mes_decreasing_prop</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>inv</span><span> </span><span>atm_clss</span><span> </span><span>atm_lits</span><span> </span><span>n_d</span><span> </span><span>fin_A</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>in_lex_prod</span><span> </span><span>less_than_iff</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>c_learn</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>learn</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = trail T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>atm_clss</span><span> </span><span>atm_lits</span><span> </span><span>n_d</span><span> </span><span>fin_A</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>learn<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>learn_&#956;<span class="hidden">&#8681;</span><sub>L</sub>_decrease</span><span class="delimiter">[</span><span>OF</span><span> </span><span>learn</span><span> </span><span>n_d</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_ms A&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>atm_clss</span><span> </span><span>atm_lits</span><span> </span><span>fin_A</span><span> </span><span>n_d</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>S</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>c_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = trail T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>induction</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>forget_&#956;<span class="hidden">&#8681;</span><sub>L</sub>_decrease</span><span class="delimiter">[</span><span>OF</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wf_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restricted_learning</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S).
    (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A
    &#8743; no_dup (trail S)
    &#8743; inv S)
    &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T }&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wf_wf_if_measure&#39;</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;less_than &lt;*lex*&gt; (less_than &lt;*lex*&gt; less_than)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_decreasing_measure</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>assms</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set &#8658; &#39;st &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T &#8801; &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight T)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set &#8658; &#39;st &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39; A T &#8801;
  ((2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T) * (1+ 3^card (atms_of_ms A)) * 2
  + conflicting_bj_clss_yet (card (atms_of_ms A)) T * 2
  + card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_decreasing_measure&#39;</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_clss</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39; A T &lt; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39; A S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_learn_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>dpll_bj</span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T
    &lt; (2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj_trail_mes_decreasing_prop</span><span> </span><span>fin_A</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>atms_clss</span><span> </span><span>atms_trail</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>XX</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T) + 1
    &#8804; (2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>mult_le_mono1</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;1 + 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T) *
      (1 + 3 ^ card (atms_of_ms A)) + (1 + 3 ^ card (atms_of_ms A))
    &#8804; ((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A S)
      * (1 + 3 ^ card (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Nat.add_mult_distrib</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cl_T_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj.hyps</span><span> </span><span>inv</span><span> </span><span>dpll_bj_clauses</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss_yet (card (atms_of_ms A)) S &lt; 1+ 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T)
      * (1 + 3 ^ card (atms_of_ms A)) + conflicting_bj_clss_yet (card (atms_of_ms A)) T
    &lt; ((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A S) *(1 + 3 ^ card (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T)
        * (1 + 3 ^ card (atms_of_ms A))
      + conflicting_bj_clss_yet (card (atms_of_ms A)) T
    &lt; ((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A S)
        * (1 + 3 ^ card (atms_of_ms A))
      + conflicting_bj_clss_yet (card (atms_of_ms A)) S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T)
      * (1 + 3 ^ card (atms_of_ms A)) * 2
    + conflicting_bj_clss_yet (card (atms_of_ms A)) T * 2
    &lt; ((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A S)
      * (1 + 3 ^ card (atms_of_ms A)) * 2
    + conflicting_bj_clss_yet (card (atms_of_ms A)) S * 2&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_def</span><span> </span><span>cl_T_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>learn</span><span> </span><span>C</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>C&#39;</span><span> </span><span>L</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>clss_S_C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>dist</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>tauto</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>learn_restr</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>tr_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>C&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>F_C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>C_new</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;insert C (conflicting_bj_clss S) &#8838; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C&#39;</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Un_subset_iff</span><span> </span><span>simple_clss_mono</span><span>
</span><span>          </span><span>contra_subsetD</span><span> </span><span>dist</span><span> </span><span>distinct_mset_not_tautology_implies_in_simple_clss</span><span>
</span><span>          </span><span>dual_order.trans</span><span> </span><span>atms_C</span><span> </span><span>atms_clss</span><span> </span><span>atms_trail</span><span> </span><span>tauto</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss S &#8838; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; conflicting_bj_clss S&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; distinct_mset x &#8743; &#172; tautology x&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>atms_clss</span><span> </span><span>atms_of_atms_of_ms_mono</span><span> </span><span>atms_of_ms_finite</span><span> </span><span>simple_clss_mono</span><span>
</span><span>              </span><span>distinct_mset_not_tautology_implies_in_simple_clss</span><span> </span><span>fin_A</span><span> </span><span>finite_subset</span><span>
</span><span>              </span><span>set_rev_mp</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (insert C (conflicting_bj_clss S)) &#8804; 3 ^ (card (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Nat.le_trans</span><span> </span><span>atms_of_ms_finite</span><span> </span><span>simple_clss_card</span><span> </span><span>simple_clss_finite</span><span>
</span><span>      </span><span>card_mono</span><span> </span><span>fin_A</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (insert C (conflicting_bj_clss S))
    = Suc (card ((conflicting_bj_clss S)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>C&#39;</span><span> </span><span>C_new</span><span> </span><span>card_insert_if</span><span> </span><span>conflicting_bj_clss_incl_clauses</span><span> </span><span>contra_subsetD</span><span>
</span><span>      </span><span>finite_conflicting_bj_clss</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S) = conflicting_bj_clss S &#8746; {C}&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dist</span><span> </span><span>tauto</span><span> </span><span>F_C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>conflicting_bj_clss_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>OF</span><span> </span><span>n_d</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>C&#39;</span><span> </span><span>tr_S</span><span> </span><span>n_d</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss_yet (card (atms_of_ms A)) S
    = Suc (conflicting_bj_clss_yet (card (atms_of_ms A)) (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>2</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss_yet (card (atms_of_ms A)) T
    = conflicting_bj_clss_yet (card (atms_of_ms A)) (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>3</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T = &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S))
    * (1 + 3 ^ card (atms_of_ms A)) * 2
    = ((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A S)
    * (1 + 3 ^ card (atms_of_ms A)) * 2&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss_yet (card (atms_of_ms A)) (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S)
        * 2
      + card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S)))
      &lt; conflicting_bj_clss_yet (card (atms_of_ms A)) S * 2
      + card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>C&#39;</span><span> </span><span>C_new</span><span> </span><span>n_d</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_def</span><span> </span><span>1</span><span> </span><span>2</span><span> </span><span>3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>C</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A (remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S) = &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.intros</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss T = conflicting_bj_clss S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>do_not_forget_before_backtrack_rule_clause_learned_clause_untouched</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)) &lt; card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>T</span><span> </span><span>card_Diff1_less</span><span> </span><span>clauses_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>finite_set_mset</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>      </span><span>order_refl</span><span> </span><span>set_mset_minus_replicate_mset</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A (remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C S) = &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A S&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>add_le_cancel_left</span><span>
</span><span>      </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span>not_le</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin_A</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; simple_clss A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_learn_all_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>dpll_bj</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj_clauses</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>clauses_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>learn</span><span> </span><span>C</span><span> </span><span>F</span><span> </span><span>K</span><span> </span><span>d</span><span> </span><span>F&#39;</span><span> </span><span>C&#39;</span><span> </span><span>L</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>atms_C</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>dist</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>tauto</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_clss_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>12</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_trail_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>13</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of C &#8838; A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_C</span><span> </span><span>atms_clss_S</span><span> </span><span>atms_trail_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;simple_clss (atms_of C) &#8838; simple_clss A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>simple_clss_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; simple_clss A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite</span><span> </span><span>dist</span><span> </span><span>tauto</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>distinct_mset_not_tautology_implies_in_simple_clss</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; simple_clss A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span>-</span><span>7</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_clss_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_trail_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>finite_cls_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>st</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>atms_clss_S</span><span> </span><span>atms_trail_S</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span>n_d</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U) &#8838; set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8746; simple_clss A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>finite</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_card_clauses_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)) &#8804; card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)) + 3 ^ (card A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span>finite</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Nat.le_trans</span><span>
</span><span>    </span><span>simple_clss_card</span><span> </span><span>simple_clss_finite</span><span> </span><span>card_Un_le</span><span> </span><span>card_mono</span><span> </span><span>finite_UnI</span><span>
</span><span>    </span><span>finite_set_mset</span><span> </span><span>nat_add_left_cancel_le</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_card_clauses_bound&#39;</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card {C|C. C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#8743; (tautology C &#8744; &#172;distinct_mset C)}
    &#8804; card {C|C. C&#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; (tautology C &#8744; &#172;distinct_mset C)} + 3 ^ (card A)&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card ?T &#8804; card ?S + _&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span>finite</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?T &#8838; ?S &#8746; simple_clss A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card ?T &#8804; card (?S &#8746; simple_clss A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assms</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span>simple_clss_finite</span><span> </span><span>card_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>le_trans</span><span> </span><span>simple_clss_card</span><span> </span><span>card_Un_le</span><span> </span><span>local.finite</span><span> </span><span>nat_add_left_cancel_le</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_card_simple_clauses_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>NA</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>MA</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))
  &#8804; card {C. C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; (tautology C &#8744; &#172;distinct_mset C)} + 3 ^ (card A)&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card ?T &#8804; card ?S + _&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span>finite</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;x. x &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#10233; &#172; tautology x &#10233; distinct_mset x &#10233; x &#8712; simple_clss A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Un_iff</span><span> </span><span>NA</span><span>
</span><span>      </span><span>atms_of_atms_of_ms_mono</span><span> </span><span>simple_clss_mono</span><span> </span><span>contra_subsetD</span><span> </span><span>subset_trans</span><span>
</span><span>      </span><span>distinct_mset_not_tautology_implies_in_simple_clss</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; ?S &#8746; simple_clss A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card(set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)) &#8804; card (?S &#8746; simple_clss A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assms</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span>simple_clss_finite</span><span> </span><span>card_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>le_trans</span><span> </span><span>simple_clss_card</span><span> </span><span>card_Un_le</span><span> </span><span>local.finite</span><span> </span><span>nat_add_left_cancel_le</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set &#8658; &#39;st &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A S =
  ((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))) * (1 + 3 ^ card (atms_of_ms A)) * 2
     + 2*3 ^ (card (atms_of_ms A))
     + card {C. C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; (tautology C &#8744; &#172;distinct_mset C)} + 3 ^ (card (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> M S) = &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (atms_of_ms A)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>U</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;U &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> M T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39; A U &#8804; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A S&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249; ((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A U)
    &#8804; (2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A U)
        * (1 + 3 ^ card (atms_of_ms A)) * 2
    &#8804; (2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) * (1 + 3 ^ card (atms_of_ms A)) * 2&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>mult_le_mono1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;conflicting_bj_clss_yet (card (atms_of_ms A)) T * 2 &#8804; 2 * 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U))
      &#8804; card {C. C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; (tautology C &#8744; &#172;distinct_mset C)} + 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_card_simple_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>6</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span>U</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_def</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39; A T &#8804; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A S&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39; A (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (trail T) T) = &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39; A T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_def</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span>conflicting_bj_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail T&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>    </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_ref</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_decreasing</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A T &#8804; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A S&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{C. C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#8743; (tautology C &#8744; &#172; distinct_mset C)}
    &#8838; {C. C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; (tautology C &#8744; &#172; distinct_mset C)}&#8250;</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?T &#8838; ?S&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>Set.subsetI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>C</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; ?T&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>t_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tautology C &#8744; &#172; distinct_mset C&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8713; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>simple_clssE</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; ?S&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C_T</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span>t_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card {C. C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#8743; (tautology C &#8744; &#172; distinct_mset C)} &#8804;
    card {C. C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; (tautology C &#8744; &#172; distinct_mset C)}&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>card_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment">&#8213; &#8249;End of the locale @{locale conflict_driven_clause_learning_learning_before_backjump_only_distinct_learnt}.&#8250;</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;CDCL with Restarts&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Definition&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>restart_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>restart</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart S T&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;restart S T &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart S T&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>conflict_driven_clause_learning_with_restarts</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>conflict_driven_clause_learning</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>    </span><span>inv</span><span> </span><span>decide_conds</span><span> </span><span>backjump_conds</span><span> </span><span>propagate_conds</span><span> </span><span>learn_conds</span><span> </span><span>forget_conds</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>backjump_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>learn_conds</span><span> </span><span>forget_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_iff_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart_no_restarts</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#10231; restart_ops.cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (&#955;_ _. False) S T&#8250;</span></span></span><span>
</span><span>  </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?C S T &#10231; ?R S T&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>S</span><span> </span><span>T</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?C S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?R S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restart_ops.cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart.intros</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>S</span><span> </span><span>T</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?R S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?C S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>restart_ops.cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart.cases</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?R S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#10233; restart_ops.cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> restart S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restart_ops.cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart.intros</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Increasing restarts&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Definition&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;
  We define our increasing restart very abstractly: the predicate (called @{term cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>}) does not
  have to be a CDCL calculus. We just need some assuptions to prove termination:
  &#9642; a function @{term f} that is strictly monotonic. The first step is actually only used as a
  restart to clean the state (e.g. to ensure that the trail is empty). Then we assume that
  @{term &#8249;f n &#8805; 1&#8250;} for @{term &#8249;n &#8805; 1&#8250;}: it means that between two consecutive
  restarts, at least one step will be done. This is necessary to avoid sequence. like: full --
  restart -- full -- ...
  &#9642; a measure @{term &#956;}: it should decrease under the assumptions @{term bound_inv}, whenever a
  @{term cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>} or a @{term restart} is done. A parameter is given to @{term &#956;}: for conflict-
  driven clause learning, it is an upper-bound of the clauses. We are assuming that such a bound
  can be found after a restart whenever the invariant holds.
  &#9642; we also assume that the measure decrease after any @{term cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>} step.
  &#9642; an invariant on the states @{term cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv} that also holds after restarts.
  &#9642; it is &#8727;&#8249;not required&#8250; that the measure decrease with respect to restarts, but the measure has to
  be bound by some function @{term &#956;_bound} taking the same parameter as @{term &#956;} and the initial
  state of the considered @{term cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>} chain.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_increasing_restarts_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>restart_ops</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>restart</span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>restart</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>f</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bound_inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;bound &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>&#956;</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;bound &#8658; &#39;st &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>&#956;_bound</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;bound &#8658; &#39;st &#8658; nat&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>f</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unbounded f&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>f_ge_1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;n. n&#8805;1 &#10233; f n &#8800; 0&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bound_inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;A S T. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S &#10233; bound_inv A S &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#10233; bound_inv A T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_measure</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;A S T. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S &#10233; bound_inv A S &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#10233; &#956; A T &lt; &#956; A S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>measure_bound2</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;A T U. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T &#10233; bound_inv A T &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> T U
       &#10233; &#956; A U &#8804; &#956;_bound A T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>measure_bound4</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;A T U. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T &#10233; bound_inv A T &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> T U
       &#10233; &#956;_bound A U &#8804; &#956;_bound A T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;A U V. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv U &#10233; restart U V &#10233; bound_inv A U &#10233; bound_inv A V&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>exists_bound</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;R S. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv R &#10233; restart R S &#10233; &#8707;A. bound_inv A S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;S T. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv_restart</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;S T. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S &#10233; restart S T &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>^^n) S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span>bound_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bound_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>^^n) S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span>bound_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>induction</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bound_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>induction</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span>bound_inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_comp_n_le</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>^^(Suc n)) S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A S&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A T &lt; &#956; A S - n&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_measure</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>S_T</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>b_inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>c_inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>U</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;st</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>S_U</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>^^(Suc n)) S U&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>U_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>S_T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A U &lt; &#956; A S - n&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span class="delimiter">[</span><span>of</span><span> </span><span>U</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A U&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>S_U</span><span> </span><span>b_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bound_inv</span><span> </span><span>c_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A T &lt; &#956; A U&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_measure</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>U_T</span><span class="delimiter">]</span><span> </span><span>S_U</span><span> </span><span>c_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wf_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S). cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S &#8743; bound_inv A S}&#8250;</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf ?A&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wfP_if_measure2</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_comp_n_le</span><span class="delimiter">[</span><span>of</span><span> </span><span>0</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_measure</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A T &#8804; &#956; A S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>b_inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>c_inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bound_inv</span><span> </span><span>rtranclp_imp_relpowp</span><span> </span><span>st</span><span> </span><span>step.prems</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A U &lt; &#956; A T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_measure</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_comp_bounded</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;m &#8805; 1+&#956; A S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ^^ m) S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_comp_n_le</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;m-1&#8250;</span></span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;
  &#9642; @{term &#8249;m &gt; f n&#8250;} ensures that at least one step has been done.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>restart_step</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>^^m) S T &#10233; m &#8805; f n &#10233; restart T U
  &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (S, n) (U, Suc n)&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>restart_full</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full1 cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (S, n) (T, Suc n)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_induct</span><span> </span><span class="delimiter">=</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.induct</span><span class="delimiter">[</span><span>split_format</span><span class="delimiter">(</span><span>complete</span><span class="delimiter">)</span><span class="delimiter">,</span><span>
</span><span>  </span><span>OF</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_increasing_restarts_ops_axioms</span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (fst S) (fst T)&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_step</span><span> </span><span>m</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span> </span><span>U</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>relpowp_imp_rtranclp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart.intros</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>    </span><span>rtranclp_mono</span><span class="delimiter">[</span><span>of</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart T U&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;restart T U&#8250;</span></span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart.intros</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_full</span><span> </span><span>S</span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full1_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart.intros</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>    </span><span>rtranclp_mono</span><span class="delimiter">[</span><span>of</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_bound_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span> </span><span>2</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>rtranclp_unfold</span><span> </span><span>fstI</span><span> </span><span>full1_def</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bound_inv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bound_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_inv</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>induction</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv_restart</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fstI</span><span> </span><span>full_def</span><span> </span><span>full_unfold</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>induction</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_bound_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>induction</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_bound_inv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_bound_inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_increasing_number</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T &#10233; snd T = 1 + snd S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_increasing_restarts</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_increasing_restarts_ops</span><span> </span><span>restart</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>f</span><span> </span><span>bound_inv</span><span> </span><span>&#956;</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>&#956;_bound</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>dpll_state</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>f</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>restart</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bound_inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;bound &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>&#956;</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;bound &#8658; &#39;st &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>&#956;_bound</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;bound &#8658; &#39;st &#8658; nat&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>measure_bound</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;A T V n. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T &#10233; bound_inv A T
      &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (T, n) (V, Suc n) &#10233; &#956; A V &#8804; &#956;_bound A T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart_&#956;_bound</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (T, a) (V, b) &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T &#10233; bound_inv A T
        &#10233; &#956;_bound A V &#8804; &#956;_bound A T&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart_&#956;_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (T, a) (V, b) &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T &#10233; bound_inv A T
    &#10233; &#956;_bound A V &#8804; &#956;_bound A T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct2</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart_&#956;_bound</span><span> </span><span>dual_order.trans</span><span> </span><span>fst_conv</span><span>
</span><span>    </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_bound_inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart_measure_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (T, a) (V, b) &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T &#10233; bound_inv A T
    &#10233; &#956; A V &#8804; &#956;_bound A T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.cases</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>measure_bound</span><span> </span><span>relpowp_imp_rtranclp</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>full_def</span><span> </span><span>full_unfold</span><span> </span><span>measure_bound2</span><span> </span><span>prod.inject</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart_measure_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (T, a) (V, b) &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T &#10233; bound_inv A T
    &#10233; &#956; A V &#8804; &#956;_bound A T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>measure_bound2</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>dual_order.trans</span><span> </span><span>fst_conv</span><span> </span><span>measure_bound2</span><span> </span><span>r_into_rtranclp</span><span> </span><span>rtranclp.rtrancl_refl</span><span>
</span><span>    </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_bound_inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span>
</span><span>    </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart_&#956;_bound</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wf_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S). cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst S)}&#8250;</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf ?A&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?thesis&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>g</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>g</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;i. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (g i) (g (Suc i))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv_g</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;i. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst (g i))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>wf_iff_no_infinite_down_chain</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>snd_g</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;i. snd (g i) = i + snd (g 0)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induct_tac</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1_left</span><span> </span><span>add.commute</span><span> </span><span>add.left_commute</span><span>
</span><span>        </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_increasing_number</span><span> </span><span>g</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>snd_g_0</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;i. i &gt; 0 &#10233; snd (g i) = i + snd (g 0)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>unbounded_f_g</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unbounded (&#955;i. f (snd (g i)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>bounded_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>add.commute</span><span> </span><span>f</span><span> </span><span>less_or_eq_imp_le</span><span> </span><span>snd_g</span><span>
</span><span>      </span><span>not_bounded_nat_exists_larger</span><span> </span><span>not_le</span><span> </span><span>le_iff_add</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;T Ta m. (cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ^^ m) T Ta &#10233; no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#10233; m = 0&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>case_tac</span><span> </span><span>m</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>relpowp_E2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707; T m. (cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ^^ m) (fst (g i)) T &#8743; m &#8805; f (snd (g i))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>g</span><span class="delimiter">[</span><span>of</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.cases</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>g</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Suc i&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>f_ge_1</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.cases</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>full1_def</span><span> </span><span>full_def</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>H</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>tranclpD</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>H</span><span> </span><span>Suc_leI</span><span> </span><span>leD</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>H</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>A</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst (g 1))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>g</span><span class="delimiter">[</span><span>of</span><span> </span><span>0</span><span class="delimiter">]</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv_g</span><span class="delimiter">[</span><span>of</span><span> </span><span>0</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.cases</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>exists_bound</span><span> </span><span>fst_conv</span><span> </span><span>relpowp_imp_rtranclp</span><span>
</span><span>        </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>H</span><span class="delimiter">[</span><span>of</span><span> </span><span>1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full1_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>diff_is_0_eq&#39;</span><span> </span><span>diff_zero</span><span>
</span><span>        </span><span>f_ge_1</span><span> </span><span>fst_conv</span><span> </span><span>le_add2</span><span> </span><span>relpowp_E2</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?j</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;_bound A (fst (g 1)) + 1&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>j</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f (snd (g j)) &gt; ?j&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;j &gt; 1&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>unbounded_f_g</span><span> </span><span>not_bounded_nat_exists_larger</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span>j</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;j &#8805; i &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (g i) (g j)&#8250;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>g</span><span> </span><span>le_Suc_eq</span><span> </span><span>rtranclp.rtrancl_into_rtrancl</span><span> </span><span>rtranclp.rtrancl_refl</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst (g (Suc 0)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv_g</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (fst (g 1), snd (g 1)) (fst (g j), snd (g j))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;j&gt; 1&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A (fst (g j)) &#8804; &#956;_bound A (fst (g 1))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart_measure_bound</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (fst (g 1), snd (g 1)) (fst (g j), snd (g j))&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv_g</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst (g 1))&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A (fst (g j)) &#8804; ?j&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst (g j))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst (g 1))&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst (g (Suc 0)))&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (fst (g 1), snd (g 1)) (fst (g j), snd (g j))&#8250;</span></span></span><span>
</span><span>    </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_bound_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>T</span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_m</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ^^ m) (fst (g j)) T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>f_m</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f (snd (g j)) &#8804; m&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>H</span><span class="delimiter">[</span><span>of</span><span> </span><span>j</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?j &lt; m&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f_m</span><span> </span><span>j</span><span> </span><span>Nat.le_trans</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A (fst (g j)) &#8804; &#956;_bound A (fst (g 1))&#8250;</span></span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_comp_bounded</span><span class="delimiter">[</span><span>OF</span><span> </span><span>inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv_g</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="delimiter">]</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv_g</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_m</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?j &lt; m&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_steps_bigger_than_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;f (snd S) &gt; &#956;_bound A (fst S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full1 cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>restart_full</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_step</span><span> </span><span>m</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>f</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>bound_inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>&#956;</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>m</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;m = Suc m&#39;&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>m</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956; A S - m&#39; = 0&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f</span><span> </span><span>bound_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>&#956;</span><span> </span><span>m</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_raw_restart_measure_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_comp_n_le</span><span class="delimiter">[</span><span>of</span><span> </span><span>m&#39;</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span>restart_step</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>m</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_inv_inv_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>binv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#955;S T. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S &#8743; bound_inv A S)<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10231; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?A<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10231; ?B<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_mono</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?A</span><span> </span><span class="var">?B</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>binv</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>binv</span><span> </span><span>inv</span><span> </span><span>rtranclp.simps</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bound_inv</span><span>
</span><span>    </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>no_step_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_no_step_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>n_s</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>binv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A (fst S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?thesis&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>T</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>U</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>U</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full (&#955;S T. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv S &#8743; bound_inv A S) T U&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>wf_exists_normal_form_full</span><span class="delimiter">[</span><span>OF</span><span> </span><span>wf_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>A</span><span> </span><span>T</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>inv_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) T&#8250;</span></span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b_inv_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;bound_inv A T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) T&#8250;</span></span></span><span> </span><span>binv</span><span> </span><span>bound_inv</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T U&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_inv_inv_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bound_inv</span><span>
</span><span>    </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full1 cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) U&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>full_fullI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>n_s</span><span> </span><span>prod.collapse</span><span> </span><span>restart_full</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Merging backjump and learning&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merge_bj_learn_ops</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>decide_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>decide_conds</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>forget_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>forget_conds</span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span>propagate_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>propagate_conds</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>forget_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>backjump_l_cond</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;We have a new backjump that combines the backjumping on the trail and the learning of the
  used clause (called @{term C&#39;&#39;} below)&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>backjump_l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>backjump_l</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ Decided K # F
   &#10233; T &#8764; prepend_trail (Propagated L ()) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> C&#39;&#39; S))
   &#10233; C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S
   &#10233; trail S &#8872;as CNot C
   &#10233; undefined_lit F L
   &#10233; atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))
   &#10233; clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm add_mset L C&#39;
   &#10233; C&#39;&#39; = add_mset L C&#39;
   &#10233; F &#8872;as CNot C&#39;
   &#10233; backjump_l_cond C C&#39; L S T
   &#10233; backjump_l S T&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Avoid (meaningless) simplification in the theorem generated by &#8249;inductive_cases&#8250;:&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_length_ne</span><span class="delimiter">[</span><span>simp</span><span> </span><span>del</span><span class="delimiter">]</span><span> </span><span>Set.Un_iff</span><span class="delimiter">[</span><span>simp</span><span> </span><span>del</span><span class="delimiter">]</span><span> </span><span>Set.insert_iff</span><span class="delimiter">[</span><span>simp</span><span> </span><span>del</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>backjump_lE</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l S T&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">thm</span></span><span> </span><span>backjump_lE</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_length_ne</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span> </span><span>Set.Un_iff</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span> </span><span>Set.insert_iff</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>S</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;st</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39; &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S S&#39;&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39; &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S S&#39;&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_backjump_l</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l S S&#39; &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S S&#39;&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S S&#39; &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S S&#39;&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_no_dup_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T &#10233; no_dup (trail S) &#10233; no_dup (trail T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.induct</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>defined_lit_map</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>defined_lit_map</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>defined_lit_map</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>backjump_lE</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>no_dup_appendD</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merge_bj_learn_proxy</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merge_bj_learn_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span>propagate_conds</span><span> </span><span>forget_conds</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;C C&#39; L&#39; S T. backjump_l_cond C C&#39; L&#39; S T
    &#8743; distinct_mset C&#39; &#8743; L&#39; &#8713;# C&#39; &#8743; &#172;tautology (add_mset L&#39; C&#39;)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>forget_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>backjump_l_cond</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>backjump_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_conds &#8801; &#955;C C&#39; L&#39; S T. distinct_mset C&#39; &#8743; L&#39; &#8713;# C&#39; &#8743; &#172;tautology (add_mset L&#39; C&#39;)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>backjumping_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span>backjump_conds</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>standard</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merge_bj_learn</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merge_bj_learn_proxy</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span>propagate_conds</span><span> </span><span>forget_conds</span><span> </span><span>backjump_l_cond</span><span> </span><span>inv</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>forget_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>backjump_l_cond</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>     </span><span>bj_merge_can_jump</span><span class="delimiter">:</span><span>
</span><span>     </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;S C F&#39; K F L.
       inv S
       &#10233; trail S = F&#39; @ Decided K # F
       &#10233; C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S
       &#10233; trail S &#8872;as CNot C
       &#10233; undefined_lit F L
       &#10233; atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (F&#39; @ Decided K # F))
       &#10233; clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm add_mset L C&#39;
       &#10233; F &#8872;as CNot C&#39;
       &#10233; &#172;no_step backjump_l S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>cdcl_merged_inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;S T. cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T &#10233; inv S &#10233; inv T&#8250;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>can_propagate_or_decide_or_backjump_l</span><span class="delimiter">:</span><span>
</span><span>       </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#10233;
       undefined_lit (trail S) L &#10233;
       inv S &#10233;
       satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)) &#10233;
       &#8707;T. decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8744; propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T &#8744; backjump_l S T&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>backjump_no_step_backjump_l</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump S T &#10233; inv S &#10233; &#172;no_step backjump_l S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>backjumpE</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>bj_merge_can_jump</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>7</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tautology_single_add</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tautology (L + {#a#}) &#10231; tautology L &#8744; -a &#8712;# L&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>tautology_decomp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>a</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>backjump_l_implies_exists_backjump</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>bj</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;U. backjump S U&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>C</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>L</span><span> </span><span>C&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>tr</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ Decided K # F&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; prepend_trail (Propagated L ()) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (add_mset L C&#39;) S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tr_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>undef</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit F L&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>L</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>S_C_L</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm add_mset L C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>F_C&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cond</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l_cond C C&#39; L S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>dist</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct_mset (add_mset L C&#39;)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>taut</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; tautology (add_mset L C&#39;)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>backjump_lE</span><span class="delimiter">)</span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8713;# C&#39;&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>backjump.intros</span><span class="delimiter">[</span><span>OF</span><span> </span><span>tr</span><span> </span><span>_</span><span> </span><span>C</span><span> </span><span>tr_C</span><span> </span><span>undef</span><span> </span><span>L</span><span> </span><span>S_C_L</span><span> </span><span>F_C&#39;</span><span class="delimiter">]</span><span> </span><span>cond</span><span> </span><span>dist</span><span> </span><span>taut</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Without additional knowledge on @{term backjump_l_cond}, it is impossible to have the same
  invariant.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>dpll_with_backjumping_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span>inv</span><span> </span><span>decide_conds</span><span> </span><span>backjump_conds</span><span> </span><span>propagate_conds</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>unfold_locales</span><span class="delimiter">,</span><span> </span><span>goal_cases</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>1</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>S</span><span> </span><span>S&#39;</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>bj</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l S S&#39;&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>L</span><span> </span><span>C&#39;</span><span> </span><span>C</span><span> </span><span>D</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>      </span><span>S&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;S&#39; &#8764; prepend_trail (Propagated L ()) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>tr_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ Decided K # F&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>tr_S_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>undef_L</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit F L&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>atm_L</span><span class="delimiter">:</span><span>
</span><span>       </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of L &#8712; insert (atm_of K) (atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l F&#39; &#8746; lits_of_l F))&#8250;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>cls_S_C&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm add_mset L C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>F_C&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>dist</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct_mset (add_mset L C&#39;)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>not_tauto</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; tautology (add_mset L C&#39;)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>cond</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l_cond C C&#39; L S S&#39;&#8250;</span></span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;D = add_mset L C&#39;&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>backjump_lE</span><span class="delimiter">)</span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>backjumping_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>    </span><span>backjump_conds</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>unfold_locales</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;T. backjump S T&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>rule</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>backjump.intros</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tr_S</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_ref</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tr_S_C</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>undef_L</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atm_L</span><span> </span><span>tr_S</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cls_S_C&#39;</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F_C&#39;</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dist</span><span> </span><span>not_tauto</span><span> </span><span>cond</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>1</span><span> </span><span>bj_merge_can_jump</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>meson</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>2</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>can_propagate_or_decide_or_backjump_l</span><span> </span><span>backjump_l_implies_exists_backjump</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>conflict_driven_clause_learning_ops</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>inv</span><span> </span><span>decide_conds</span><span> </span><span>backjump_conds</span><span> </span><span>propagate_conds</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;C _. distinct_mset C &#8743; &#172;tautology C&#8250;</span></span></span><span>
</span><span>  </span><span>forget_conds</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>unfold_locales</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>backjump_l_learn_backjump</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>bt</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;C&#39; L D. learn S (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S)
    &#8743; D = add_mset L C&#39;
    &#8743; backjump (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S) T
    &#8743; atms_of (add_mset L C&#39;) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>C</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>L</span><span> </span><span>l</span><span> </span><span>C&#39;</span><span> </span><span>D</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>     </span><span>tr_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ Decided K # F&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; prepend_trail (Propagated L l) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>C_cls_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>tr_S_CNot_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>undef</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit F L&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>atm_L</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>clss_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm D&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;D = add_mset L C&#39;&#8250;</span></span></span><span>
</span><span>     </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>distinct</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct_mset D&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>not_tauto</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; tautology D&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>cond</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l_cond C C&#39; L S T&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bt</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>backjump_lE</span><span class="delimiter">)</span><span> </span><span>simp</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>atms_C&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of C&#39; &#8838; atm_of ` (lits_of_l F)&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>D</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>atms_of_def</span><span> </span><span>image_subsetI</span><span> </span><span>true_annots_CNot_all_atms_defined</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of (add_mset L C&#39;) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atm_L</span><span> </span><span>tr_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>learn</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S)&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>learn.intros</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>clss_C</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_C&#39;</span><span> </span><span>atm_L</span><span> </span><span>D</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>tr_S</span><span> </span><span>in_plus_implies_atm_of_on_atms_of_ms</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>standard</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>distinct</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>not_tauto</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bj</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S) T&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>backjump.intros</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>L</span><span> </span><span>C</span><span> </span><span>C&#39;</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot C&#39;&#8250;</span></span></span><span> </span><span>C_cls_S</span><span> </span><span>tr_S_CNot_C</span><span> </span><span>undef</span><span> </span><span>T</span><span> </span><span>distinct</span><span> </span><span>not_tauto</span><span> </span><span>D</span><span> </span><span>cond</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tr_S</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span> </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>state_simp<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>D</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>backjump_l_backjump_learn</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>bt</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;C&#39; L D S&#39;. backjump S S&#39;
    &#8743; learn S&#39; T
    &#8743; D = (add_mset L C&#39;)
    &#8743; T &#8764; add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S&#39;
    &#8743; atms_of (add_mset L C&#39;) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))
    &#8743; clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm D&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>C</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>L</span><span> </span><span>l</span><span> </span><span>C&#39;</span><span> </span><span>D</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>     </span><span>tr_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ Decided K # F&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; prepend_trail (Propagated L l) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>C_cls_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>tr_S_CNot_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>undef</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit F L&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>atm_L</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of L &#8712; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>clss_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm D&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;D = add_mset L C&#39;&#8250;</span></span></span><span>
</span><span>     </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>distinct</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct_mset D&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>not_tauto</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; tautology D&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>cond</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l_cond C C&#39; L S T&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bt</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>backjump_lE</span><span class="delimiter">)</span><span> </span><span>simp</span><span>
</span><span>   </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?S&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;prepend_trail (Propagated L ()) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S)&#8250;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>atms_C&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of C&#39; &#8838; atm_of ` (lits_of_l F)&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>D</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>atms_of_def</span><span> </span><span>image_subsetI</span><span> </span><span>true_annots_CNot_all_atms_defined</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of (add_mset L C&#39;) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atm_L</span><span> </span><span>tr_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>learn</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn ?S&#39; T&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>learn.intros</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>clss_C</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_C&#39;</span><span> </span><span>atm_L</span><span> </span><span>D</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>tr_S</span><span> </span><span>in_plus_implies_atm_of_on_atms_of_ms</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>standard</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>distinct</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>not_tauto</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tr_S</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span> </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>state_simp<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bj</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump S (prepend_trail (Propagated L ()) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F S))&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>backjump.intros</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>_</span><span> </span><span>L</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot C&#39;&#8250;</span></span></span><span> </span><span>C_cls_S</span><span> </span><span>tr_S_CNot_C</span><span> </span><span>undef</span><span> </span><span>T</span><span> </span><span>distinct</span><span> </span><span>not_tauto</span><span> </span><span>D</span><span> </span><span>cond</span><span> </span><span>clss_C</span><span> </span><span>atm_L</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tr_S</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D ?S&#39;)&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tr_S</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span> </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>state_simp<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>D</span><span> </span><span>clss_C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_tranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T &#10233; inv S &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>   </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>   </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_backjump_l</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>bt</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>C&#39;</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>L</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v literal&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>D</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>     </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S) &#8743;
       backjump (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S) T &#8743;
       atms_of (add_mset L C&#39;) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;D = add_mset L C&#39;&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>backjump_l_learn_backjump</span><span class="delimiter">[</span><span>OF</span><span> </span><span>bt</span><span> </span><span>inv</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f4</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S)&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_learn</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S) T&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f3</span><span> </span><span>bj_backjump</span><span> </span><span>c_dpll_bj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>tranclp.r_into_trancl</span><span> </span><span>tranclp.trancl_into_trancl</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10233; inv S &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#8743; inv T&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span>-</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> T U&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_tranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>OF</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span> </span><span>IH</span><span>
</span><span>     </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S U&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv U&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl_merged_inv</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10233; inv S &#10233; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10233; inv S &#10233; inv T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_no_dup_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#10233; no_dup (trail S) &#10233; no_dup (trail T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_no_dup_inv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set &#8658; &#39;st &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T &#8801; &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1+card (atms_of_ms A)) (2+card (atms_of_ms A)) (trail_weight T)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set &#8658; &#39;st &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged A T &#8801;
  ((2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T) * 2 + card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_decreasing_measure&#39;</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atm_clss</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atm_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged A T &lt; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged A S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
       - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A)) (trail_weight T)
     &lt; (2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
       - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A)) (trail_weight S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>dpll_bj_trail_mes_decreasing_prop</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>fin_A</span><span> </span><span>atm_clss</span><span> </span><span>atm_trail</span><span> </span><span>n_d</span><span> </span><span>inv</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bj_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged_def</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bj_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>inv</span><span> </span><span>dpll_bj_clauses</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
       - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A)) (trail_weight T)
     &lt; (2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
       - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A)) (trail_weight S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>dpll_bj_trail_mes_decreasing_prop</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>atm_clss</span><span> </span><span>atm_trail</span><span> </span><span>fin_A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bj_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>      </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.hyps</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged_def</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>T</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)) &lt; card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>card_Diff1_less</span><span> </span><span>clauses_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>finite_set_mset</span><span>
</span><span>      </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.cases</span><span> </span><span>linear</span><span> </span><span>set_mset_minus_replicate_mset</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = trail T&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>elim</span><span class="delimiter">:</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
        - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A)) (trail_weight T)
 = (2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
        - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A)) (trail_weight S)&#8250;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged_def</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_backjump_l</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>bj_l</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>C&#39;</span><span> </span><span>L</span><span> </span><span>D</span><span> </span><span>S&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>learn</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S&#39; T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bj</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump S S&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of (add_mset L C&#39;) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;D = add_mset L C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S&#39;&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj_l</span><span> </span><span>inv</span><span> </span><span>backjump_l_backjump_learn</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span class="delimiter">]</span><span> </span><span>n_d</span><span> </span><span>atm_clss</span><span> </span><span>atm_trail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>card_T_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)) &#8804; 1+ card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj_l</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>backjump_lE</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>card_insert_if</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tr_S_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail_weight S&#39; = trail_weight T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
      - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A)) (trail_weight S&#39;))
    &lt; ((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A))
      - &#956;<span class="hidden">&#8681;</span><sub>C</sub> (1 + card (atms_of_ms A)) (2 + card (atms_of_ms A))
           (trail_weight S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>dpll_bj_trail_mes_decreasing_prop</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj</span><span> </span><span>bj_backjump</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_C</span><span> </span><span>atm_clss</span><span> </span><span>atm_trail</span><span> </span><span>D</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>n_d</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atm_trail</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>n_d</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fin_A</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>card_T_S</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged_def</span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39;_def</span><span> </span><span>tr_S_T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wf_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>fin_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S).
    (inv S &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A
    &#8743; no_dup (trail S))
    &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T}&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wfP_if_measure</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged A&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_decreasing_measure&#39;</span><span> </span><span>fin_A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_atms_neg_defined</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; atms_of C&#39; &#10233; F &#8872;as CNot C&#39; &#10233; x &#8712; atm_of ` lits_of_l F&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>atms_of_def</span><span> </span><span>imageE</span><span> </span><span>true_annots_CNot_all_atms_defined</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_atms_of_ms_clauses_decreasing</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.induct</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span> </span><span>4</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>dpll_bj_atms_of_ms_clauses_inv</span><span> </span><span>set_mp</span><span>
</span><span>        </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atms_of_ms_def</span><span> </span><span>Union_eq</span><span>
</span><span>        </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span> </span><span>propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span class="delimiter">[</span><span>3</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>backjump_lE</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>in_atms_neg_defined</span><span> </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_atms_in_trail_in_set</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.induct</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>bj_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>bj_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail</span><span> </span><span>trail_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>backjump_l_backjump_learn</span><span> </span><span>bj_backjump</span><span> </span><span>dpll_bj_atms_in_trail_in_set</span><span>
</span><span>      </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_trail</span><span> </span><span>trail_add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>cdcl</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_clauses_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; A &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_clauses_S</span><span> </span><span>atms_trail_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>st</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U) &#8838; A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_atms_of_ms_clauses_decreasing</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>IH</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail U)) &#8838; A&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_atms_in_trail_in_set</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>step.IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>cdcl</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_clauses_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T)) &#8838; A &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>T</span><span class="delimiter">]</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_tranclp</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atm_clss</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atm_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin_A</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(T, S) &#8712; {(T, S).
    (inv S &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A
    &#8743; no_dup (trail S))
    &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T}<span class="hidden">&#8679;</span><sup>+</sup>&#8250;</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;_ &#8712; ?P<span class="hidden">&#8679;</span><sup>+</sup>&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>tranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>n_d</span><span> </span><span>atm_clss</span><span> </span><span>atm_trail</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="delimiter">[</span><span class="delimiter">[</span><span>simp_trace</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rtranclp_unfold</span><span> </span><span>st</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>st</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>atm_clss</span><span> </span><span>atm_trail</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_inv</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>st</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>n_d</span><span> </span><span>atm_clss</span><span> </span><span>atm_trail</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span> </span><span>inv</span><span> </span><span>atm_clss</span><span> </span><span>atm_trail</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` (lits_of_l (trail T))&#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span> </span><span>inv</span><span> </span><span>atm_clss</span><span> </span><span>atm_trail</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_no_dup_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span> </span><span>n_d</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(U, T) &#8712; ?P&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>trancl_into_trancl2</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wf_tranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;wf {(T, S).
    (inv S &#8743; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A
    &#8743; no_dup (trail S))
    &#8743; cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>+</sup><span class="hidden">&#8679;</span><sup>+</sup> S T}&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wf_subset</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>wf_trancl</span><span class="delimiter">[</span><span>OF</span><span> </span><span>wf_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_tranclp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_final_state</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>A</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>n_s</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
    &#8744; (trail S &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?N</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?M</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">consider</span></span><span>
</span><span>      </span><span class="delimiter">(</span><span>sat</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;satisfiable ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M &#8872;as ?N&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">|</span><span> </span><span class="delimiter">(</span><span>sat&#39;</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;satisfiable ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?M &#8872;as ?N&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">|</span><span> </span><span class="delimiter">(</span><span>unsat</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable ?N&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>sat&#39;</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>sat</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>M</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>C</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;?M &#8872;a C&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>M</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_annots_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>I</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v literal set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>        </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;s ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>cons</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp I&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>tot</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m I ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>atm_I_N</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `I &#8838; atms_of_ms ?N&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sat</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>satisfiable_def_min</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?I</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8746; {P| P. P &#8712; lits_of_l ?M &#8743; atm_of P &#8713; atm_of ` I}&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?O</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{unmark L |L. is_decided L &#8743; L &#8712; set ?M &#8743; atm_of (lit_of L) &#8713; atms_of_ms ?N}&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cons_I&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp ?I&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cons</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup ?M&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>consistent_interp_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atm_of_in_atm_of_set_iff_in_set_or_uminus_in_set</span><span> </span><span>lits_of_def</span><span>
</span><span>          </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>no_dup_cannot_not_lit_and_uminus</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tot_I&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m ?I (?N &#8746; unmark_l ?M)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span>atms_of_s_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>total_over_m_def</span><span> </span><span>total_over_set_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>image_iff</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{P |P. P &#8712; lits_of_l ?M &#8743; atm_of P &#8713; atm_of ` I} &#8872;s ?O&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;s ?N&#8250;</span></span></span><span> </span><span>atm_I_N</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atm_of_eq_atm_of</span><span> </span><span>true_clss_def</span><span> </span><span>lits_of_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>I&#39;_N</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8872;s ?N &#8746; ?O&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;s ?N&#8250;</span></span></span><span> </span><span>true_clss_union_increase</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tot&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m ?I (?N&#8746;?O)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atm_I_N</span><span> </span><span>tot</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>total_over_m_def</span><span> </span><span>total_over_set_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lits_of_def</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>is_decided_ex_Decided</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>atms_N_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_ms ?N &#8838; atm_of ` lits_of_l ?M&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?thesis&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;v</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>            </span><span>l_N</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;l &#8712; atms_of_ms ?N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>            </span><span>l_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;l &#8713; atm_of ` lits_of_l ?M&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit ?M (Pos l)&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_M</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Decided_Propagated_in_iff_in_lits_of_l</span><span>
</span><span>              </span><span>atm_of_in_atm_of_set_iff_in_set_or_uminus_in_set</span><span> </span><span>literal.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>can_propagate_or_decide_or_backjump_l</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Pos l&#8250;</span></span></span><span> </span><span>S</span><span class="delimiter">]</span><span> </span><span>l_N</span><span>
</span><span>            </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>n_s</span><span> </span><span>inv</span><span> </span><span>sat</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.intros</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M &#8872;as CNot C&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>all_variables_defined_not_imply_cnot</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_N_M</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; ?N&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?M &#8872;a C&#8250;</span></span></span><span> </span><span>atms_of_atms_of_ms_mono</span><span class="delimiter">[</span><span>OF</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; ?N&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>atms_of_atms_of_ms_mono</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;l &#8712; set ?M. is_decided l&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ccontr</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?O</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{unmark L |L. is_decided L &#8743; L &#8712; set ?M &#8743; atm_of (lit_of L) &#8713; atms_of_ms ?N}&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#952;</span><span class="delimiter">[</span><span>iff</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;I. total_over_m I (?N &#8746; ?O &#8746; unmark_l ?M)
            &#10231; total_over_m I (?N &#8746;unmark_l ?M)&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>total_over_set_def</span><span> </span><span>total_over_m_def</span><span> </span><span>atms_of_ms_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?thesis&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{unmark L |L. is_decided L &#8743; L &#8712; set ?M}
   = {unmark L |L. is_decided L &#8743; L &#8712; set ?M &#8743; atm_of (lit_of L) &#8713; atms_of_ms ?N}&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?O &#8872;ps unmark_l ?M&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_decomposition_implies_propagated_lits_are_implied</span><span class="delimiter">[</span><span>OF</span><span> </span><span>decomp</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8872;s unmark_l ?M&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cons_I&#39;</span><span> </span><span>I&#39;_N</span><span> </span><span>tot_I&#39;</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?I &#8872;s ?N &#8746; ?O&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#952;</span><span> </span><span>true_clss_clss_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lits_of_l ?M &#8838; ?I&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_def</span><span> </span><span>lits_of_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M &#8872;as ?N&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>I&#39;_N</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712; ?N&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; ?M &#8872;a C&#8250;</span></span></span><span> </span><span>cons_I&#39;</span><span> </span><span>atms_N_M</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span>consistent_CNot_not</span><span> </span><span>rev_subsetD</span><span> </span><span>sup_ge1</span><span> </span><span>true_annot_def</span><span>
</span><span>              </span><span>true_annots_def</span><span> </span><span>true_cls_mono_set_mset_l</span><span> </span><span>true_clss_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>M</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>List.split_list_first_propE</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">]</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>K</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v literal&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>d</span><span> </span><span class="delimiter">::</span><span> </span><span>unit</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>F</span><span> </span><span>F&#39;</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>        </span><span>M_K</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M = F&#39; @ Decided K # F&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>nm</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;f&#8712;set F&#39;. &#172;is_decided f&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>is_decided_ex_Decided</span><span> </span><span>old.unit.exhaust</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?K</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Decided K::(&#39;v, unit) ann_lit&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?K &#8712; set ?M&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?C</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;image_mset lit_of {#L&#8712;#mset ?M. is_decided L &#8743; L&#8800;?K#} :: &#39;v clause&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?C&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (image_mset (&#955;L::&#39;v literal. {#L#}) (?C + unmark ?K))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; {unmark L |L. is_decided L &#8743; L &#8712; set ?M} &#8872;ps unmark_l ?M&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_decomposition_implies_propagated_lits_are_implied</span><span class="delimiter">[</span><span>OF</span><span> </span><span>decomp</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?C&#39; = {unmark L |L. is_decided L &#8743; L &#8712; set ?M}&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>standard</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>force</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>N_C_M</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?C&#39; &#8872;ps unmark_l ?M&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>N_M_False</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; (&#955;L. unmark L) ` (set ?M) &#8872;ps {{#}}&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_clss_def</span><span> </span><span>true_annots_def</span><span> </span><span>Ball_def</span><span> </span><span>true_annot_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>allI</span><span> </span><span>impI</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>LL</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;v literal set&quot;</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>          </span><span>tot</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m LL (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; unmark_l (trail S) &#8746; {{#}})&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>cons</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp LL&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>LL</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;LL &#8872;s set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; unmark_l (trail S)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m LL (CNot C)&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span>insert_absorb</span><span> </span><span>tot</span><span> </span><span>total_over_m_CNot_toal_over_m</span><span>
</span><span>              </span><span>total_over_m_insert</span><span> </span><span>total_over_m_union</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;total_over_m LL (unmark_l (trail S) &#8746; CNot C)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;LL &#8872;s {{#}}&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span>cons</span><span> </span><span>LL</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span>consistent_CNot_not</span><span>
</span><span>              </span><span>true_annots_true_clss_clss</span><span> </span><span>true_clss_clss_def</span><span> </span><span>true_clss_def</span><span> </span><span>true_clss_union</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit F K&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup ?M&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>defined_lit_map</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?C&#39; &#8872;ps {{#}}&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?C&#39; &#8746; unmark_l ?M = ?N &#8746; unmark_l ?M&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>true_clss_clss_left_right</span><span class="delimiter">[</span><span>OF</span><span> </span><span>N_C_M</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{{#}}&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>N_M_False</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8872;p image_mset uminus ?C + {#-K#}&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_cls_def</span><span> </span><span>true_clss_clss_def</span><span> </span><span>total_over_m_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>allI</span><span> </span><span>impI</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>I</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>              </span><span>tot</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_set I (atms_of_ms (?N &#8746; {image_mset uminus ?C+ {#- K#}}))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>cons</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp I&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;s ?N&#8250;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(K &#8712; I &#8743; -K &#8713; I) &#8744; (-K &#8712; I &#8743; K &#8713; I)&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cons</span><span> </span><span>tot</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>consistent_interp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>K</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;{a &#8712; set (trail S). is_decided a &#8743; a &#8800; Decided K} =
             set (trail S) &#8745; {L. is_decided L &#8743; L &#8800; Decided K}&#8250;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tot&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_set I
               (atm_of ` lit_of ` (set ?M &#8745; {L. is_decided L &#8743; L &#8800; Decided K}))&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atms_of_uminus_lit_atm_of_lit_of</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>                </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lit_of x &#8713; I&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; set ?M&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_decided x&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8800; Decided K&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Pos (atm_of (lit_of x)) &#8712; I &#8744; Neg (atm_of (lit_of x)) &#8712; I&#8250;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>a4</span><span> </span><span>tot&#39;</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>total_over_set_def</span><span> </span><span>atms_of_s_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f6</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Neg (atm_of (lit_of x)) = - Pos (atm_of (lit_of x))&#8250;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;- lit_of x &#8712; I&#8250;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f6</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>atm_of_in_atm_of_set_iff_in_set_or_uminus_in_set</span><span>
</span><span>                  </span><span>literal.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>H</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;I &#8872;s ?C&#39;&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?N &#8746; ?C&#39; &#8872;ps {{#}}&#8250;</span></span></span><span> </span><span>tot</span><span> </span><span>cons</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;s ?N&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_clss_def</span><span> </span><span>total_over_m_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atms_of_uminus_lit_atm_of_lit_of</span><span> </span><span>atms_of_ms_single_image_atm_of_lit_of</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872; image_mset uminus ?C + {#- K#}&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_def</span><span> </span><span>true_cls_def</span><span> </span><span>Bex_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(K &#8712; I &#8743; -K &#8713; I) &#8744; (-K &#8712; I &#8743; K &#8713; I)&#8250;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>H</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot (image_mset uminus ?C)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>nm</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_annots_def</span><span> </span><span>CNot_def</span><span> </span><span>M_K</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lits_of_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj_merge_can_jump</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>C</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;-K&#8250;</span></span></span><span>
</span><span>          </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;image_mset uminus (image_mset lit_of {# L :# mset ?M. is_decided L &#8743; L &#8800; Decided K#})&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C&#8712;?N&#8250;</span></span></span><span> </span><span>n_s</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;?M &#8872;as CNot C&#8250;</span></span></span><span> </span><span>bj_backjump</span><span> </span><span>inv</span><span> </span><span>sat</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>M_K</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.simps</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_all_decomposition_implies</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_backjump_l</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>bj_l</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>C&#39;</span><span> </span><span>L</span><span> </span><span>D</span><span> </span><span>S&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>learn</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S&#39; T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bj</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump S S&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of (add_mset L C&#39;) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;D = add_mset L C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S&#39;&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj_l</span><span> </span><span>inv</span><span> </span><span>backjump_l_backjump_learn</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#39;) (get_all_ann_decomposition (trail S&#39;))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj</span><span> </span><span>bj_backjump</span><span> </span><span>dpll_bj_clauses</span><span> </span><span>inv</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>inv</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_decomposition_implies_inv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>all_decomposition_implies_insert_single</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>dpll_bj_all_decomposition_implies_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_decomposition_implies</span><span>
</span><span>    </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>dpll_bj.intros</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.intros</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_all_decomposition_implies</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_all_decomposition_implies</span><span>
</span><span>    </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>full_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_final_state</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>A</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>full</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))
    &#8744; (trail T &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_s</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span> </span><span>inv</span><span> </span><span>atms_S</span><span> </span><span>atms_trail</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_no_dup_inv</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_inv</span><span> </span><span>inv</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_all_decomposition_implies</span><span> </span><span>inv</span><span> </span><span>st</span><span> </span><span>decomp</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_final_state</span><span class="delimiter">[</span><span>of</span><span> </span><span>T</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span> </span><span>n_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Instantiations&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;In this section, we instantiate the previous locales to ensure that the assumption are not
  contradictory.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_backtrack_and_restarts</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>conflict_driven_clause_learning_learning_before_backjump_only_distinct_learnt</span><span>
</span><span>    </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>    </span><span>inv</span><span> </span><span>decide_conds</span><span> </span><span>backjump_conds</span><span> </span><span>propagate_conds</span><span> </span><span>learn_restrictions</span><span> </span><span>forget_restrictions</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>backjump_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>learn_restrictions</span><span> </span><span>forget_restrictions</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>f</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat &#8658; nat&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>unbounded</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unbounded f&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>f_ge_1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;n. n &#8805; 1 &#10233; f n &#8805; 1&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv_restart</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;S T. inv S &#10233; T &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ([]::&#39;a list) S &#10233; inv T&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>bound_inv_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_clss_S_A</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail_S_A</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` lits_of_l (trail S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>conflict_driven_clause_learning_ops.cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_atms_of_ms_clauses_decreasing</span><span>
</span><span>      </span><span>conflict_driven_clause_learning_ops_axioms</span><span> </span><span>n_d</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_clss_S_A</span><span> </span><span>atms_trail_S_A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span>atms_clss_S_A</span><span> </span><span>atms_trail_S_A</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_atms_in_trail_in_set</span><span> </span><span>n_d</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_increasing_restarts_ops</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S T. T &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ([]::&#39;a list) S&#8250;</span></span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>f</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;A S. atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A &#8743;
  finite A&#8250;</span></span></span><span>
</span><span>  </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S. inv S &#8743; no_dup (trail S)&#8250;</span></span></span><span>
</span><span>  </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>unfold_locales</span><span>
</span><span>           </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>unbounded</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f_ge_1</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>force</span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bound_inv_inv</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>meson</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_decreasing_measure&#39;</span><span class="delimiter">;</span><span> </span><span>simp</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span class="delimiter">;</span><span> </span><span>simp</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_decreasing</span><span class="delimiter">;</span><span> </span><span>simp</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv_restart</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_le_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (T, a) (V, b)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bound_inv</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39; A V &#8804; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>bound_inv</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_induct</span><span class="delimiter">[</span><span>OF</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>1</span><span> </span><span>m</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>U</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>T</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ^^ m) S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>relpowp_imp_rtranclp</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>2</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>full</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full</span><span> </span><span>2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full1_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_le_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (T, a) (V, b)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bound_inv</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A V &#8804; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>bound_inv</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_induct</span><span class="delimiter">[</span><span>OF</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>1</span><span> </span><span>m</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>U</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A T &#8804; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A S&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_decreasing</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ^^ m) S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>relpowp_imp_rtranclp</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>U</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>2</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>full</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_decreasing</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full</span><span> </span><span>2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full1_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_increasing_restarts</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span>
</span><span>    </span><span>f</span><span>
</span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* restart *)</span></span></span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S T. T &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ([]::&#39;a list) S&#8250;</span></span></span><span>
</span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* bound_inv *)</span></span></span></span></span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;A S. atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A
     &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A &#8743; finite A&#8250;</span></span></span><span>
</span><span>   </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* inv *)</span></span></span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S. inv S &#8743; no_dup (trail S)&#8250;</span></span></span><span>
</span><span>   </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>unfold_locales</span><span>
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_le_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_le_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_all_decomposition_implies</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst S))&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)) (get_all_ann_decomposition (trail (fst S)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)) (get_all_ann_decomposition (trail (fst T)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_all_decomposition_implies</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>tranclp_into_rtranclp</span><span>
</span><span>    </span><span>simp</span><span class="delimiter">:</span><span> </span><span>full1_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_all_decomposition_implies</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)) (get_all_ann_decomposition (trail (fst S)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)) (get_all_ann_decomposition (trail (fst T)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>decomp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>u</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>r</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_all_decomposition_implies</span><span> </span><span>r</span><span> </span><span>IH</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_sat_ext_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>st</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) &#10231; I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_step</span><span> </span><span>m</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span> </span><span>U</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bj_sat_ext_iff</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>relpowp_imp_rtranclp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>restart_full</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bj_sat_ext_iff</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full1_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>tranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_sat_ext_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#215; nat&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>st</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) &#10231; I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>st</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>r</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_no_dup</span><span> </span><span>st</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_sat_ext_iff</span><span class="delimiter">[</span><span>OF</span><span> </span><span>r</span><span class="delimiter">]</span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>full_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_backjump_final_state</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>A</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>full</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (S, n) (T, m)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin_A</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) (get_all_ann_decomposition (trail S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
    &#8744; (lits_of_l (trail T) &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (S, n) (T, m)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_s</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (T, m)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>binv_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_bound_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>atms_S</span><span> </span><span>atms_trail</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>inv_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail T)&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) (get_all_ann_decomposition (trail T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_all_decomposition_implies</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span>
</span><span>    </span><span>decomp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))
    &#8744; (trail T &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_step_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_no_step_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(T, m)&#8250;</span></span></span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span>n_s</span><span>
</span><span>    </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_final_state</span><span class="delimiter">[</span><span>of</span><span> </span><span>T</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_NOT_all_inv_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_sat_S_T</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;I. I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_sat_ext_iff</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>atms_S</span><span>
</span><span>        </span><span>atms_trail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cons_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp (lits_of_l (trail T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv_T</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>distinct_consistent_interp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">consider</span></span><span>
</span><span>      </span><span class="delimiter">(</span><span>unsat</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">|</span><span> </span><span class="delimiter">(</span><span>sat</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail T &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>unsat</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_sat_S_T</span><span> </span><span>consistent_true_clss_ext_satisfiable</span><span> </span><span>true_clss_imp_true_cls_ext</span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>satisfiable_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>sat</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lits_of_l (trail T) &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_sat_ext_iff</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>atms_S</span><span>
</span><span>        </span><span>atms_trail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>true_clss_imp_true_cls_ext</span><span> </span><span>true_annots_true_cls</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cons_T</span><span> </span><span>consistent_true_clss_ext_satisfiable</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment">&#8213; &#8249;End of the locale @{locale cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_backtrack_and_restarts}.&#8250;</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;The restart does only reset the trail, contrary to Weidenbach&#39;s version where
  forget and restart are always combined. But there is a forget rule.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merge_bj_learn_with_backtrack_restarts</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merge_bj_learn</span><span> </span><span>trail</span><span> </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>prepend_trail</span><span> </span><span>tl_trail</span><span> </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span>propagate_conds</span><span> </span><span>forget_conds</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;C C&#39; L&#39; S T. distinct_mset C&#39; &#8743; L&#39; &#8713;# C&#39; &#8743; backjump_l_cond C C&#39; L&#39; S T&#8250;</span></span></span><span> </span><span>inv</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span>
</span><span>    </span><span>trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; (&#39;v, unit) ann_lits&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;v clauses&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>prepend_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tl_trail</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658;&#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; &#39;st&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decide_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>propagate_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#39;v, unit) ann_lit &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>forget_conds</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>backjump_l_cond</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;v clause &#8658; &#39;v clause &#8658; &#39;v literal &#8658; &#39;st &#8658; &#39;st &#8658; bool&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>f</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat &#8658; nat&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>unbounded</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unbounded f&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>f_ge_1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;n. n &#8805; 1 &#10233; f n &#8805; 1&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv_restart</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8896;S T. inv S &#10233; T &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> [] S &#10233; inv T&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>not_simplified_cls</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#39;b clause multiset &#8658; &#39;b clauses&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls A &#8801; {#C &#8712;# A. C &#8713; simple_clss (atms_of_mm A)#}&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>not_simplified_cls_tautology_distinct_mset</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls A = {#C &#8712;# A. tautology C &#8744; &#172;distinct_mset C#}&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>not_simplified_cls_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>filter_mset_cong</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>simple_clss_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>simple_clss_or_not_simplified_cls</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; simple_clss (atms_of_ms A) &#8744; x &#8712;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">consider</span></span><span>
</span><span>      </span><span class="delimiter">(</span><span>simpl</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;tautology x&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct_mset x&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">|</span><span> </span><span class="delimiter">(</span><span>n_simp</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tautology x &#8744; &#172;distinct_mset x&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>simpl</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>assms</span><span> </span><span>atms_of_atms_of_ms_mono</span><span> </span><span>atms_of_ms_finite</span><span> </span><span>simple_clss_mono</span><span>
</span><span>          </span><span>distinct_mset_not_tautology_implies_in_simple_clss</span><span> </span><span>finite_subset</span><span>
</span><span>          </span><span>subsetCE</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>n_simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>not_simplified_cls_tautology_distinct_mset</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_clauses_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_clss</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin_A</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
    &#8746; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>4</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_decide<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj_clauses</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>simple_clss_or_not_simplified_cls</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_propagate<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dpll_bj_clauses</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>simple_clss_or_not_simplified_cls</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>clauses_remove_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>state_eq<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>simple_clss_or_not_simplified_cls</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_backjump_l</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>bj</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_clss</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_trail</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj</span><span> </span><span>inv</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail T)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>atms_trail</span><span> </span><span>atms_clss</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>F&#39;</span><span> </span><span>K</span><span> </span><span>F</span><span> </span><span>L</span><span> </span><span>l</span><span> </span><span>C&#39;</span><span> </span><span>C</span><span> </span><span>D</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>tr_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = F&#39; @ Decided K # F&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; prepend_trail (Propagated L l) (reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> F (add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S &#8872;as CNot C&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>undef</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;undefined_lit F L&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm add_mset L C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;D = add_mset L C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>dist</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct_mset (add_mset L C&#39;)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>tauto</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; tautology (add_mset L C&#39;)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l_cond C C&#39; L S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump_l S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>backjump_lE</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of C&#39; &#8838; atm_of ` (lits_of_l F)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;F &#8872;as CNot C&#39;&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atm_of_in_atm_of_set_iff_in_set_or_uminus_in_set</span><span>
</span><span>      </span><span>atms_of_def</span><span> </span><span>image_subset_iff</span><span> </span><span>in_CNot_implies_uminus</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of (C&#39;+{#L#}) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span>tr_S</span><span> </span><span>undef</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;simple_clss (atms_of (add_mset L C&#39;)) &#8838; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>simple_clss_mono</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp_all</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;add_mset L C&#39; &#8712; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>distinct_mset_not_tautology_implies_in_simple_clss</span><span class="delimiter">[</span><span>OF</span><span> </span><span>dist</span><span> </span><span>tauto</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>T</span><span> </span><span>inv</span><span> </span><span>atms_clss</span><span> </span><span>undef</span><span> </span><span>tr_S</span><span> </span><span>D</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>simple_clss_or_not_simplified_cls</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_not_simplified_decreasing</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span> </span><span>4</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>not_simplified_cls_tautology_distinct_mset</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>backjump_lE</span><span> </span><span>forget<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>E</span><span class="delimiter">)</span><span class="delimiter">[</span><span>3</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>elim</span><span> </span><span>backjump_lE</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_not_simplified_decreasing</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>induction</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_not_simplified_decreasing</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_clauses_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
    &#8746; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>4</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>simple_clss_or_not_simplified_cls</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span>-</span><span>6</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_clss_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_trail_S</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_inv</span><span> </span><span>st</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>atms_clss_S</span><span>
</span><span>        </span><span>atms_trail_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U)
    &#8838; set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)) &#8746; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span> </span><span>finite</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_clauses_bound</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_clauses_bound</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))
    &#8838; set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_not_simplified_decreasing</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span>inv</span><span> </span><span>atms_clss_S</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>simple_clss_or_not_simplified_cls</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A T &#8801; ((2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))) * 2
     + card (set_mset (not_simplified_cls(clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)))
     + 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_clauses_bound_card</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of `(lits_of_l (trail S)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>finite</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged A T &#8804; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A S&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; set_mset (not_simplified_cls(clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
    &#8746; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>assms</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (not_simplified_cls(clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
      &#8746; simple_clss (atms_of_ms A))
    &#8804; card (set_mset (not_simplified_cls(clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))) + 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Nat.le_trans</span><span> </span><span>atms_of_ms_finite</span><span> </span><span>simple_clss_card</span><span> </span><span>card_Un_le</span><span> </span><span>finite</span><span>
</span><span>      </span><span>nat_add_left_cancel_le</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T))
    &#8804; card (set_mset (not_simplified_cls(clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))) + 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Nat.le_trans</span><span> </span><span>atms_of_ms_finite</span><span> </span><span>simple_clss_finite</span><span> </span><span>card_mono</span><span>
</span><span>      </span><span>finite_UnI</span><span> </span><span>finite_set_mset</span><span> </span><span>local.finite</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) - &#956;<span class="hidden">&#8681;</span><sub>C</sub>&#39; A T) * 2
    &#8804; (2 + card (atms_of_ms A)) ^ (1 + card (atms_of_ms A)) * 2&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_increasing_restarts_ops</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S T. T &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ([]::&#39;a list) S&#8250;</span></span></span><span>
</span><span>   </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn</span><span> </span><span>f</span><span>
</span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* bound_inv *)</span></span></span></span></span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;A S. atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A
     &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A &#8743; finite A&#8250;</span></span></span><span>
</span><span>   </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged</span><span>
</span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* inv *)</span></span></span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S. inv S &#8743; no_dup (trail S)&#8250;</span></span></span><span>
</span><span>   </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>unfold_locales</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>unbounded</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f_ge_1</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>meson</span><span>
</span><span>           </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_decreasing_measure&#39;</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_clauses_bound_card</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_not_simplified_decreasing</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>card_mono</span><span> </span><span>set_mset_mono</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_no_dup_inv</span><span> </span><span>cdcl_merged_inv</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>inv_restart</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged_le_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart T V&#8250;</span></span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst T)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst T))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail (fst T)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged A (fst V) &#8804; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_full</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>fst_conv</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_clauses_bound_card</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>restart_full</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full1_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>tranclp_into_rtranclp</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_step</span><span> </span><span>m</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>U</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_clss</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>atms_trail</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>finite</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>blast</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>relpowp_imp_rtranclp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st&#39;&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_inv</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>st&#39;</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv U&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>U</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>inv_restart</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_trail_clauses_bound</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st&#39;</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>atms_clss</span><span> </span><span>atms_trail</span><span> </span><span>n_d</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>U</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U) &#8838;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;U &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> [] T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_not_simplified_decreasing</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn ^^ m) S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>relpowp_imp_rtranclp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>U_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U) &#8838;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U))
    &#8838; set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U)) &#8746; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_clauses_bound</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv U&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>U</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>finite</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U)) &#8804; card (set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U))
    &#8746; simple_clss (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>simple_clss_finite</span><span> </span><span>card_mono</span><span> </span><span>local.finite</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U)) &#8746; simple_clss (atms_of_ms A)
    &#8838; set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)) &#8746; simple_clss (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>U_S</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U)) &#8746; simple_clss (atms_of_ms A))
      &#8804; card (set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)) &#8746; simple_clss (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>simple_clss_finite</span><span> </span><span>card_mono</span><span> </span><span>local.finite</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))
      &#8746; simple_clss (atms_of_ms A))
    &#8804; card (set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))) + card (simple_clss (atms_of_ms A))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>card_Un_le</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (simple_clss (atms_of_ms A)) &#8804; 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_of_ms_finite</span><span> </span><span>simple_clss_card</span><span> </span><span>local.finite</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U))
    &#8804; card (set_mset (not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S))) + 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_le_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart T V&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst T))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst T)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A (fst V) &#8804; &#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound A (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>3</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_full</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_not_simplified_decreasing</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full1 cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full1_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>tranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>card_mono</span><span> </span><span>set_mset_mono</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_step</span><span> </span><span>m</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>U</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>blast</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>relpowp_imp_rtranclp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st&#39;&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_inv</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>st&#39;</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv U&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>U</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>inv_restart</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U) &#8838;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;U &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> [] T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T) &#8838;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_not_simplified_decreasing</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn ^^ m) S T&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>relpowp_imp_rtranclp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>U_S</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U) &#8838;# not_simplified_cls (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>card_mono</span><span> </span><span>set_mset_mono</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">sublocale</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_increasing_restarts</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>f</span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S T. T &#8764; reduce_trail_to<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> ([]::&#39;a list) S&#8250;</span></span></span><span>
</span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* bound_inv *)</span></span></span></span></span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;A S. atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8838; atms_of_ms A
     &#8743; atm_of ` lits_of_l (trail S) &#8838; atms_of_ms A &#8743; finite A&#8250;</span></span></span><span>
</span><span>   </span><span>&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn</span><span>
</span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* inv *)</span></span></span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;S. inv S &#8743; no_dup (trail S)&#8250;</span></span></span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;A T. ((2+card (atms_of_ms A)) ^ (1+card (atms_of_ms A))) * 2
     + card (set_mset (not_simplified_cls(clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T)))
     + 3 ^ card (atms_of_ms A)&#8250;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>unfold_locales</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_merged_le_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound_le_&#956;<span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>D</sub><span class="hidden">&#8681;</span><sub>C</sub><span class="hidden">&#8681;</span><sub>L</sub>&#39;_bound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>true_clss_ext_decrease_right_insert</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sext insert C (set_mset M) &#10233; I &#8872;sextm M&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Diff_insert_absorb</span><span> </span><span>insert_absorb</span><span> </span><span>true_clss_ext_decrease_right_remove_r</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>true_clss_ext_decrease_add_implied</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;M &#8872;pm C&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;sext insert C (set_mset M) &#10231; I&#8872;sextm M&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>J</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sextm M&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8838; J&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>tot</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;total_over_m J (set_mset ({#C#} + M))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>cons</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;consistent_interp J&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;J &#8872;sm M&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_ext_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;M &#8872;pm C&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;J &#8872; C&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tot</span><span> </span><span>cons</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_cls_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;J &#8872;sm {#C#} + M&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sextm M &#10233; I &#8872;sext insert C (set_mset M)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_clss_ext_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>true_clss_ext_decrease_right_insert</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_bj_sat_ext_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_backjump_l</span><span> </span><span>T</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>bj_l</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>C&#39;</span><span> </span><span>L</span><span> </span><span>D</span><span> </span><span>S&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>learn</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;learn S&#39; T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bj</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;backjump S S&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of (add_mset L C&#39;) &#8838; atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#8746; atm_of ` (lits_of_l (trail S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;D = add_mset L C&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T &#8764; add_cls<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> D S&#39;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>clss_D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#8872;pm D&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj_l</span><span> </span><span>inv</span><span> </span><span>backjump_l_backjump_learn</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#39; = clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>elim</span><span class="delimiter">:</span><span> </span><span>backjumpE</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S) &#10231; (I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S&#39;)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bj</span><span> </span><span>bj_backjump</span><span> </span><span>dpll_bj_clauses</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>clss_D</span><span> </span><span>T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>true_clss_ext_decrease_add_implied</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_bj_sat_ext_iff</span><span>
</span><span>    </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>dpll_bj.intros</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>.intros</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_bj_sat_ext_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_bj_sat_ext_iff</span><span>
</span><span>    </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_eq_sat_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst S)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) &#10231; I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_full</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T &#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>tranclp_into_rtranclp</span><span> </span><span>full1_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_bj_sat_ext_iff</span><span> </span><span>restart_full.prems</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_step</span><span> </span><span>m</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span> </span><span>U</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tranclp_into_rtranclp</span><span> </span><span>full1_def</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>relpowp_imp_rtranclp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S &#10231; I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_bj_sat_ext_iff</span><span> </span><span>restart_step.prems</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> T &#10231; I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> U&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>restart_step.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_eq_sat_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup(trail (fst S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) &#10231; I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>rtranclp_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst T)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>st</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;I&#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T) &#10231; I &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst U)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_eq_sat_iff</span><span> </span><span>cdcl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_all_decomposition_implies_m</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup(trail (fst S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S))
      (get_all_ann_decomposition (trail (fst S)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T))
      (get_all_ann_decomposition (trail (fst T)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_full</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>full</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_s</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full1_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fast</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>tranclp_into_rtranclp</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>st&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv</span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_is_rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_and_inv</span><span> </span><span>st</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv T&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span class="delimiter">[</span><span>OF</span><span> </span><span>st</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_all_decomposition_implies</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>decomp</span><span class="delimiter">]</span><span> </span><span>st</span><span> </span><span>inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>restart_step</span><span> </span><span>m</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>n</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>U</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>n_d</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>decomp</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>U</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_all_decomposition_implies_m</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup(trail (fst S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S))
      (get_all_ann_decomposition (trail (fst S)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T))
      (get_all_ann_decomposition (trail (fst T)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>induction</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>decomp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>step</span><span> </span><span>T</span><span> </span><span>U</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>st</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cdcl</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>IH</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span>-</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>decomp</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst T)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>st</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_all_decomposition_implies_m</span><span class="delimiter">[</span><span>OF</span><span> </span><span>cdcl</span><span class="delimiter">]</span><span> </span><span>IH</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>full_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_normal_form</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>full</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart S T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup(trail (fst S))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>decomp</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S))
      (get_all_ann_decomposition (trail (fst S)))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_cls</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail (fst S)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)))
    &#8744; lits_of_l (trail (fst T)) &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) &#8743;
       satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>inv_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv (fst T)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n_d_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (trail (fst T))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_inv</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span>atms_cls_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atms_of_mm (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)) &#8838; atms_of_ms A&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>atms_trail_T</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of ` lits_of_l (trail (fst T)) &#8838; atms_of_ms A&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_with_restart_bound_inv</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>A</span><span class="delimiter">]</span><span> </span><span>full</span><span> </span><span>atms_cls</span><span> </span><span>atms_trail</span><span> </span><span>fin</span><span> </span><span>inv</span><span> </span><span>n_d</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_step cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn (fst T)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>no_step_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_no_step_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub></span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>A</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fin</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_decomposition_implies_m (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T))
    (get_all_ann_decomposition (trail (fst T)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_all_decomposition_implies_m</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>T</span><span class="delimiter">]</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span>decomp</span><span>
</span><span>    </span><span>full</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)))
    &#8744; trail (fst T) &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T) &#8743; satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merged_bj_learn_final_state</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atms_cls_T</span><span> </span><span>atms_trail_T</span><span> </span><span>fin</span><span> </span><span>n_d_T</span><span> </span><span>fin</span><span> </span><span>inv_T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">consider</span></span><span>
</span><span>      </span><span class="delimiter">(</span><span>unsat</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)))&#8250;</span></span></span><span>
</span><span>    </span><span class="delimiter">|</span><span> </span><span class="delimiter">(</span><span>sat</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail (fst T) &#8872;asm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)))
    &#8744; lits_of_l (trail (fst T)) &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S) &#8743;
       satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>cases</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>unsat</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>satisfiable_def</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_eq_sat_iff</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span class="delimiter">]</span><span> </span><span>full</span><span> </span><span>inv</span><span> </span><span>n_d</span><span>
</span><span>        </span><span>consistent_true_clss_ext_satisfiable</span><span> </span><span>true_clss_imp_true_cls_ext</span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>satisfiable_def</span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>sat</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lits_of_l (trail (fst T)) &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst T)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>true_clss_imp_true_cls_ext</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>true_annots_true_cls</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lits_of_l (trail (fst T)) &#8872;sextm clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_eq_sat_iff</span><span class="delimiter">[</span><span>of</span><span> </span><span>S</span><span> </span><span>T</span><span class="delimiter">]</span><span> </span><span>full</span><span> </span><span>inv</span><span> </span><span>n_d</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;satisfiable (set_mset (clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> (fst S)))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>consistent_true_clss_ext_satisfiable</span><span> </span><span>distinct_consistent_interp</span><span> </span><span>n_d_T</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">corollary</span></span><span> </span><span>full_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_normal_form_init_state</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>init_state</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trail S = []&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;clauses<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub> S = N&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>full</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart (S, 0) T&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;inv S&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;unsatisfiable (set_mset N)
    &#8744; lits_of_l (trail (fst T)) &#8872;sextm N &#8743; satisfiable (set_mset N)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full_cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_restart_normal_form</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(S, 0)&#8250;</span></span></span><span> </span><span>T</span><span class="delimiter">]</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment">&#8213; &#8249;End of locale @{locale cdcl<span class="hidden">&#8681;</span><sub>N</sub><span class="hidden">&#8681;</span><sub>O</sub><span class="hidden">&#8681;</span><sub>T</sub>_merge_bj_learn_with_backtrack_restarts}.&#8250;</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>

</div>
</body>
<div class=body><footer><p><table border=0  width=700> <tr><th>Isabelle version:</th><th>AFP version:</th><th>IsaFoL version:</th><th>Last compilation:</th></tr>

<tr><td align="center">Isabelle2019 </td><td align="center">93cdb54371e6+ </td><td align="center">d93efc62 </td><td align="center">Fri 06 Dec 2019 12:43:15 PM CET </td></tr></table></p><a href="https://imprint.mpi-klsb.mpg.de/mpi/mfleury">Imprint</a> / <a href="https://data-protection.mpi-klsb.mpg.de/mpi/mfleury">Data Protection</a></footer></div>

</html>


