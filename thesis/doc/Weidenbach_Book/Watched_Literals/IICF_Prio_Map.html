<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory IICF_Prio_Map (Isabelle2019: June 2019)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory IICF_Prio_Map</h1>

<span class="command">theory</span> <span class="name">IICF_Prio_Map</span><br/>
<span class="keyword">imports</span> <a href="IICF_Map.html"><span class="name">IICF_Map</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Priority Maps&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>IICF_Prio_Map</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>IICF_Map</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;This interface inherits from maps, and adds some operations&#8250;</span></span></span><span>
</span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* TODO: Hack! *)</span></span></span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>uncurry_fun_rel_conv</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;(uncurry f, uncurry g) &#8712; A&#215;<span class="hidden">&#8681;</span><sub>r</sub>B &#8594; R &#10231; (f,g)&#8712;A&#8594;B&#8594;R&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>uncurry_def</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>fun_relD</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>prod_relI</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>uncurry0_fun_rel_conv</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;(uncurry0 f, uncurry0 g) &#8712; unit_rel &#8594; R &#10231; (f,g)&#8712;R&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>fun_relD</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RETURN_rel_conv0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(RETURN f, RETURN g)&#8712;&#10216;A&#10217;nres_rel &#10231; (f,g)&#8712;A&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>nres_rel_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RETURN_rel_conv1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(RETURN o f, RETURN o g)&#8712;A &#8594; &#10216;B&#10217;nres_rel &#10231; (f,g)&#8712;A&#8594;B&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>nres_rel_def</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>fun_relD</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RETURN_rel_conv2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(RETURN oo f, RETURN oo g)&#8712;A &#8594; B &#8594; &#10216;R&#10217;nres_rel &#10231; (f,g)&#8712;A&#8594;B&#8594;R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>nres_rel_def</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>fun_relD</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RETURN_rel_conv3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(RETURN ooo f, RETURN ooo g)&#8712;A&#8594;B&#8594;C &#8594; &#10216;R&#10217;nres_rel &#10231; (f,g)&#8712;A&#8594;B&#8594;C&#8594;R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>nres_rel_def</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>fun_relD</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>fref2param_unfold</span><span> </span><span class="delimiter">=</span><span> 
</span><span>    </span><span>uncurry_fun_rel_conv</span><span> </span><span>uncurry0_fun_rel_conv</span><span> 
</span><span>    </span><span>RETURN_rel_conv0</span><span> </span><span>RETURN_rel_conv1</span><span> </span><span>RETURN_rel_conv2</span><span> </span><span>RETURN_rel_conv3</span><span>
</span><span>
</span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* TODO: Generate these lemmas in sepref_decl_op! *)</span></span></span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>param_op_map_update</span><span class="delimiter">[</span><span>param</span><span class="delimiter">]</span><span> </span><span class="delimiter">=</span><span> </span><span>op_map_update.fref</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_ncD</span><span class="delimiter">,</span><span> </span><span>unfolded</span><span> </span><span>fref2param_unfold</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>param_op_map_delete</span><span class="delimiter">[</span><span>param</span><span class="delimiter">]</span><span> </span><span class="delimiter">=</span><span> </span><span>op_map_delete.fref</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_ncD</span><span class="delimiter">,</span><span> </span><span>unfolded</span><span> </span><span>fref2param_unfold</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>param_op_map_is_empty</span><span class="delimiter">[</span><span>param</span><span class="delimiter">]</span><span> </span><span class="delimiter">=</span><span> </span><span>op_map_is_empty.fref</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_ncD</span><span class="delimiter">,</span><span> </span><span>unfolded</span><span> </span><span>fref2param_unfold</span><span class="delimiter">]</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Additional Operations&#8250;</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">sepref_decl_op</span></span><span> </span><span>map_update_new</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;op_map_update&quot;</span></span></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[&#955;((k,v),m). k&#8713;dom m]<span class="hidden">&#8681;</span><sub>f</sub> (K&#215;<span class="hidden">&#8681;</span><sub>r</sub>V)&#215;<span class="hidden">&#8681;</span><sub>r</sub>&#10216;K,V&#10217;map_rel &#8594; &#10216;K,V&#10217;map_rel&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued K&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued (K&#175;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">sepref_decl_op</span></span><span> </span><span>map_update_ex</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;op_map_update&quot;</span></span></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[&#955;((k,v),m). k&#8712;dom m]<span class="hidden">&#8681;</span><sub>f</sub> (K&#215;<span class="hidden">&#8681;</span><sub>r</sub>V)&#215;<span class="hidden">&#8681;</span><sub>r</sub>&#10216;K,V&#10217;map_rel &#8594; &#10216;K,V&#10217;map_rel&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued K&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued (K&#175;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">sepref_decl_op</span></span><span> </span><span>map_delete_ex</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;op_map_delete&quot;</span></span></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[&#955;(k,m). k&#8712;dom m]<span class="hidden">&#8681;</span><sub>f</sub> K&#215;<span class="hidden">&#8681;</span><sub>r</sub>&#10216;K,V&#10217;map_rel &#8594; &#10216;K,V&#10217;map_rel&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued K&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued (K&#175;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">context</span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>prio</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;v &#8658; &#39;p::linorder&quot;</span></span></span><span>  
</span><span>  </span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">sepref_decl_op</span></span><span> </span><span>pm_decrease_key</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;op_map_update&quot;</span></span></span><span> 
</span><span>      </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[&#955;((k,v),m). k&#8712;dom m &#8743; prio v &#8804; prio (the (m k))]<span class="hidden">&#8681;</span><sub>f</sub> (K&#215;<span class="hidden">&#8681;</span><sub>r</sub>V)&#215;<span class="hidden">&#8681;</span><sub>r</sub>&#10216;K,V&#10217;map_rel &#8594; &#10216;K,(V::(&#39;v&#215;&#39;v) set)&#10217;map_rel&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued K&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued (K&#175;)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;IS_BELOW_ID V&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>goal_cases</span><span>  
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>1</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>param</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#8804;),(&#8804;))&#8712;Id&#8594;Id&#8594;bool_rel&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>parametricity</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>param_and_cong1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>IS_BELOW_ID_def</span><span> </span><span>map_rel_def</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>fun_relD</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">sepref_decl_op</span></span><span> </span><span>pm_increase_key</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;op_map_update&quot;</span></span></span><span> 
</span><span>      </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[&#955;((k,v),m). k&#8712;dom m &#8743; prio v &#8805; prio (the (m k))]<span class="hidden">&#8681;</span><sub>f</sub> (K&#215;<span class="hidden">&#8681;</span><sub>r</sub>V)&#215;<span class="hidden">&#8681;</span><sub>r</sub>&#10216;K,V&#10217;map_rel &#8594; &#10216;K,(V::(&#39;v&#215;&#39;v) set)&#10217;map_rel&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued K&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued (K&#175;)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;IS_BELOW_ID V&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>goal_cases</span><span>  
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>1</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>param</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#8804;),(&#8804;))&#8712;Id&#8594;Id&#8594;bool_rel&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>parametricity</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>param_and_cong1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>IS_BELOW_ID_def</span><span> </span><span>map_rel_def</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>fun_relD</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>IS_BELOW_ID_D</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(a,b)&#8712;R &#10233; IS_BELOW_ID R &#10233; a=b&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>IS_BELOW_ID_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">sepref_decl_op</span></span><span> </span><span>pm_peek_min</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;m. SPEC (&#955;(k,v). 
      m k = Some v &#8743; (&#8704;k&#39; v&#39;. m k&#39; = Some v&#39; &#10230; prio v &#8804; prio v&#39;))&quot;</span></span></span><span>
</span><span>      </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[Not o op_map_is_empty]<span class="hidden">&#8681;</span><sub>f</sub> &#10216;K,V&#10217;map_rel &#8594; K&#215;<span class="hidden">&#8681;</span><sub>r</sub>(V::(&#39;v&#215;&#39;v) set)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;IS_BELOW_ID V&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>frefI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>clarsimp</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>pw_le_iff</span><span> </span><span>refine_pw_simps</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>map_rel_obtain2</span><span class="delimiter">,</span><span> </span><span>assumption</span><span class="delimiter">,</span><span> </span><span>assumption</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply1</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span> </span><span>conjI</span><span> </span><span>allI</span><span> </span><span>impI</span><span class="delimiter">;</span><span> </span><span>assumption</span><span class="delimiter">?</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>k&#39;</span><span> </span><span>v&#39;</span><span> </span><span>b</span><span> </span><span>w</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(x, y) &#8712; &#10216;K, V&#10217;map_rel&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;y k&#39; = Some v&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span>v</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(k,k&#39;)&#8712;K&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(v,v&#39;)&#8712;V&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x k = Some v&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>map_rel_obtain1</span><span class="delimiter">)</span><span>
</span><span>        
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;IS_BELOW_ID V&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(b, w) &#8712; V&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(v,v&#39;)&#8712;V&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;b=w&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;v=v&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>IS_BELOW_ID_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k&#39; v&#39;. x k&#39; = Some v&#39; &#10230; prio b &#8804; prio v&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x k = Some v&#8250;</span></span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;prio w &#8804; prio v&#39;&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">sepref_decl_op</span></span><span> </span><span>pm_pop_min</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;m. SPEC (&#955;((k,v),m&#39;). 
        m k = Some v
      &#8743; m&#39; = op_map_delete k m  
      &#8743; (&#8704;k&#39; v&#39;. m k&#39; = Some v&#39; &#10230; prio v &#8804; prio v&#39;)
      )&quot;</span></span></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[Not o op_map_is_empty]<span class="hidden">&#8681;</span><sub>f</sub> &#10216;K,V&#10217;map_rel &#8594; (K&#215;<span class="hidden">&#8681;</span><sub>r</sub>(V::(&#39;v&#215;&#39;v) set))&#215;<span class="hidden">&#8681;</span><sub>r</sub>&#10216;K,V&#10217;map_rel&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued K&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;single_valued (K&#175;)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;IS_BELOW_ID V&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>frefI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>clarsimp</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>pw_le_iff</span><span> </span><span>refine_pw_simps</span><span> </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>op_map_delete_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>map_rel_obtain2</span><span class="delimiter">,</span><span> </span><span>assumption</span><span class="delimiter">,</span><span> </span><span>assumption</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span> </span><span>conjI</span><span> </span><span>allI</span><span> </span><span>impI</span><span class="delimiter">;</span><span> </span><span>assumption</span><span class="delimiter">?</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">applyS</span></span></span></span><span> </span><span>parametricity</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>k&#39;</span><span> </span><span>v&#39;</span><span> </span><span>b</span><span> </span><span>w</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(x, y) &#8712; &#10216;K, V&#10217;map_rel&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;y k&#39; = Some v&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span>v</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(k,k&#39;)&#8712;K&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(v,v&#39;)&#8712;V&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x k = Some v&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>map_rel_obtain1</span><span class="delimiter">)</span><span>
</span><span>        
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;IS_BELOW_ID V&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(b, w) &#8712; V&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(v,v&#39;)&#8712;V&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;b=w&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;v=v&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>IS_BELOW_ID_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k&#39; v&#39;. x k&#39; = Some v&#39; &#10230; prio b &#8804; prio v&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x k = Some v&#8250;</span></span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;prio w &#8804; prio v&#39;&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>  </span><span class="keyword2"><span class="keyword">end</span></span><span>  
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>

</div>
</body>
<div class=body><footer><p><table border=0  width=700> <tr><th>Isabelle version:</th><th>AFP version:</th><th>IsaFoL version:</th><th>Last compilation:</th></tr>

<tr><td align="center">Isabelle2019 </td><td align="center">93cdb54371e6+ </td><td align="center">5222ffd4 </td><td align="center">Fri 06 Dec 2019 02:43:15 PM CET </td></tr></table></p><a href="https://imprint.mpi-klsb.mpg.de/mpi/mfleury">Imprint</a> / <a href="https://data-protection.mpi-klsb.mpg.de/mpi/mfleury">Data Protection</a></footer></div>

</html>


