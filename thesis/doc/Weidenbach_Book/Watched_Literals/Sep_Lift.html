<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory Sep_Lift (Isabelle2019: June 2019)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory Sep_Lift</h1>

<span class="command">theory</span> <span class="name">Sep_Lift</span><br/>
<span class="keyword">imports</span> <a href="Sep_Generic_Wp.html"><span class="name">Sep_Generic_Wp</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Sep_Lift</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Sep_Generic_Wp</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;HOL-Library.Rewrite&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>sep_lifting_scheme</span><span> </span><span class="delimiter">=</span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>lift</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;asmall::unique_zero_sep_algebra &#8658; &#39;abig::unique_zero_sep_algebra&quot;</span></span></span><span>  
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>project</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;abig &#8658; &#39;asmall&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>carve</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;abig &#8658; &#39;abig&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>splittable</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;abig &#8658; bool&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>lift_pres_zero</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift 0 = 0&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>lift_add_distrib</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a<span class="hidden">&#8681;</span><sub>1</sub>##a<span class="hidden">&#8681;</span><sub>2</sub> &#10233; lift (a<span class="hidden">&#8681;</span><sub>1</sub>+a<span class="hidden">&#8681;</span><sub>2</sub>) = lift a<span class="hidden">&#8681;</span><sub>1</sub> + lift a<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>lift_disj_distrib</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift a<span class="hidden">&#8681;</span><sub>1</sub> ## lift a<span class="hidden">&#8681;</span><sub>2</sub> &#10231; a<span class="hidden">&#8681;</span><sub>1</sub>##a<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>        
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>splittable_lift</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable (lift a)&quot;</span></span></span><span>    
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>splittable_same_struct</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;b<span class="hidden">&#8681;</span><sub>1</sub>##b<span class="hidden">&#8681;</span><sub>2</sub>; splittable b<span class="hidden">&#8681;</span><sub>1</sub>; project b<span class="hidden">&#8681;</span><sub>1</sub>&#8800;0&#10215; &#10233; splittable b<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>        </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*and splittable_same_struct: &quot;&#10214;b<span class="hidden">&#8681;</span><sub>1</sub>##b<span class="hidden">&#8681;</span><sub>2</sub>; b<span class="hidden">&#8681;</span><sub>1</sub>&#8800;0; b<span class="hidden">&#8681;</span><sub>2</sub>&#8800;0&#10215; &#10233; splittable b<span class="hidden">&#8681;</span><sub>2</sub> = splittable b<span class="hidden">&#8681;</span><sub>1</sub>&quot;*)</span></span></span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>splittable_add_distrib</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;b<span class="hidden">&#8681;</span><sub>1</sub>##b<span class="hidden">&#8681;</span><sub>2</sub>&#10215; &#10233; splittable (b<span class="hidden">&#8681;</span><sub>1</sub> + b<span class="hidden">&#8681;</span><sub>2</sub>) &#10231; splittable b<span class="hidden">&#8681;</span><sub>1</sub> &#8743; splittable b<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>        
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>project_pres_zero</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;project 0 = 0&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>project_add_distrib</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;b<span class="hidden">&#8681;</span><sub>1</sub>##b<span class="hidden">&#8681;</span><sub>2</sub>; splittable b<span class="hidden">&#8681;</span><sub>1</sub>; splittable b<span class="hidden">&#8681;</span><sub>2</sub>&#10215; &#10233; project (b<span class="hidden">&#8681;</span><sub>1</sub> + b<span class="hidden">&#8681;</span><sub>2</sub>) = project b<span class="hidden">&#8681;</span><sub>1</sub> + project b<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>project_disj_distrib</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;b<span class="hidden">&#8681;</span><sub>1</sub>##b<span class="hidden">&#8681;</span><sub>2</sub>; splittable b<span class="hidden">&#8681;</span><sub>1</sub>; splittable b<span class="hidden">&#8681;</span><sub>2</sub>&#10215; &#10233; project b<span class="hidden">&#8681;</span><sub>1</sub> ## project b<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>     
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>carve_pres_zero</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;carve 0 = 0&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>carve_add_distrib</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;b<span class="hidden">&#8681;</span><sub>1</sub>##b<span class="hidden">&#8681;</span><sub>2</sub>; splittable b<span class="hidden">&#8681;</span><sub>1</sub>; splittable b<span class="hidden">&#8681;</span><sub>2</sub>&#10215; &#10233; carve (b<span class="hidden">&#8681;</span><sub>1</sub> + b<span class="hidden">&#8681;</span><sub>2</sub>) = carve b<span class="hidden">&#8681;</span><sub>1</sub> + carve b<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>carve_disj_distrib</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;b<span class="hidden">&#8681;</span><sub>1</sub>##b<span class="hidden">&#8681;</span><sub>2</sub>; splittable b<span class="hidden">&#8681;</span><sub>1</sub>; splittable b<span class="hidden">&#8681;</span><sub>2</sub>&#10215; &#10233; carve b<span class="hidden">&#8681;</span><sub>1</sub> ## carve b<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>        
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>project_lift_id</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;project (lift a) = a&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>project_carve_Z</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b &#10233; project (carve b) = 0&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>carve_lift_Z</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;carve (lift a) = 0&quot;</span></span></span><span>
</span><span>    
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>disj_project_imp_lift</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b &#10233; a ## project b &#10233; lift a ## b&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>carve_disj_lift1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b &#10233; carve b ## lift a&quot;</span></span></span><span>
</span><span>                
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>complete_split</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b &#10233; lift (project b) + carve b = b&quot;</span></span></span><span>
</span><span>    
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>carve_not_splittable</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; splittable b &#10233; carve b = b&quot;</span></span></span><span>
</span><span>      </span><span class="comment">&#8213; &#8249;We force carve to be identity outside splittable range. 
        This is an arbitrary fixation of an otherwise unspecified value, which makes 
        some properties simpler to prove (e.g. assoc of composition)
        &#8250;</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>splittableZ</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable 0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>lift_pres_zero</span><span> </span><span>splittable_lift</span><span class="delimiter">)</span><span>
</span><span>        
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>splittable_carve_if</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; splittable p &#10233; splittable (carve p)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>carve_disj_lift1</span><span> </span><span>complete_split</span><span> </span><span>sep_add_commute</span><span> </span><span>splittable_add_distrib</span><span class="delimiter">)</span><span> 
</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>carve_disj_lift</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;carve b ## lift a&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift a ## carve b&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>carve_disj_lift1</span><span> </span><span>carve_disj_lift1</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>sep_disj_commuteI</span><span class="delimiter">]</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_eqZ_iffZ</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift a = 0 &#10231; a=0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>lift_pres_zero</span><span> </span><span>project_lift_id</span><span class="delimiter">)</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>carve_smaller1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable p &#10233; p ## f &#10233; carve p ## f&quot;</span></span></span><span>  
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>carve_disj_lift</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>sep_add_disjD</span><span> </span><span>complete_split</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>carve_smaller</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span> </span><span class="delimiter">=</span><span> </span><span>carve_smaller1</span><span> </span><span>carve_smaller1</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>sep_disj_commuteI</span><span class="delimiter">]</span><span>
</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>disj_project_eq_lift1</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b &#10233; a ## project b &#10231; lift a ## b&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>disj_project_imp_lift</span><span> </span><span>project_disj_distrib</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>disj_project_eq_lift2</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b &#10233; project b ## a &#10231; b ## lift a&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>disj_project_eq_lift1</span><span> </span><span>sep_disj_commuteI</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>disj_project_eq_lift</span><span> </span><span class="delimiter">=</span><span> </span><span>disj_project_eq_lift1</span><span> </span><span>disj_project_eq_lift2</span><span>  
</span><span>        
</span><span>    </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*  
    lemma proj_Z_imp_disj1:
      assumes &quot;project b = 0&quot;
      shows &quot;lift a ## b&quot;
      by (simp add: assms disj_project_imp_lift)
      
    lemmas proj_Z_imp_disj[simp] = proj_Z_imp_disj1 proj_Z_imp_disj1[THEN sep_disj_commuteI]  
    *)</span></span></span></span></span><span>
</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">lemmas</span></span><span> </span><span>split_complete</span><span> </span><span class="delimiter">=</span><span> </span><span>complete_split</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span>
</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>projectZ_add_distrib</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;b<span class="hidden">&#8681;</span><sub>1</sub>##b<span class="hidden">&#8681;</span><sub>2</sub>; splittable b<span class="hidden">&#8681;</span><sub>1</sub>; splittable b<span class="hidden">&#8681;</span><sub>2</sub>&#10215; &#10233; project (b<span class="hidden">&#8681;</span><sub>1</sub> + b<span class="hidden">&#8681;</span><sub>2</sub>) = 0 &#10231; project b<span class="hidden">&#8681;</span><sub>1</sub>=0 &#8743; project b<span class="hidden">&#8681;</span><sub>2</sub>=0&quot;</span></span></span><span>  
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span class="delimiter">)</span><span>
</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>project_add_invE</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;project b = a<span class="hidden">&#8681;</span><sub>1</sub> + a<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a<span class="hidden">&#8681;</span><sub>1</sub>##a<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">obtains</span></span><span> </span><span>b<span class="hidden">&#8681;</span><sub>1</sub></span><span> </span><span>b<span class="hidden">&#8681;</span><sub>2</sub></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;b<span class="hidden">&#8681;</span><sub>1</sub>##b<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;b=b<span class="hidden">&#8681;</span><sub>1</sub>+b<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;project b<span class="hidden">&#8681;</span><sub>1</sub> = a<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;project b<span class="hidden">&#8681;</span><sub>2</sub> = a<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable b<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>lift_add_distrib</span><span> </span><span>lift_disj_distrib</span><span> </span><span>project_add_distrib</span><span> </span><span>project_carve_Z</span><span> </span><span>project_lift_id</span><span> </span><span>sep_add_assoc</span><span> </span><span>sep_lifting_scheme.carve_disj_lift</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>sep_lifting_scheme.disj_project_eq_lift1</span><span> </span><span>sep_lifting_scheme_axioms</span><span> </span><span>split_complete</span><span> </span><span>splittable_add_distrib</span><span class="delimiter">)</span><span>
</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>carve_project_Z_imp_Z</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;carve x = 0; project x = 0&#10215; &#10233; x = 0&quot;</span></span></span><span>  
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>carve_not_splittable</span><span> </span><span>carve_pres_zero</span><span> </span><span>complete_split</span><span> </span><span>project_pres_zero</span><span> </span><span>splittableZ</span><span class="delimiter">)</span><span>
</span><span>      
</span><span>      
</span><span>  </span><span class="keyword2"><span class="keyword">end</span></span><span>        
</span><span>    
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">record</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;asmall</span><span class="delimiter">,</span><span class="tfree">&#39;csmall</span><span class="delimiter">,</span><span class="tfree">&#39;tsmall</span><span class="delimiter">,</span><span class="tfree">&#39;abig</span><span class="delimiter">,</span><span class="tfree">&#39;cbig</span><span class="delimiter">,</span><span class="tfree">&#39;tbig</span><span class="delimiter">)</span><span> </span><span>sep_lifter</span><span> </span><span class="delimiter">=</span><span>
</span><span>    </span><span>lift</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;asmall::unique_zero_sep_algebra &#8658; &#39;abig::unique_zero_sep_algebra&quot;</span></span></span><span>  
</span><span>    </span><span>project</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;abig &#8658; &#39;asmall&quot;</span></span></span><span>
</span><span>    </span><span>carve</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;abig &#8658; &#39;abig&quot;</span></span></span><span>
</span><span>    </span><span>splittable</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;abig &#8658; bool&quot;</span></span></span><span>
</span><span>    
</span><span>    </span><span>L</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;csmall &#10233; &#39;cbig&quot;</span></span></span><span>
</span><span>    </span><span>&#945;b</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;cbig &#8658; &#39;abig&quot;</span></span></span><span>
</span><span>    </span><span>&#945;s</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;csmall &#8658; &#39;asmall&quot;</span></span></span><span>
</span><span>    
</span><span>    </span><span>tyb</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;cbig &#8658; &#39;tbig&quot;</span></span></span><span>
</span><span>    </span><span>tys</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;csmall &#8658; &#39;tsmall&quot;</span></span></span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">hide_const</span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="delimiter">)</span><span> </span><span>lift</span><span> </span><span>project</span><span> </span><span>carve</span><span> </span><span>splittable</span><span> </span><span>L</span><span> </span><span>&#945;b</span><span> </span><span>&#945;s</span><span> </span><span>tyb</span><span> </span><span>tys</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>pre_sep_lifter</span><span> </span><span class="delimiter">=</span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>LFT</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;asmall::unique_zero_sep_algebra,&#39;csmall,&#39;tsmall,&#39;abig::unique_zero_sep_algebra,&#39;cbig,&#39;tbig) sep_lifter&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>lift</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift &#8801; sep_lifter.lift LFT&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>project</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;project &#8801; sep_lifter.project LFT&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>carve</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;carve &#8801; sep_lifter.carve LFT&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>splittable</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable &#8801; sep_lifter.splittable LFT&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>L</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;L &#8801; sep_lifter.L LFT&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>&#945;b</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#945;b &#8801; sep_lifter.&#945;b LFT&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>&#945;s</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#945;s &#8801; sep_lifter.&#945;s LFT&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>tyb</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;tyb &#8801; sep_lifter.tyb LFT&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>tys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;tys &#8801; sep_lifter.tys LFT&quot;</span></span></span><span>
</span><span>    
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift_assn P b &#8801; splittable b &#8743; carve b = 0 &#8743; (P (project b))&quot;</span></span></span><span>
</span><span>
</span><span>    
</span><span>  </span><span class="keyword2"><span class="keyword">end</span></span><span>  
</span><span>  
</span><span>      
</span><span>  </span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>sep_lifter</span><span> </span><span class="delimiter">=</span><span> </span><span>pre_sep_lifter</span><span> </span><span>LFT</span><span> </span><span class="delimiter">+</span><span> </span><span>sep_lifting_scheme</span><span> </span><span>lift</span><span> </span><span>project</span><span> </span><span>carve</span><span> </span><span>splittable</span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>LFT</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;asmall::unique_zero_sep_algebra,&#39;csmall,&#39;tsmall,&#39;abig::unique_zero_sep_algebra,&#39;cbig,&#39;tbig) sep_lifter&quot;</span></span></span><span> </span><span class="delimiter">+</span><span>
</span><span>    
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>lensL</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;hlens L&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>precond</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;splittable (&#945;b cb); project (&#945;b cb)&#8800;0&#10215; &#10233; pre_get L cb &#8743; pre_put L cb&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>get_xfer</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;splittable (&#945;b cb); project (&#945;b cb)&#8800;0&#10215; &#10233; &#945;s (get&#39; L cb) = project (&#945;b cb)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>put_xfer</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;splittable (&#945;b cb); project (&#945;b cb)&#8800;0; tys x = tys (get&#39; L cb)&#10215; 
      &#10233; &#945;b (put&#39; L x cb) = lift (&#945;s x) + carve (&#945;b cb)&quot;</span></span></span><span>
</span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>ty_put_xfer</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;pre_get L cb; tys x = tys (get&#39; L cb) &#10215; &#10233; tyb (put&#39; L x cb) = tyb cb&quot;</span></span></span><span>
</span><span>      
</span><span>  </span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>sep_lifter_axioms</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">]</span><span>
</span><span>  
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_assn_distrib</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift_assn (P**Q) = (lift_assn P ** lift_assn Q)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>sep_conj_def</span><span> </span><span>lift_assn_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>erule</span><span> </span><span>project_add_invE</span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>force</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_assn_EXACT_eq</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift_assn (EXACT v) = EXACT (lift v)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lift_assn_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>split_complete</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_assn_pure</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift_assn (&#8593;&#934;) = &#8593;&#934;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_assn_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>pred_lift_extract_simps</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>carve_project_Z_imp_Z</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_assn_empty</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift_assn &#9633; = &#9633;&quot;</span></span></span><span>  
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_assn_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>sep_algebra_simps</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>carve_project_Z_imp_Z</span><span class="delimiter">)</span><span>
</span><span>            
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_ty</span><span class="delimiter">:</span><span>   
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>PRESTY</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;s. wlp c (&#955;_ s&#39;. tys s&#39; = tys s) s&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;wlp (zoom (lift_lens e L) c) (&#955;_ s&#39;. tyb s&#39; = tyb s) s&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>PRESTY</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>wlp_def</span><span> </span><span>run_simps</span><span> </span><span>split</span><span class="delimiter">:</span><span> </span><span>option.splits</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>meta_spec</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;get&#39; L s&quot;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>erule</span><span> </span><span>mwp_cons</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>      
</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>infer_pre_get_with_frame</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lift_assn P p&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;p ## f&quot;</span></span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#945;b s = p + f&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>NZ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;P 0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre_get L s&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>precond</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>conjunct1</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>splittable_same_struct</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_assn_def</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span class="delimiter">+</span><span>
</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_operation</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>NZ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;P 0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>PRESTY</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;s. wlp c (&#955;_ s&#39;. tys s&#39; = tys s) s&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>HT</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;htriple &#945;s P c Q&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;htriple &#945;b (lift_assn P) (zoom (lift_lens e L) c) (&#955;r. lift_assn (Q r))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>htripleI&#39;</span><span class="delimiter">;</span><span> </span><span>clarsimp</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lift_assn_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>p</span><span> </span><span>s</span><span> </span><span>f</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;p ## f&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#945;b s = p + f&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable p&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;carve p = 0&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P (project p)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;project p&#8800;0&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;p&#8800;0&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;p##f&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;f##p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>NZ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>sep_algebra_simps</span><span class="delimiter">)</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;splittable f&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>A</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;project p &#8800; 0&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;splittable p&#8250;</span></span></span><span> </span><span>splittable_same_struct</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>A</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>OFR</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#945;b s = lift (project (p + f)) + carve (p+f)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rewrite</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;_ = &#8977;&quot;</span></span></span><span> </span><span>complete_split</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp_all</span><span>
</span><span>        
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;project (&#945;b s) &#8800; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>A</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>HT&#39;</span><span class="delimiter">=</span><span> </span><span>htripleD&#39;</span><span class="delimiter">[</span><span>OF</span><span> </span><span>HT</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;P (project p)&#8250;</span></span></span><span class="delimiter">,</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>f</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;project f&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;get&#39; L s&quot;</span></span></span><span class="delimiter">,</span><span> </span><span>simplified</span><span class="delimiter">]</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>PRESTY</span><span> </span><span>HT&#39;</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>HT&#39;</span><span class="delimiter">:</span><span> 
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;wp c (&#955;r s&#39;. tys s&#39; = tys (get&#39; L s) &#8743; (&#8707;p&#39;. p&#39; ## project f &#8743; &#945;s s&#39; = p&#39; + project f &#8743; Q r p&#39;)) (get&#39; L s)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>wlp_def</span><span> </span><span>wp_def</span><span> </span><span>mwp_def</span><span> </span><span>split</span><span class="delimiter">:</span><span> </span><span>mres.splits</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>meta_spec</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;get&#39; L s&quot;</span></span></span><span class="delimiter">]</span><span class="delimiter">;</span><span> </span><span>simp</span><span class="delimiter">)</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* FIXME: Why can&#39;t we solve that goal in one line? *)</span></span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>HT&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span>HT&#39;</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>wp_def</span><span class="delimiter">]</span><span>
</span><span>
</span><span>      </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*from precond have [simp]: &quot;pre_get L s&quot; &quot;pre_put L s&quot; by auto*)</span></span></span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">note</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span> </span><span class="delimiter">=</span><span> </span><span>precond</span><span>
</span><span>      
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;wp (zoom (lift_lens e L) c) (&#955;r s&#39;. &#8707;p&#39;. p&#39; ## f &#8743; &#945;b s&#39; = p&#39; + f &#8743; splittable p&#39; &#8743; carve p&#39; = 0 &#8743; Q r (project p&#39;)) s&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>wp_def</span><span> </span><span>run_simps</span><span> </span><span>split</span><span class="delimiter">:</span><span> </span><span>option.splits</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>mwp_cons</span><span class="delimiter">[</span><span>OF</span><span> </span><span>HT&#39;</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>clarsimp_all</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x</span><span> </span><span>s&#39;</span><span> </span><span>p&#39;</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;lift p&#39; + carve p&quot;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>disj_project_eq_lift</span><span> </span><span>sep_algebra_simps</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rewrite</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;_=&#8977;&quot;</span></span></span><span> </span><span>split_complete</span><span class="delimiter">[</span><span>of</span><span> </span><span>f</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>disj_project_eq_lift</span><span> </span><span>sep_algebra_simps</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    
</span><span>  </span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;list&#945; &#945; l i &#8801; if i&lt;length l then &#945; (l!i) else (0::_::unique_zero_sep_algebra)&quot;</span></span></span><span>  
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>list&#945;_Nil</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;list&#945; &#945; [] = 0&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>list&#945;_def</span><span class="delimiter">)</span><span>
</span><span>  
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>list&#945;_upd</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length xs &#10233; list&#945; &#945; (xs[i := x]) = (list&#945; &#945; xs)(i:=&#945; x)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>list&#945;_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;idx_lifter tys &#945;s i &#8801; &#10631; 
    sep_lifter.lift = fun_upd (&#955;x. 0) i,
    sep_lifter.project = (&#955;f. f i),
    sep_lifter.carve = (&#955;f. f(i:=0)),
    sep_lifter.splittable = (&#955;f. True),
    sep_lifter.L = idx<span class="hidden">&#8681;</span><sub>L</sub> i,
    sep_lifter.&#945;b = list&#945; &#945;s,
    sep_lifter.&#945;s = &#945;s,
    sep_lifter.tyb = map tys,
    sep_lifter.tys = tys
        &#10632;&quot;</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>idx_lifter_simps</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>      
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.lift (idx_lifter tys &#945;s i) = fun_upd (&#955;x. 0) i&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.project (idx_lifter tys &#945;s i) = (&#955;f. f i)&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.carve (idx_lifter tys &#945;s i) = (&#955;f. f(i:=0))&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.splittable (idx_lifter tys &#945;s i) = (&#955;f. True)&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.L (idx_lifter tys &#945;s i) = idx<span class="hidden">&#8681;</span><sub>L</sub> i&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.&#945;b (idx_lifter tys &#945;s i) = list&#945; &#945;s&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.&#945;s (idx_lifter tys &#945;s i) = &#945;s&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.tyb (idx_lifter tys &#945;s i) = map tys&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.tys (idx_lifter tys &#945;s i) = tys&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>idx_lifter_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span>            
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>idx_lifter</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter (idx_lifter tys &#945;s i)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>unfold_locales</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp_all</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>idx_lifter_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>sep_algebra_simps</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>sep_disj_fun_def</span><span> </span><span>sep_algebra_simps</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;f(i:=0::&#39;a)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>f</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>list&#945;_def</span><span class="delimiter">[</span><span>abs_def</span><span class="delimiter">]</span><span> </span><span>nth_list_update</span><span> </span><span>map_upd_eq</span><span> </span><span>split</span><span class="delimiter">:</span><span> </span><span>if_splits</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>option&#945;</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;c &#8658; &#39;a) &#8658; &#39;c option &#8658; &#39;a::unique_zero_sep_algebra&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;option&#945; &#945; None = 0&quot;</span></span></span><span> </span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;option&#945; &#945; (Some x) = &#945; x&quot;</span></span></span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>option&#945;_alt</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;option&#945; &#945; x = (case x of None &#8658; 0 | Some y &#8658; &#945; y)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>x</span><span class="delimiter">)</span><span> </span><span>auto</span><span> 
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;option_lifter tys &#945;s &#8801; &#10631;
    sep_lifter.lift = id,
    sep_lifter.project = id,
    sep_lifter.carve = &#955;_. 0,
    sep_lifter.splittable = (&#955;f. True),
    sep_lifter.L = the<span class="hidden">&#8681;</span><sub>L</sub>,
    sep_lifter.&#945;b = option&#945; &#945;s,
    sep_lifter.&#945;s = &#945;s,
    sep_lifter.tyb = map_option tys,
    sep_lifter.tys = tys
  &#10632;&quot;</span></span></span><span>  
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>option_lifter_simps</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.lift (option_lifter tys &#945;s) = id&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.project (option_lifter tys &#945;s) = id&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.carve (option_lifter tys &#945;s) = (&#955;_. 0)&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.splittable (option_lifter tys &#945;s) = (&#955;f. True)&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.L (option_lifter tys &#945;s) = the<span class="hidden">&#8681;</span><sub>L</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.&#945;b (option_lifter tys &#945;s) = option&#945; &#945;s&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.&#945;s (option_lifter tys &#945;s) = &#945;s&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.tyb (option_lifter tys &#945;s) = map_option tys&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.tys (option_lifter tys &#945;s) = tys&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>option_lifter_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  
</span><span>  
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>option_lifter</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter (option_lifter tys &#945;s)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>unfold_locales</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>option_lifter_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>option&#945;_alt</span><span> </span><span>split</span><span class="delimiter">:</span><span> </span><span>option.splits</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;compose_splittable l<span class="hidden">&#8681;</span><sub>1</sub> l<span class="hidden">&#8681;</span><sub>2</sub> &#8801; (&#955;x. sep_lifter.splittable l<span class="hidden">&#8681;</span><sub>2</sub> x &#8743; sep_lifter.splittable l<span class="hidden">&#8681;</span><sub>1</sub> (sep_lifter.project l<span class="hidden">&#8681;</span><sub>2</sub> x))&quot;</span></span></span><span>  
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;compose_carve l<span class="hidden">&#8681;</span><sub>1</sub> l<span class="hidden">&#8681;</span><sub>2</sub> &#8801; &#955;x. 
    if compose_splittable l<span class="hidden">&#8681;</span><sub>1</sub> l<span class="hidden">&#8681;</span><sub>2</sub> x then
      sep_lifter.carve l<span class="hidden">&#8681;</span><sub>2</sub> x + sep_lifter.lift l<span class="hidden">&#8681;</span><sub>2</sub> ( sep_lifter.carve l<span class="hidden">&#8681;</span><sub>1</sub> (sep_lifter.project l<span class="hidden">&#8681;</span><sub>2</sub> x))
    else x&quot;</span></span></span><span>  
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">definition</span></span><span> 
</span><span>    </span><span>compose_lifter</span><span> </span><span class="delimiter">::</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;as::unique_zero_sep_algebra,&#39;cs,&#39;ts,&#39;ab::unique_zero_sep_algebra,&#39;cb,&#39;tb) sep_lifter 
      &#8658; (&#39;ab,&#39;cb,&#39;tb,&#39;al::unique_zero_sep_algebra,&#39;cl,&#39;tl) sep_lifter
      &#8658; (&#39;as, &#39;cs, &#39;ts, &#39;al, &#39;cl, &#39;tl) sep_lifter&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">infixl</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub>&quot;</span></span></span><span> </span><span>80</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;compose_lifter l<span class="hidden">&#8681;</span><sub>1</sub> l<span class="hidden">&#8681;</span><sub>2</sub> &#8801; &#10631;
    sep_lifter.lift = sep_lifter.lift l<span class="hidden">&#8681;</span><sub>2</sub> o sep_lifter.lift l<span class="hidden">&#8681;</span><sub>1</sub>,
    sep_lifter.project = sep_lifter.project l<span class="hidden">&#8681;</span><sub>1</sub> o sep_lifter.project l<span class="hidden">&#8681;</span><sub>2</sub>,
    sep_lifter.carve = compose_carve l<span class="hidden">&#8681;</span><sub>1</sub> l<span class="hidden">&#8681;</span><sub>2</sub>,
    sep_lifter.splittable = compose_splittable l<span class="hidden">&#8681;</span><sub>1</sub> l<span class="hidden">&#8681;</span><sub>2</sub>,
    sep_lifter.L = sep_lifter.L l<span class="hidden">&#8681;</span><sub>2</sub> &#8729;<span class="hidden">&#8681;</span><sub>L</sub> sep_lifter.L l<span class="hidden">&#8681;</span><sub>1</sub>,
    sep_lifter.&#945;b = sep_lifter.&#945;b l<span class="hidden">&#8681;</span><sub>2</sub>,
    sep_lifter.&#945;s = sep_lifter.&#945;s l<span class="hidden">&#8681;</span><sub>1</sub>,
    sep_lifter.tyb = sep_lifter.tyb l<span class="hidden">&#8681;</span><sub>2</sub>,
    sep_lifter.tys = sep_lifter.tys l<span class="hidden">&#8681;</span><sub>1</sub>
  &#10632;&quot;</span></span></span><span>  
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>compose_lifter_simps</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.lift (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) = sep_lifter.lift l<span class="hidden">&#8681;</span><sub>2</sub> o sep_lifter.lift l<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.project (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) = sep_lifter.project l<span class="hidden">&#8681;</span><sub>1</sub> o sep_lifter.project l<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.carve (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) = compose_carve l<span class="hidden">&#8681;</span><sub>1</sub> l<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.splittable (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) = compose_splittable l<span class="hidden">&#8681;</span><sub>1</sub> l<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.L (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) = sep_lifter.L l<span class="hidden">&#8681;</span><sub>2</sub> &#8729;<span class="hidden">&#8681;</span><sub>L</sub> sep_lifter.L l<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.&#945;b (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) = sep_lifter.&#945;b l<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.&#945;s (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) = sep_lifter.&#945;s l<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.tyb (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) = sep_lifter.tyb l<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.tys (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) = sep_lifter.tys l<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>compose_lifter_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                              
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>compose_sep_lifter</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>l<span class="hidden">&#8681;</span><sub>1</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;as::unique_zero_sep_algebra, &#39;cs, &#39;ts, &#39;ab::unique_zero_sep_algebra, &#39;cb, &#39;tb) sep_lifter&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>l<span class="hidden">&#8681;</span><sub>2</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;ab, &#39;cb, &#39;tb, &#39;al::unique_zero_sep_algebra, &#39;cl, &#39;tl) sep_lifter&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter l<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter l<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>&#945;EQ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.&#945;s l<span class="hidden">&#8681;</span><sub>2</sub> = sep_lifter.&#945;b l<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>tEQ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.tys l<span class="hidden">&#8681;</span><sub>2</sub> = sep_lifter.tyb l<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter (compose_lifter l<span class="hidden">&#8681;</span><sub>1</sub> l<span class="hidden">&#8681;</span><sub>2</sub>)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>l1</span><span class="delimiter">:</span><span> </span><span>sep_lifter</span><span> </span><span>l<span class="hidden">&#8681;</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>l2</span><span class="delimiter">:</span><span> </span><span>sep_lifter</span><span> </span><span>l<span class="hidden">&#8681;</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>unfold_locales</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>clarsimp_all</span><span> 
</span><span>        </span><span>simp</span><span class="delimiter">:</span><span> </span><span>compose_lifter_def</span><span> </span><span>compose_carve_def</span><span> </span><span>compose_splittable_def</span><span>
</span><span>        </span><span>simp</span><span class="delimiter">:</span><span> </span><span>sep_algebra_simps</span><span> 
</span><span>        </span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l1.splittable_same_struct</span><span> </span><span>l2.splittable_same_struct</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>     
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>clarsimp</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>l1.disj_project_eq_lift</span><span> </span><span>l2.disj_project_eq_lift</span><span> </span><span>sep_algebra_simps</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rewrite</span><span> </span><span>at</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;_=&#8977;&quot;</span></span></span><span> </span><span>l2.split_complete</span><span class="delimiter">,</span><span> </span><span>assumption</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rewrite</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;_=&#8977;&quot;</span></span></span><span> </span><span>l1.split_complete</span><span class="delimiter">,</span><span> </span><span>assumption</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>sep_algebra_simps</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>goal_cases</span><span>  
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>cb</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>A</span><span class="delimiter">:</span><span> 
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;l1.project (l2.project (l2.&#945;b cb)) &#8800; 0&quot;</span></span></span><span>
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;l2.splittable (l2.&#945;b cb)&quot;</span></span></span><span>
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;l1.splittable (l2.project (l2.&#945;b cb))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre_get l2.L cb &#8743; pre_get l1.L (get&#39; l2.L cb)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#945;EQ</span><span> </span><span>l2.precond</span><span> </span><span>l1.sep_lifter_axioms</span><span> </span><span>l2.sep_lifter_axioms</span><span> </span><span>sep_lifter.get_xfer</span><span> </span><span>sep_lifter.precond</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          
</span><span>          
</span><span>        </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre_get l2.L cb&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre_get l1.L (get&#39; l2.L cb)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>A</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l1.&#945;s (get&#39; (l2.L &#8729;<span class="hidden">&#8681;</span><sub>L</sub> l1.L) cb) = l1.project (l2.project (l2.&#945;b cb))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#945;EQ</span><span> </span><span>l2.sep_lifter_axioms</span><span> </span><span>sep_lifter.get_xfer</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span>  
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l1.tys x = l1.tys (get&#39; (l2.L &#8729;<span class="hidden">&#8681;</span><sub>L</sub> l1.L) cb)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>A</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l2.&#945;b (put&#39; (l2.L &#8729;<span class="hidden">&#8681;</span><sub>L</sub> l1.L) x cb) =
            l2.carve (l2.&#945;b cb) 
          + (l2.lift (l1.lift (l1.&#945;s x)) 
              + l2.lift (l1.carve (l2.project (l2.&#945;b cb))))&quot;</span></span></span><span>  
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>l2.put_xfer</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tEQ</span><span class="delimiter">)</span><span> </span><span class="delimiter">[</span><span>3</span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>l1.put_xfer</span><span class="delimiter">[</span><span>folded</span><span> </span><span>&#945;EQ</span><span class="delimiter">]</span><span class="delimiter">;</span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>l2.get_xfer</span><span class="delimiter">)</span><span class="delimiter">?</span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>sep_algebra_simps</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>          
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>tEQ</span><span class="delimiter">)</span><span>
</span><span>      
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>    
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>compose_lifter_assoc</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter l<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter l<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter l<span class="hidden">&#8681;</span><sub>3</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>3</sub> = l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> (l<span class="hidden">&#8681;</span><sub>2</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>3</sub>)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>l1</span><span class="delimiter">:</span><span> </span><span>sep_lifter</span><span> </span><span>l<span class="hidden">&#8681;</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>l2</span><span class="delimiter">:</span><span> </span><span>sep_lifter</span><span> </span><span>l<span class="hidden">&#8681;</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>l3</span><span class="delimiter">:</span><span> </span><span>sep_lifter</span><span> </span><span>l<span class="hidden">&#8681;</span><sub>3</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>compose_lifter_def</span><span> </span><span>compose_carve_def</span><span> </span><span>compose_splittable_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>ext</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ext</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>sep_algebra_simps</span><span class="delimiter">)</span><span>
</span><span>      
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lift_assn_compose</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter l<span class="hidden">&#8681;</span><sub>1</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter l<span class="hidden">&#8681;</span><sub>2</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre_sep_lifter.lift_assn (l<span class="hidden">&#8681;</span><sub>1</sub> &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l<span class="hidden">&#8681;</span><sub>2</sub>) P = pre_sep_lifter.lift_assn l<span class="hidden">&#8681;</span><sub>2</sub> (pre_sep_lifter.lift_assn l<span class="hidden">&#8681;</span><sub>1</sub> P)&quot;</span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>l1</span><span class="delimiter">:</span><span> </span><span>sep_lifter</span><span> </span><span>l<span class="hidden">&#8681;</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>l2</span><span class="delimiter">:</span><span> </span><span>sep_lifter</span><span> </span><span>l<span class="hidden">&#8681;</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>  
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>  
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>pre_sep_lifter.lift_assn_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>compose_lifter_def</span><span> </span><span>compose_splittable_def</span><span> </span><span>compose_carve_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;id_lifter ty &#945; &#8801; &#10631;
    sep_lifter.lift = id,
    sep_lifter.project = id,
    sep_lifter.carve = &#955;x. 0,
    sep_lifter.splittable = (&#955;f. True),
    sep_lifter.L = id<span class="hidden">&#8681;</span><sub>L</sub>,
    sep_lifter.&#945;b = &#945;,
    sep_lifter.&#945;s = &#945;,
    sep_lifter.tyb = ty,
    sep_lifter.tys = ty
  &#10632;&quot;</span></span></span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>id_lifter_simps</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.lift (id_lifter ty &#945;) = id&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.project (id_lifter ty &#945;) = id&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.carve (id_lifter ty &#945;) = (&#955;x. 0)&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.splittable (id_lifter ty &#945;) = (&#955;f. True)&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.L (id_lifter ty &#945;) = id<span class="hidden">&#8681;</span><sub>L</sub>&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.&#945;b (id_lifter ty &#945;) = &#945;&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.&#945;s (id_lifter ty &#945;) = &#945;&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.tyb (id_lifter ty &#945;) = ty&quot;</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter.tys (id_lifter ty &#945;) = ty&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>id_lifter_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    
</span><span>  
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>id_lifter</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter (id_lifter ty &#945;)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>unfold_locales</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>id_lifter_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>compose_lifter_id_left</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;id_lifter (sep_lifter.tys l) (sep_lifter.&#945;s l) &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> l = l&quot;</span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>sep_lifter</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;compose_carve (id_lifter (sep_lifter.tys l) (sep_lifter.&#945;s l)) l = carve&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>compose_carve_def</span><span> </span><span>compose_splittable_def</span><span> </span><span>id_lifter_def</span><span class="delimiter">)</span><span>
</span><span>    
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>compose_lifter_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>compose_splittable_def</span><span> </span><span>id_lifter_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>compose_lifter_id_right</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_lifter l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l &#8729;<span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>f</sub><span class="hidden">&#8681;</span><sub>t</sub> (id_lifter (sep_lifter.tyb l) (sep_lifter.&#945;b l)) = l&quot;</span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">interpret</span></span><span> </span><span>sep_lifter</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;compose_carve l (id_lifter (sep_lifter.tyb l) (sep_lifter.&#945;b l)) = carve&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>compose_carve_def</span><span> </span><span>compose_splittable_def</span><span> </span><span>id_lifter_def</span><span class="delimiter">)</span><span>
</span><span>    
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>compose_lifter_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>compose_splittable_def</span><span> </span><span>id_lifter_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>      
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>    
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>

</div>
</body>
<div class=body><footer><p><table border=0  width=700> <tr><th>Isabelle version:</th><th>AFP version:</th><th>IsaFoL version:</th><th>Last compilation:</th></tr>

<tr><td align="center">Isabelle2019 </td><td align="center">93cdb54371e6+ </td><td align="center">5222ffd4 </td><td align="center">Fri 06 Dec 2019 02:43:15 PM CET </td></tr></table></p><a href="https://imprint.mpi-klsb.mpg.de/mpi/mfleury">Imprint</a> / <a href="https://data-protection.mpi-klsb.mpg.de/mpi/mfleury">Data Protection</a></footer></div>

</html>


