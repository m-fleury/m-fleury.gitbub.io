<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory IsaSAT_Conflict_Analysis (Isabelle2020: April 2020)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory IsaSAT_Conflict_Analysis</h1>

<span class="command">theory</span> <span class="name">IsaSAT_Conflict_Analysis</span><br/>
<span class="keyword">imports</span> <a href="IsaSAT_VMTF.html"><span class="name">IsaSAT_VMTF</span></a> <a href="IsaSAT_LBD.html"><span class="name">IsaSAT_LBD</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">theory</span></span><span> </span><span>IsaSAT_Conflict_Analysis</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>IsaSAT_Setup</span><span> </span><span>IsaSAT_VMTF</span><span> </span><span>IsaSAT_LBD</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">paragraph</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Skip and resolve&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>maximum_level_removed_eq_count_dec</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;maximum_level_removed_eq_count_dec L S &#10231;
      get_maximum_level_remove (get_trail_wl S) (the (get_conflict_wl S)) L =
       count_decided (get_trail_wl S)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>maximum_level_removed_eq_count_dec_pre</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;maximum_level_removed_eq_count_dec_pre =
     (&#955;(L, S). L = -lit_of (hd (get_trail_wl S)) &#8743; L &#8712;# the (get_conflict_wl S) &#8743;
      get_conflict_wl S &#8800; None &#8743; get_trail_wl S &#8800; [] &#8743; count_decided (get_trail_wl S) &#8805; 1)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>maximum_level_removed_eq_count_dec_heur</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;maximum_level_removed_eq_count_dec_heur L S =
      RETURN (get_count_max_lvls_heur S &gt; 1)&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>maximum_level_removed_eq_count_dec_heur_maximum_level_removed_eq_count_dec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(uncurry maximum_level_removed_eq_count_dec_heur,
      uncurry mop_maximum_level_removed_wl) &#8712;
   [&#955;_. True]<span class="hidden">&#8681;</span><sub>f</sub>
    Id &#215;<span class="hidden">&#8681;</span><sub>r</sub> twl_st_heur_conflict_ana &#8594; &#10216;bool_rel&#10217;nres_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>maximum_level_removed_eq_count_dec_heur_def</span><span> </span><span>mop_maximum_level_removed_wl_def</span><span>
</span><span>    </span><span>uncurry_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>frefI</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x</span><span> </span><span>y</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>refine_rcg</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>x</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>count_decided_st_def</span><span> </span><span>counts_maximum_level_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span>
</span><span>      </span><span>maximum_level_removed_eq_count_dec_heur_def</span><span> </span><span>maximum_level_removed_eq_count_dec_def</span><span>
</span><span>      </span><span>maximum_level_removed_eq_count_dec_pre_def</span><span> </span><span>mop_maximum_level_removed_wl_pre_def</span><span>
</span><span>     </span><span>mop_maximum_level_removed_l_pre_def</span><span> </span><span>mop_maximum_level_removed_pre_def</span><span> </span><span>state_wl_l_def</span><span>
</span><span>     </span><span>twl_st_l_def</span><span> </span><span>get_maximum_level_card_max_lvl_ge1</span><span> </span><span>card_max_lvl_remove_hd_trail_iff</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>get_trail_wl_heur_def</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl_heur = (&#955;(M, S). M)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>ext</span><span class="delimiter">,</span><span> </span><span>rename_tac</span><span> </span><span>S</span><span class="delimiter">,</span><span> </span><span>case_tac</span><span> </span><span>S</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>lit_and_ann_of_propagated_st</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat twl_st_wl &#8658; nat literal &#215; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lit_and_ann_of_propagated_st S = lit_and_ann_of_propagated (hd (get_trail_wl S))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>lit_and_ann_of_propagated_st_heur</span><span>
</span><span>   </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;twl_st_wl_heur &#8658; (nat literal &#215; nat) nres&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lit_and_ann_of_propagated_st_heur = (&#955;((M, _, _, reasons, _), _). do {
     ASSERT(M &#8800; [] &#8743; atm_of (last M) &lt; length reasons);
     RETURN (last M, reasons ! (atm_of (last M)))})&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lit_and_ann_of_propagated_st_heur_lit_and_ann_of_propagated_st</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(lit_and_ann_of_propagated_st_heur, mop_hd_trail_wl) &#8712;
   [&#955;S. True]<span class="hidden">&#8681;</span><sub>f</sub> twl_st_heur_conflict_ana &#8594; &#10216;Id &#215;<span class="hidden">&#8681;</span><sub>f</sub> Id&#10217;nres_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>frefI</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lit_and_ann_of_propagated_st_heur_def</span><span> </span><span>mop_hd_trail_wl_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>refine_rcg</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>mop_hd_trail_wl_def</span><span> </span><span>mop_hd_trail_wl_pre_def</span><span>
</span><span>     </span><span>mop_hd_trail_l_pre_def</span><span> </span><span>twl_st_l_def</span><span> </span><span>state_wl_l_def</span><span> </span><span>mop_hd_trail_pre_def</span><span> </span><span>last_rev</span><span> </span><span>hd_map</span><span>
</span><span>      </span><span>lit_and_ann_of_propagated_st_def</span><span> </span><span>trail_pol_alt_def</span><span> </span><span>ann_lits_split_reasons_def</span><span>
</span><span>    </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ASSERT_leI</span><span> </span><span>ASSERT_refine_right</span><span> </span><span>simp</span><span> </span><span>flip</span><span class="delimiter">:</span><span> </span><span>rev_map</span><span> </span><span>elim</span><span class="delimiter">:</span><span> </span><span>is_propedE</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>elim</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>is_propedE</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>tl_state_wl_heur_pre</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;twl_st_wl_heur &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl_state_wl_heur_pre =
      (&#955;(M, N, D, WS, Q, ((A, m, fst_As, lst_As, next_search), to_remove), _). fst M &#8800; [] &#8743;
         tl_trailt_tr_pre M &#8743;
	 vmtf_unset_pre (atm_of (last (fst M))) ((A, m, fst_As, lst_As, next_search), to_remove) &#8743;
         atm_of (last (fst M)) &lt; length A &#8743;
         (next_search &#8800; None &#10230;  the next_search &lt; length A))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>tl_state_wl_heur</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;twl_st_wl_heur &#8658; (bool &#215; twl_st_wl_heur) nres&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl_state_wl_heur = (&#955;(M, N, D, WS, Q, vmtf, clvls). do {
       ASSERT(tl_state_wl_heur_pre (M, N, D, WS, Q, vmtf, clvls));
       RETURN (False, (tl_trailt_tr M, N, D, WS, Q, isa_vmtf_unset (atm_of (lit_of_last_trail_pol M)) vmtf, clvls))
  })&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tl_state_wl_heur_alt_def</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl_state_wl_heur = (&#955;(M, N, D, WS, Q, vmtf, clvls). do {
       ASSERT(tl_state_wl_heur_pre (M, N, D, WS, Q, vmtf, clvls));
       let L = lit_of_last_trail_pol M;
       RETURN (False, (tl_trailt_tr M, N, D, WS, Q, isa_vmtf_unset (atm_of L) vmtf, clvls))
    })&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tl_state_wl_heur_def</span><span> </span><span>Let_def</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ext</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>tl_state_wl_pre</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl_state_wl_pre S &#10231; get_trail_wl S &#8800; [] &#8743;
     literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_trail (all_atms_st S) (get_trail_wl S) &#8743;
     (lit_of (hd (get_trail_wl S))) &#8713;# the (get_conflict_wl S) &#8743;
     -(lit_of (hd (get_trail_wl S))) &#8713;# the (get_conflict_wl S) &#8743;
    &#172;tautology (the (get_conflict_wl S)) &#8743;
    distinct_mset (the (get_conflict_wl S)) &#8743;
    &#172;is_decided (hd (get_trail_wl S)) &#8743;
    count_decided (get_trail_wl S) &gt; 0&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tl_state_out_learned</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lit_of (hd a) &#8713;# the at &#10233;
       - lit_of (hd a) &#8713;# the at &#10233;
       &#172; is_decided (hd a) &#10233;
       out_learned (tl a) at an &#10231; out_learned a at an&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>a</span><span class="delimiter">)</span><span>  </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>out_learned_def</span><span> </span><span>get_level_cons_if</span><span> </span><span>atm_of_eq_atm_of</span><span>
</span><span>      </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>filter_mset_cong</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>mop_tl_state_wl_pre_tl_state_wl_heur_pre</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(x, y) &#8712; twl_st_heur_conflict_ana &#10233; mop_tl_state_wl_pre y &#10233; tl_state_wl_heur_pre x&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tl_trailt_tr_pre</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl y&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl_heur x&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st y&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>mop_tl_state_wl_pre_def</span><span> </span><span>tl_state_wl_heur_pre_def</span><span> </span><span>mop_tl_state_l_pre_def</span><span>
</span><span>    </span><span>mop_tl_state_pre_def</span><span> </span><span>tl_state_wl_heur_pre_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>state_wl_l_def</span><span> </span><span>twl_st_l_def</span><span> </span><span>trail_pol_alt_def</span><span>
</span><span>      </span><span>rev_map</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>last_rev</span><span> </span><span>hd_map</span><span>
</span><span>    </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>vmtf_unset_pre&#39;</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>M</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl y&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>neq_Nil_conv</span><span> </span><span>literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_trail_Cons</span><span> </span><span>phase_saving_def</span><span> </span><span>isa_vmtf_def</span><span>
</span><span>      </span><span>vmtf_def</span><span>
</span><span>    </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>mop_tl_state_wl_pre_simps</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mop_tl_state_wl_pre ([], ax, ay, az, bga, NS, US, bh, bi) &#10231; False&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mop_tl_state_wl_pre (xa, ax, ay, az, bga, NS, US, bh, bi) &#10233;
     lit_of (hd xa) &#8712;# &#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub> (all_atms ax (az + bga + NS + US))&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mop_tl_state_wl_pre (xa, ax, ay, az, bga, NS, US, bh, bi) &#10233; lit_of (hd xa) &#8713;# the ay&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mop_tl_state_wl_pre (xa, ax, ay, az, bga, NS, US, bh, bi) &#10233; -lit_of (hd xa) &#8713;# the ay&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mop_tl_state_wl_pre (xa, ax, Some ay&#39;, az, bga, NS, US, bh, bi) &#10233; lit_of (hd xa) &#8713;# ay&#39;&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mop_tl_state_wl_pre (xa, ax, Some ay&#39;, az, bga, NS, US, bh, bi) &#10233; -lit_of (hd xa) &#8713;# ay&#39;&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mop_tl_state_wl_pre (xa, ax, ay, az, bga, NS, US, bh, bi) &#10233; is_proped (hd xa)&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mop_tl_state_wl_pre (xa, ax, ay, az, bga, NS, US, bh, bi) &#10233; count_decided xa &gt; 0&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>mop_tl_state_wl_pre_def</span><span> </span><span>tl_state_wl_heur_pre_def</span><span> </span><span>mop_tl_state_l_pre_def</span><span>
</span><span>    </span><span>mop_tl_state_pre_def</span><span> </span><span>tl_state_wl_heur_pre_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>state_wl_l_def</span><span> </span><span>twl_st_l_def</span><span> </span><span>trail_pol_alt_def</span><span>
</span><span>      </span><span>rev_map</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>last_rev</span><span> </span><span>hd_map</span><span> </span><span>mset_take_mset_drop_mset&#39;</span><span> </span><span>&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_all_atms_all_lits</span><span>
</span><span>    </span><span>simp</span><span> </span><span>flip</span><span class="delimiter">:</span><span> </span><span>image_mset_union</span><span> </span><span>all_lits_def</span><span> </span><span>all_lits_alt_def2</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tl_state_wl_heur_tl_state_wl</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(tl_state_wl_heur, mop_tl_state_wl) &#8712;
   [&#955;_. True]<span class="hidden">&#8681;</span><sub>f</sub> twl_st_heur_conflict_ana&#39; r &#8594; &#10216;bool_rel &#215;<span class="hidden">&#8681;</span><sub>f</sub> twl_st_heur_conflict_ana&#39; r&#10217;nres_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span><span> </span><span class="delimiter">[</span><span class="delimiter">[</span><span>goals_limit</span><span class="delimiter">=</span><span>1</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>tl_state_wl_heur_def</span><span> </span><span>mop_tl_state_wl_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>frefI</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>refine_vcg</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>aa</span><span> </span><span>ba</span><span> </span><span>ab</span><span> </span><span>bb</span><span> </span><span>ac</span><span> </span><span>bc</span><span> </span><span>ad</span><span> </span><span>bd</span><span> </span><span>ae</span><span> </span><span>be</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>mop_tl_state_wl_pre_tl_state_wl_heur_pre</span><span class="delimiter">[</span><span>of</span><span> </span><span>x</span><span> </span><span>y</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>tl_state_wl_heur_def</span><span> </span><span>tl_state_wl_def</span><span> </span><span>vmtf_unset_vmtf_tl</span><span>
</span><span>         </span><span>mop_tl_state_wl_pre_simps</span><span> </span><span>lit_of_last_trail_pol_lit_of_last_trail</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down_unRET_Id</span><span class="delimiter">]</span><span>
</span><span>         </span><span>card_max_lvl_tl</span><span> </span><span>tl_state_out_learned</span><span>
</span><span>      </span><span>dest</span><span class="delimiter">:</span><span> </span><span>no_dup_tlD</span><span>
</span><span>      </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>tl_trail_tr</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down_unRET</span><span class="delimiter">]</span><span> </span><span>isa_vmtf_tl_isa_vmtf</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>lit_of_last_trail_pol_lit_of_last_trail</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down_unRET_Id</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>lit_of_hd_trail_def</span><span> </span><span>mop_tl_state_wl_pre_simps</span><span> </span><span>counts_maximum_level_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>card_max_lvl_tl</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>mop_tl_state_wl_pre_simps</span><span> </span><span>lookup_clause_rel_not_tautolgy</span><span> </span><span>lookup_clause_rel_distinct_mset</span><span>
</span><span>      </span><span>option_lookup_clause_rel_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>tl_state_out_learned</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>mop_tl_state_wl_pre_simps</span><span> </span><span>lookup_clause_rel_not_tautolgy</span><span> </span><span>lookup_clause_rel_distinct_mset</span><span>
</span><span>      </span><span>option_lookup_clause_rel_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>tl_state_out_learned</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>mop_tl_state_wl_pre_simps</span><span> </span><span>lookup_clause_rel_not_tautolgy</span><span> </span><span>lookup_clause_rel_distinct_mset</span><span>
</span><span>      </span><span>option_lookup_clause_rel_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>arena_act_pre_mark_used</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;arena_act_pre arena C &#10233;
  arena_act_pre (mark_used arena C) C&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>arena_act_pre_def</span><span> </span><span>arena_is_valid_clause_idx_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarify</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule_tac</span><span> </span><span>x</span><span class="delimiter">=</span><span>N</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>exI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule_tac</span><span> </span><span>x</span><span class="delimiter">=</span><span>vdom</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>exI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>arena_act_pre_def</span><span>
</span><span>    </span><span>simp</span><span class="delimiter">:</span><span> </span><span>valid_arena_mark_used</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>-</span><span class="delimiter">)</span><span> </span><span>get_max_lvl_st</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat twl_st_wl &#8658; nat literal &#8658; nat&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_max_lvl_st S L = get_maximum_level_remove (get_trail_wl S) (the (get_conflict_wl S)) L&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>update_confl_tl_wl_heur</span><span>
</span><span>  </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat literal &#8658; nat &#8658; twl_st_wl_heur &#8658; (bool &#215; twl_st_wl_heur) nres&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;update_confl_tl_wl_heur = (&#955;L C (M, N, (b, (n, xs)), Q, W, vm, clvls, cach, lbd, outl, stats). do {
      (N, lbd) &#8592; calculate_LBD_heur_st M N lbd C;
      ASSERT (clvls &#8805; 1);
      let L&#39; = atm_of L;
      ASSERT(arena_is_valid_clause_idx N C);
      ((b, (n, xs)), clvls, outl) &#8592;
        if arena_length N C = 2 then isasat_lookup_merge_eq2 L M N C (b, (n, xs)) clvls outl
        else isa_resolve_merge_conflict_gt2 M N C (b, (n, xs)) clvls outl;
      ASSERT(curry lookup_conflict_remove1_pre L (n, xs) &#8743; clvls &#8805; 1);
      let (n, xs) = lookup_conflict_remove1 L (n, xs);
      ASSERT(arena_act_pre N C);
      ASSERT(vmtf_unset_pre L&#39; vm);
      ASSERT(tl_trailt_tr_pre M);
      RETURN (False, (tl_trailt_tr M, N, (b, (n, xs)), Q, W, isa_vmtf_unset L&#39; vm,
          clvls - 1, cach, lbd, outl, stats))
   })&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>card_max_lvl_remove1_mset_hd</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;-lit_of (hd M) &#8712;# y &#10233; is_proped (hd M) &#10233;
     card_max_lvl M (remove1_mset (-lit_of (hd M)) y) = card_max_lvl M y - 1&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>M</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>card_max_lvl_add_mset</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>update_confl_tl_wl_heur_state_helper</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(L, C) = lit_and_ann_of_propagated (hd (get_trail_wl S)) &#10233; get_trail_wl S &#8800; [] &#10233;
    is_proped (hd (get_trail_wl S)) &#10233; L = lit_of (hd (get_trail_wl S))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>S</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;hd (get_trail_wl S)&#8250;</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>-</span><span class="delimiter">)</span><span> </span><span>not_ge_Suc0</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;Suc 0 &#8804; n &#10231; n = 0&#8250;</span></span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* WTF *)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>update_confl_tl_wl_pre&#39;</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((nat literal &#215; nat) &#215; nat twl_st_wl) &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;update_confl_tl_wl_pre&#39; = (&#955;((L, C), S).
      C &#8712;# dom_m (get_clauses_wl S) &#8743;
      get_conflict_wl S &#8800; None &#8743; get_trail_wl S &#8800; [] &#8743;
      - L &#8712;# the (get_conflict_wl S) &#8743;
      L &#8713;# the (get_conflict_wl S) &#8743;
      (L, C) = lit_and_ann_of_propagated (hd (get_trail_wl S)) &#8743;
      L &#8712;# &#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub> (all_atms_st S) &#8743;
      is_proped (hd (get_trail_wl S)) &#8743;
      C &gt; 0 &#8743;
      card_max_lvl (get_trail_wl S) (the (get_conflict_wl S)) &#8805; 1 &#8743;
      distinct_mset (the (get_conflict_wl S)) &#8743;
      - L &#8713; set (get_clauses_wl S &#8733; C) &#8743;
      (length (get_clauses_wl S &#8733; C) &#8800; 2 &#10230;
        L &#8713; set (tl (get_clauses_wl S &#8733; C)) &#8743;
        get_clauses_wl S &#8733; C ! 0 = L &#8743;
        mset (tl (get_clauses_wl S &#8733; C)) = remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8743;
        (&#8704;L&#8712;set (tl(get_clauses_wl S &#8733; C)). - L &#8713;# the (get_conflict_wl S)) &#8743;
        card_max_lvl (get_trail_wl S) (mset (tl (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S)) =
          card_max_lvl (get_trail_wl S) (remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S))) &#8743;
      L &#8712; set (watched_l (get_clauses_wl S &#8733; C)) &#8743;
      distinct (get_clauses_wl S &#8733; C) &#8743;
      &#172;tautology (the (get_conflict_wl S)) &#8743;
      &#172;tautology (mset (get_clauses_wl S &#8733; C)) &#8743;
      &#172;tautology (remove1_mset L (remove1_mset (- L)
        ((the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C))))) &#8743;
      count_decided (get_trail_wl S) &gt; 0 &#8743;
      literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub> (all_atms_st S) (the (get_conflict_wl S)) &#8743;
      literals_are_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub> (all_atms_st S) S &#8743;
      literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_trail (all_atms_st S) (get_trail_wl S) &#8743;
      (&#8704;K. K &#8712;# remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#10230; - K &#8713;# the (get_conflict_wl S)) &#8743;
      size (remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S)) &gt; 0 &#8743;
      Suc 0 &#8804; card_max_lvl (get_trail_wl S) (remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S)) &#8743;
      size (remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S)) =
       size (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) - {#L, - L#}) + Suc 0 &#8743;
      lit_of (hd (get_trail_wl S)) = L &#8743;
       card_max_lvl (get_trail_wl S) ((mset (get_clauses_wl S &#8733; C) - unmark (hd (get_trail_wl S))) &#8746;# the (get_conflict_wl S))  =
        card_max_lvl (tl (get_trail_wl S)) (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) - {#L, - L#}) + Suc 0 &#8743;
     out_learned (tl (get_trail_wl S)) (Some (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) - {#L, - L#})) =
        out_learned (get_trail_wl S) (Some ((mset (get_clauses_wl S &#8733; C) - unmark (hd (get_trail_wl S))) &#8746;# the (get_conflict_wl S)))
    )&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>remove1_mset_union_distrib1</span><span class="delimiter">:</span><span>
</span><span>     </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8713;# B &#10233; remove1_mset L (A &#8746;# B) = remove1_mset L A &#8746;# B&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>remove1_mset_union_distrib2</span><span class="delimiter">:</span><span>
</span><span>     </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8713;# A &#10233; remove1_mset L (A &#8746;# B) = A &#8746;# remove1_mset L B&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>remove1_mset_union_distrib</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;update_confl_tl_wl_pre L C S&#8250;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;update_confl_tl_wl_pre&#39; ((L, C), S)&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>x</span><span> </span><span>xa</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>Sx</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(S, x) &#8712; state_wl_l None&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;correct_watching S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>x_xa</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(x, xa) &#8712; twl_st_l None&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>st_invs</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;twl_struct_invs xa&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>list_invs</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;twl_list_invs x&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;twl_stgy_invs xa&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C &#8712;# dom_m (get_clauses_wl S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>nempty</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S &#8800; []&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;literals_to_update_wl S = {#}&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>hd</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;hd (get_trail_wl S) = Propagated L C&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>C_0</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;0 &lt; C&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>confl</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_conflict_wl S &#8800; None&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;0 &lt; count_decided (get_trail_wl S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_conflict_wl S &#8800; Some {#}&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8712; set (get_clauses_wl S &#8733; C)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>uL_D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;- L &#8712;# the (get_conflict_wl S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>xa</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;hd (get_trail xa) = Propagated L (mset (get_clauses_wl S &#8733; C))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>L</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8712;# all_lits_st S&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>blits</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;blits_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub> S&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>update_confl_tl_wl_pre_def</span><span>
</span><span>    </span><span>update_confl_tl_l_pre_def</span><span> </span><span>update_confl_tl_pre_def</span><span>
</span><span>    </span><span>prod.case</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>normalize_goal</span><span class="delimiter">+</span><span>
</span><span>      </span><span class="delimiter">(</span><span>simp</span><span> </span><span>flip</span><span class="delimiter">:</span><span> </span><span>all_lits_def</span><span> </span><span>all_lits_alt_def2</span><span>
</span><span>        </span><span>add</span><span class="delimiter">:</span><span> </span><span>mset_take_mset_drop_mset&#39;</span><span> </span><span>&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_all_atms_all_lits</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span>dist</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>W</sub>_restart_mset.distinct_cdcl<span class="hidden">&#8681;</span><sub>W</sub>_state (state<span class="hidden">&#8681;</span><sub>W</sub>_of xa)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>M_lev</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>W</sub>_restart_mset.cdcl<span class="hidden">&#8681;</span><sub>W</sub>_M_level_inv (state<span class="hidden">&#8681;</span><sub>W</sub>_of xa)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>confl&#39;</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cdcl<span class="hidden">&#8681;</span><sub>W</sub>_restart_mset.cdcl<span class="hidden">&#8681;</span><sub>W</sub>_conflicting (state<span class="hidden">&#8681;</span><sub>W</sub>_of xa)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>st_inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;twl_st_inv xa&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>st_invs</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>twl_struct_invs_def</span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>W</sub>_restart_mset.cdcl<span class="hidden">&#8681;</span><sub>W</sub>_all_struct_inv_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span class="delimiter">+</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lits_of_l (tl (get_trail_wl S)) = lits_of_l (tl (get_trail xa))&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Sx</span><span> </span><span>x_xa</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>list.set_map</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>lits_of_def</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>S</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span>x</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span>xa</span><span class="delimiter">;</span><span>
</span><span>       </span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>state_wl_l_def</span><span> </span><span>twl_st_l_def</span><span> </span><span>map_tl</span><span> </span><span>list_of_l_convert_map_lit_of</span><span> </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>list.set_map</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>card_max</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card_max_lvl (get_trail_wl S) (the (get_conflict_wl S)) &#8805; 1&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hd</span><span> </span><span>uL_D</span><span> </span><span>nempty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>card_max_lvl_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>dist_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct_mset (the (get_conflict_wl S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dist</span><span> </span><span>Sx</span><span> </span><span>x_xa</span><span> </span><span>confl</span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>W</sub>_restart_mset.distinct_cdcl<span class="hidden">&#8681;</span><sub>W</sub>_state_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>dist</span><span class="delimiter">:</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;distinct (get_clauses_wl S &#8733; C)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dist</span><span> </span><span>Sx</span><span> </span><span>x_xa</span><span> </span><span>confl</span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>W</sub>_restart_mset.distinct_cdcl<span class="hidden">&#8681;</span><sub>W</sub>_state_alt_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>image_image</span><span> </span><span>ran_m_def</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>n_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;no_dup (get_trail_wl S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Sx</span><span> </span><span>x_xa</span><span> </span><span>M_lev</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>W</sub>_restart_mset.cdcl<span class="hidden">&#8681;</span><sub>W</sub>_M_level_inv_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>CNot_D</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S &#8872;as CNot (the (get_conflict_wl S))&#8250;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>confl&#39;</span><span> </span><span>confl</span><span> </span><span>Sx</span><span> </span><span>x_xa</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>W</sub>_restart_mset.cdcl<span class="hidden">&#8681;</span><sub>W</sub>_conflicting_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl (get_trail_wl S) &#8872;as CNot (the (get_conflict_wl S) - {#-L#})&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dist_C</span><span> </span><span>uL_D</span><span> </span><span>n_d</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>       </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>true_annots_true_cls_def_iff_negation_in_model</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>CNot_C&#39;</span><span class="delimiter">:</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl (get_trail_wl S) &#8872;as CNot (mset (get_clauses_wl S &#8733; C) - {#L#})&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>L_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8712;# mset (get_clauses_wl S &#8733; C)&#8250;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>confl&#39;</span><span> </span><span>nempty</span><span> </span><span>x_xa</span><span> </span><span>xa</span><span> </span><span>hd</span><span> </span><span>Sx</span><span> </span><span>nempty</span><span> </span><span>eq</span><span>
</span><span>   </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cdcl<span class="hidden">&#8681;</span><sub>W</sub>_restart_mset.cdcl<span class="hidden">&#8681;</span><sub>W</sub>_conflicting_def</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail xa&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>fastforce</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st</span><span> </span><span>twl_st_l</span><span> </span><span>true_annots_true_cls_def_iff_negation_in_model</span><span>
</span><span>      </span><span>dest</span><span class="delimiter">:</span><span> </span><span>spec</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;[]&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>tl</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl (get_trail_wl S) &#8872;as CNot ((the (get_conflict_wl S) - {#-L#}) &#8746;# (mset (get_clauses_wl S &#8733; C) - {#L#}))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>true_annots_true_cls_def_iff_negation_in_model</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(the (get_conflict_wl S) - {#-L#}) &#8746;# (mset (get_clauses_wl S &#8733; C) - {#L#}) =
      (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) -
      {#L, - L#})&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>multi_member_split</span><span class="delimiter">[</span><span>OF</span><span> </span><span>L_C</span><span class="delimiter">]</span><span> </span><span>uL_D</span><span> </span><span>dist</span><span> </span><span>dist_C</span><span> </span><span>n_d</span><span> </span><span>hd</span><span> </span><span>nempty</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span>
</span><span>      </span><span>simp</span><span class="delimiter">:</span><span> </span><span>true_annots_true_cls_def_iff_negation_in_model</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>sup_union_left1</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>in_lits_of_l_defined_litD</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>tl</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl (get_trail_wl S) &#8872;as CNot (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) -
      {#L, - L#})&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>distinct_consistent_interp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>no_dup_tlD</span><span class="delimiter">[</span><span>OF</span><span> </span><span>n_d</span><span class="delimiter">]</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;tautology
     (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) -
      {#L, - L#})&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_annots_true_cls</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>consistent_CNot_not_tautology</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword2"><span class="keyword">if</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;- L &#8712;# mset (get_clauses_wl S &#8733; C)&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>multi_member_split</span><span class="delimiter">[</span><span>OF</span><span> </span><span>L_C</span><span class="delimiter">]</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>n_d</span><span> </span><span>CNot_C&#39;</span><span> </span><span>multi_member_split</span><span class="delimiter">[</span><span>OF</span><span> </span><span>that</span><span class="delimiter">]</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>add_mset_eq_add_mset</span><span> </span><span>true_annots_true_cls_def_iff_negation_in_model</span><span>
</span><span>         </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>in_lits_of_l_defined_litD</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>2</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;-L &#8713; set (get_clauses_wl S &#8733; C)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (get_clauses_wl S &#8733; C) &#8805; 2&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>st_inv</span><span> </span><span>C</span><span>  </span><span>Sx</span><span> </span><span>x_xa</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>xa</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span>x</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span>S</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;irred (get_clauses_wl S) C&#8250;</span></span></span><span class="delimiter">;</span><span>
</span><span>      </span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_inv.simps</span><span> </span><span>state_wl_l_def</span><span> </span><span>twl_st_l_def</span><span> </span><span>conj_disj_distribR</span><span> </span><span>Collect_disj_eq</span><span> </span><span>image_Un</span><span>
</span><span>        </span><span>ran_m_def</span><span> </span><span>Collect_conv_if</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (get_clauses_wl S &#8733; C) &#8800; 2 &#10231; length (get_clauses_wl S &#8733; C) &gt; 2&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_clauses_wl S &#8733; C&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;tl (get_clauses_wl S &#8733; C)&#8250;</span></span></span><span class="delimiter">;</span><span>
</span><span>      </span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_list_invs_def</span><span> </span><span>all_conj_distrib</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>in_set_takeD</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>CNot_C</span><span class="delimiter">:</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;tautology (mset (get_clauses_wl S &#8733; C))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CNot_C&#39;</span><span> </span><span>Sx</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>C_0</span><span> </span><span>dist</span><span> </span><span>multi_member_split</span><span class="delimiter">[</span><span>OF</span><span> </span><span>L_C</span><span class="delimiter">]</span><span> </span><span>dist</span><span>
</span><span>        </span><span>consistent_CNot_not_tautology</span><span class="delimiter">[</span><span>OF</span><span> </span><span>distinct_consistent_interp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>no_dup_tlD</span><span class="delimiter">[</span><span>OF</span><span> </span><span>n_d</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>           </span><span>CNot_C&#39;</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>true_annots_true_cls</span><span class="delimiter">]</span><span class="delimiter">]</span><span> </span><span>2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>true_annots_true_cls_def_iff_negation_in_model</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tautology_add_mset</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>arg_cong</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mset _&#8250;</span></span></span><span> </span><span>_</span><span> </span><span>set_mset</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>member_add_mset</span><span> </span><span>set_mset_mset</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>stupid</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;K &#8712;# removeAll_mset L D &#10231; K &#8800; L &#8743; K &#8712;# D&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>K</span><span> </span><span>L</span><span> </span><span>D</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>K</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;K &#8712;# remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#10233; - K &#8713;# the (get_conflict_wl S)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>uL_C</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;-L &#8713;# (mset (get_clauses_wl S &#8733; C))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>K</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>asm</span><span class="delimiter">)</span><span> </span><span>distinct_mset_remove1_All</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>asm</span><span class="delimiter">)</span><span>stupid</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>conjE</span><span class="delimiter">,</span><span> </span><span>assumption</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>1</span><span> </span><span>uL_D</span><span> </span><span>CNot_C</span><span> </span><span>dist</span><span> </span><span>2</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>in_multiset_in_set</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span class="delimiter">]</span><span> </span><span>dist_C</span><span>
</span><span>      </span><span>consistent_CNot_not_tautology</span><span class="delimiter">[</span><span>OF</span><span> </span><span>distinct_consistent_interp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>n_d</span><span class="delimiter">]</span><span>
</span><span>           </span><span>CNot_D</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>true_annots_true_cls</span><span class="delimiter">]</span><span class="delimiter">]</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8712;# mset (get_clauses_wl S &#8733; C)&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;-L&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>multi_member_split</span><span> </span><span>in_set_takeD</span><span>
</span><span>       </span><span>simp</span><span class="delimiter">:</span><span> </span><span>tautology_add_mset</span><span> </span><span>add_mset_eq_add_mset</span><span> </span><span>uminus_lit_swap</span><span> </span><span>diff_union_swap2</span><span>
</span><span>       </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>set_mset_mset</span><span> </span><span>in_multiset_in_set</span><span>
</span><span>         </span><span>distinct_mset_mset_distinct</span><span> </span><span>simp</span><span> </span><span>flip</span><span class="delimiter">:</span><span> </span><span>distinct_mset_mset_distinct</span><span class="delimiter">)</span><span>
</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>size</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;size (remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S)) &gt; 0&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>uL_D</span><span> </span><span>uL_C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>max_lvl</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Suc 0 &#8804; card_max_lvl (get_trail_wl S) (remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>uL_D</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>uL_C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>card_max_lvl_def</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;size (remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S)) =
       size (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) - {#L, - L#}) + 1&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>subset_mset.sup.commute</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>uL_D</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>uL_C</span><span> </span><span>dist_C</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remove1_mset (- L) (the (get_conflict_wl S)) &#8746;# remove1_mset L (mset (get_clauses_wl S &#8733; C)) = the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) - {#L, - L#}&#8250;</span></span></span><span> </span><span>add_mset_commute</span><span> </span><span>add_mset_diff_bothsides</span><span> </span><span>add_mset_remove_trivial</span><span> </span><span>set_mset_mset</span><span> </span><span>subset_mset.sup_commute</span><span> </span><span>sup_union_left1</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>SC_0</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;length (get_clauses_wl S &#8733; C) &gt; 2 &#10233; L &#8713; set (tl (get_clauses_wl S &#8733; C)) &#8743; get_clauses_wl S &#8733; C ! 0 = L &#8743;
       mset (tl (get_clauses_wl S &#8733; C)) = remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8743;
        (&#8704;L&#8712;set (tl(get_clauses_wl S &#8733; C)). - L &#8713;# the (get_conflict_wl S)) &#8743;
       card_max_lvl (get_trail_wl S) (mset (tl (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S)) =
          card_max_lvl (get_trail_wl S) (remove1_mset L (mset (get_clauses_wl S &#8733; C)) &#8746;# the (get_conflict_wl S))&#8250;</span></span></span><span>
</span><span>     </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8712; set (watched_l (get_clauses_wl S &#8733; C))&#8250;</span></span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8712;# mset (get_clauses_wl S &#8733; C)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>list_invs</span><span> </span><span>Sx</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>C_0</span><span> </span><span>dist</span><span> </span><span>L_C</span><span> </span><span>K</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_clauses_wl S &#8733; C&#8250;</span></span></span><span class="delimiter">;</span><span>
</span><span>      </span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_list_invs_def</span><span> </span><span>all_conj_distrib</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>in_set_takeD</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>max</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;card_max_lvl (get_trail_wl S) ((mset (get_clauses_wl S &#8733; C) - unmark (hd (get_trail_wl S))) &#8746;# the (get_conflict_wl S))  =
        card_max_lvl (tl (get_trail_wl S)) (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) - {#L, - L#}) + Suc 0&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>multi_member_split</span><span class="delimiter">[</span><span>OF</span><span> </span><span>uL_D</span><span class="delimiter">]</span><span> </span><span>L_C</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>n_d</span><span> </span><span>dist</span><span> </span><span>dist_C</span><span> </span><span>1</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;0 &lt; count_decided (get_trail_wl S)&#8250;</span></span></span><span> </span><span>uL_C</span><span> </span><span>n_d</span><span>
</span><span>        </span><span>consistent_CNot_not_tautology</span><span class="delimiter">[</span><span>OF</span><span> </span><span>distinct_consistent_interp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>n_d</span><span class="delimiter">]</span><span>
</span><span>           </span><span>CNot_D</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>true_annots_true_cls</span><span class="delimiter">]</span><span class="delimiter">]</span><span> </span><span>CNot_C</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span>
</span><span>           </span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span>  </span><span>simp</span><span class="delimiter">:</span><span> </span><span>card_max_lvl_Cons</span><span> </span><span>card_max_lvl_add_mset</span><span> </span><span>subset_mset.sup_commute</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remove1_mset _ _&#8250;</span></span></span><span> </span><span class="delimiter">]</span><span>
</span><span>             </span><span>subset_mset.sup_commute</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mset _&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>tautology_add_mset</span><span> </span><span>remove1_mset_union_distrib1</span><span> </span><span>remove1_mset_union_distrib2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>distinct_mset_remove1_All</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mset (get_clauses_wl S &#8733; C)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>xx</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;out_learned (tl (get_trail_wl S)) (Some (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) - {#L, - L#})) outl &#10231;
      out_learned (get_trail_wl S) (Some (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) - {#L, - L#})) outl&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>outl</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>tl_state_out_learned</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>use</span><span> </span><span>L_C</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>dist</span><span> </span><span>dist_C</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>distinct_mem_diff_mset</span><span> </span><span>distinct_mset_mset_distinct</span><span> </span><span>distinct_mset_union_mset</span><span> </span><span>union_single_eq_member</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>use</span><span> </span><span>L_C</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>dist</span><span> </span><span>dist_C</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>add_mset_commute</span><span> </span><span>distinct_mem_diff_mset</span><span> </span><span>distinct_mset_mset_distinct</span><span> </span><span>distinct_mset_union_mset</span><span> </span><span>union_single_eq_member</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>use</span><span> </span><span>L_C</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>dist</span><span> </span><span>dist_C</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_level (get_trail_wl S) L = count_decided (get_trail_wl S)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_trail_wl S&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>use</span><span> </span><span>L_C</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>dist</span><span> </span><span>dist_C</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>yy</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;out_learned (get_trail_wl S) (Some ((the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C)) - {#L, - L#})) outl &#10231;
      out_learned (get_trail_wl S) (Some ((mset (get_clauses_wl S &#8733; C) - unmark (hd (get_trail_wl S))) &#8746;# the (get_conflict_wl S))) outl&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>outl</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>L_C</span><span> </span><span>hd</span><span> </span><span>nempty</span><span> </span><span>dist</span><span> </span><span>dist_C</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;auto simp add: out_learned_def ac_simps&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>xx</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;out_learned (tl (get_trail_wl S)) (Some (the (get_conflict_wl S) &#8746;# mset (get_clauses_wl S &#8733; C) - {#L, - L#})) =
      out_learned (get_trail_wl S) (Some ((mset (get_clauses_wl S &#8733; C) - unmark (hd (get_trail_wl S))) &#8746;# the (get_conflict_wl S)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xx</span><span> </span><span>yy</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ext</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Sx</span><span> </span><span>x_xa</span><span> </span><span>C</span><span> </span><span>C_0</span><span> </span><span>confl</span><span> </span><span>nempty</span><span> </span><span>uL_D</span><span> </span><span>L</span><span> </span><span>blits</span><span> </span><span>1</span><span> </span><span>2</span><span> </span><span>card_max</span><span> </span><span>dist_C</span><span> </span><span>dist</span><span> </span><span>SC_0</span><span> </span><span>max</span><span>
</span><span>        </span><span>consistent_CNot_not_tautology</span><span class="delimiter">[</span><span>OF</span><span> </span><span>distinct_consistent_interp</span><span class="delimiter">[</span><span>OF</span><span> </span><span>n_d</span><span class="delimiter">]</span><span>
</span><span>           </span><span>CNot_D</span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>true_annots_true_cls</span><span class="delimiter">]</span><span class="delimiter">]</span><span> </span><span>CNot_C</span><span> </span><span>K</span><span> </span><span>xx</span><span>
</span><span>        </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;0 &lt; count_decided (get_trail_wl S)&#8250;</span></span></span><span>  </span><span>size</span><span> </span><span>max_lvl</span><span> </span><span>s</span><span>
</span><span>     </span><span>literals_are_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_conflict</span><span class="delimiter">[</span><span>OF</span><span> </span><span>Sx</span><span> </span><span>st_invs</span><span> </span><span>x_xa</span><span> </span><span>_</span><span> </span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st S&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>     </span><span>literals_are_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_literals_are_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_trail</span><span class="delimiter">[</span><span>OF</span><span> </span><span>Sx</span><span> </span><span>st_invs</span><span> </span><span>x_xa</span><span> </span><span>_</span><span> </span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st S&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>clarsimp</span><span> </span><span>simp</span><span> </span><span>flip</span><span class="delimiter">:</span><span> </span><span>all_lits_def</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>hd</span><span> </span><span>mset_take_mset_drop_mset&#39;</span><span> </span><span>&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_all_atms_all_lits</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>-</span><span class="delimiter">)</span><span>out_learned_add_mset_highest_level</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L = lit_of (hd M) &#10233; out_learned M (Some (add_mset (- L) A)) outl &#10231;
    out_learned M (Some A) outl&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>M</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>out_learned_def</span><span> </span><span>get_level_cons_if</span><span> </span><span>atm_of_eq_atm_of</span><span> </span><span>count_decided_ge_get_level</span><span>
</span><span>      </span><span>uminus_lit_swap</span><span> </span><span>cong</span><span class="delimiter">:</span><span> </span><span>if_cong</span><span>
</span><span>      </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>filter_mset_cong2</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>-</span><span class="delimiter">)</span><span>out_learned_tl_Some_notin</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_proped (hd M) &#10233; lit_of (hd M) &#8713;# C &#10233; -lit_of (hd M) &#8713;# C &#10233;
    out_learned M (Some C) outl &#10231; out_learned (tl M) (Some C) outl&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>M</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>out_learned_def</span><span> </span><span>get_level_cons_if</span><span> </span><span>atm_of_eq_atm_of</span><span>
</span><span>      </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>filter_mset_cong2</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*TODO*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_mm_all_atms_self</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_mm (all_atms ca NUE) {#mset (fst x). x &#8712;# ran_m ca#}&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_mm_def</span><span> </span><span>in_&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_atm_of_&#119964;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub></span><span>
</span><span>    </span><span>all_atms_def</span><span> </span><span>all_lits_def</span><span> </span><span>in_all_lits_of_mm_ain_atms_of_iff</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>mset_as_position_remove3</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mset_as_position xs (D - {#L#}) &#10233; atm_of L &lt; length xs &#10233; distinct_mset D &#10233;
   mset_as_position (xs[atm_of L := None]) (D - {#L, -L#})&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>mset_as_position_remove2</span><span class="delimiter">[</span><span>of</span><span> </span><span>xs</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;D - {#L#}&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>mset_as_position_tautology</span><span class="delimiter">[</span><span>of</span><span> </span><span>xs</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remove1_mset L D&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>    </span><span>mset_as_position_distinct_mset</span><span class="delimiter">[</span><span>of</span><span> </span><span>xs</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remove1_mset L D&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;L &#8712;# D&#8250;</span></span></span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;-L &#8712;# D&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>minus_notin_trivial</span><span> </span><span>ac_simps</span><span> </span><span>add_mset_eq_add_mset</span><span> </span><span>tautology_add_mset</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>imply_itself</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;P &#10233; P&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>update_confl_tl_wl_heur_update_confl_tl_wl</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(uncurry2 (update_confl_tl_wl_heur), uncurry2 mop_update_confl_tl_wl) &#8712;
  [&#955;_. True]<span class="hidden">&#8681;</span><sub>f</sub>
   Id &#215;<span class="hidden">&#8681;</span><sub>f</sub> nat_rel &#215;<span class="hidden">&#8681;</span><sub>f</sub> twl_st_heur_conflict_ana&#39; r &#8594; &#10216;bool_rel &#215;<span class="hidden">&#8681;</span><sub>f</sub> twl_st_heur_conflict_ana&#39; r&#10217;nres_rel&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>mop_update_confl_tl_wl_alt_def</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mop_update_confl_tl_wl = (&#955;L C (M, N, D, NE, UE, WS, Q). do {
      ASSERT(update_confl_tl_wl_pre L C (M, N, D, NE, UE, WS, Q));
      N &#8592; calculate_LBD_st M N C;
      D &#8592; RETURN (resolve_cls_wl&#39; (M, N, D, NE, UE, WS, Q) C L);
      N &#8592; RETURN N;
      N &#8592; RETURN N;
      RETURN (False, (tl M, N, Some D, NE, UE, WS, Q))
    })&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>mop_update_confl_tl_wl_def</span><span> </span><span>update_confl_tl_wl_def</span><span> </span><span>calculate_LBD_st_def</span><span>
</span><span>      </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ext</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">define</span></span><span> </span><span>rr</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;rr L M N C b n xs clvls outl = do {
          ((b, (n, xs)), clvls, outl) &#8592;
            if arena_length N C = 2 then isasat_lookup_merge_eq2 L M N C (b, (n, xs)) clvls outl
           else isa_resolve_merge_conflict_gt2 M N C (b, (n, xs)) clvls outl;
         ASSERT(curry lookup_conflict_remove1_pre L (n, xs) &#8743; clvls &#8805; 1);
         let (nxs) = lookup_conflict_remove1 L (n, xs);
         RETURN ((b, (nxs)), clvls, outl) }&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">for</span></span><span>  </span><span>L</span><span> </span><span>M</span><span> </span><span>N</span><span> </span><span>C</span><span> </span><span>b</span><span> </span><span>n</span><span> </span><span>xs</span><span> </span><span>clvls</span><span> </span><span>lbd</span><span> </span><span>outl</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>update_confl_tl_wl_heur_alt_def</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;update_confl_tl_wl_heur = (&#955;L C (M, N, (b, (n, xs)), Q, W, vm, clvls, cach, lbd, outl, stats). do {
      (N, lbd) &#8592; calculate_LBD_heur_st M N lbd C;
      ASSERT (clvls &#8805; 1);
      let L&#39; = atm_of L;
      ASSERT(arena_is_valid_clause_idx N C);
      ((b, (n, xs)), clvls, outl) &#8592; rr L M N C b n xs clvls outl;
      ASSERT(arena_act_pre N C);
      ASSERT(vmtf_unset_pre L&#39; vm);
      ASSERT(tl_trailt_tr_pre M);
      RETURN (False, (tl_trailt_tr M, N, (b, (n, xs)), Q, W, isa_vmtf_unset L&#39; vm,
          clvls - 1, cach, lbd, outl, stats))
   })&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_heur_def</span><span> </span><span>Let_def</span><span> </span><span>rr_def</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ext</span><span> </span><span>bind_cong</span><span class="delimiter">[</span><span>OF</span><span> </span><span>refl</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">note</span></span><span> </span><span class="delimiter">[</span><span class="delimiter">[</span><span>goals_limit</span><span class="delimiter">=</span><span>1</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>rr</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(((x1g, x2g), x1h, x1i, (x1k, x1l, x2k), x1m, x1n, x1p, x1q, x1r,
      x1s, x1t, m, n, p, q, ra, s, t),
     (x1, x2), x1a, x1b, x1c, x1d, x1e, NS, US, x1f, x2f)
    &#8712; nat_lit_lit_rel &#215;<span class="hidden">&#8681;</span><sub>f</sub> nat_rel &#215;<span class="hidden">&#8681;</span><sub>f</sub> twl_st_heur_conflict_ana&#39; r &#10233;
    CLS = ((x1, x2), x1a, x1b, x1c, x1d, x1e, NS, US, x1f, x2f) &#10233;
    CLS&#39; =
    ((x1g, x2g), x1h, x1i, (x1k, x1l, x2k), x1m, x1n, x1p, x1q, x1r,
     x1s, x1t, m, n, p, q, ra, s, t) &#10233;
    update_confl_tl_wl_pre x1 x2 (x1a, x1b, x1c, x1d, x1e, NS, US, x1f, x2f) &#10233;
    1 &#8804; x1q &#10233;
    arena_is_valid_clause_idx x1i x2g &#10233;
    rr x1g x1h x1i x2g x1k x1l x2k x1q x1t
    &#8804; &#8659; {((C, clvls, outl), D). (C, Some D) &#8712; option_lookup_clause_rel (all_atms_st (x1a, x1b, x1c, x1d, x1e, NS, US, x1f, x2f))  &#8743;
          clvls = card_max_lvl x1a (remove1_mset x1 (mset (x1b &#8733; x2)) &#8746;# the x1c)  &#8743;
         out_learned x1a (Some (remove1_mset x1 (mset (x1b &#8733; x2)) &#8746;# the x1c)) (outl) &#8743;
         size (remove1_mset x1 (mset (x1b &#8733; x2)) &#8746;# the x1c) =
           size ((mset (x1b &#8733; x2)) &#8746;# the x1c - {#x1, -x1#}) + Suc 0 &#8743;
        D = resolve_cls_wl&#39; (x1a, x1b, x1c, x1d, x1e, NS, US, x1f, x2f) x2 x1}
       (RETURN (resolve_cls_wl&#39; (x1a, x1b, x1c, x1d, x1e, NS, US, x1f, x2f) x2 x1))&#8250;</span></span></span><span>
</span><span>     </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>m</span><span> </span><span>n</span><span> </span><span>p</span><span> </span><span>q</span><span> </span><span>ra</span><span> </span><span>s</span><span> </span><span>t</span><span> </span><span>x1</span><span> </span><span>x2</span><span> </span><span>x1a</span><span> </span><span>x1b</span><span> </span><span>x1c</span><span> </span><span>x1d</span><span> </span><span>x1e</span><span> </span><span>x1f</span><span> </span><span>x2f</span><span> </span><span>x1g</span><span> </span><span>x2g</span><span> </span><span>x1h</span><span> </span><span>x1i</span><span> </span><span>x1k</span><span>
</span><span>       </span><span>x1l</span><span> </span><span>x2k</span><span> </span><span>x1m</span><span> </span><span>x1n</span><span> </span><span>x1p</span><span> </span><span>x1q</span><span> </span><span>x1r</span><span> </span><span>x1t</span><span> </span><span>CLS</span><span> </span><span>CLS&#39;</span><span> </span><span>NS</span><span> </span><span>US</span><span> </span><span>x1s</span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>rr_def</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span> </span><span>lhs_step_If</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>isasat_lookup_merge_eq2_lookup_merge_eq2</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>        </span><span>vdom</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set (get_vdom (x1h, x1i, (x1k, x1l, x2k), x1m, x1n, x1p, x1q, x1r,
      x1s, x1t, m, n, p, q, ra, s, t))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>M</span><span> </span><span class="delimiter">=</span><span> </span><span>x1a</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>N</span><span> </span><span class="delimiter">=</span><span> </span><span>x1b</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>C</span><span> </span><span class="delimiter">=</span><span> </span><span>x1c</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>&#119964;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st (x1a, x1b, x1c, x1d, x1e, NS, US, x1f, x2f) &#8250;</span></span></span><span class="delimiter">,</span><span> </span><span>THEN</span><span> </span><span>order_trans</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Down_id_eq</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>lookup_merge_eq2_spec</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>M</span><span> </span><span class="delimiter">=</span><span> </span><span>x1a</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>C</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the x1c&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>&#119964;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st (x1a, x1b, x1c, x1d, x1e, NS, US, x1f, x2f)&#8250;</span></span></span><span class="delimiter">,</span><span> </span><span>THEN</span><span> </span><span>order_trans</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_mm_literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>counts_maximum_level_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_lifting</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_lifting</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>merge_conflict_m_eq2_def</span><span> </span><span>conc_fun_SPEC</span><span> </span><span>lookup_conflict_remove1_pre_def</span><span>
</span><span>           </span><span>atms_of_def</span><span>
</span><span>           </span><span>option_lookup_clause_rel_def</span><span> </span><span>lookup_clause_rel_def</span><span> </span><span>resolve_cls_wl&#39;_def</span><span> </span><span>lookup_conflict_remove1_def</span><span>
</span><span>           </span><span>remove1_mset_union_distrib1</span><span> </span><span>remove1_mset_union_distrib2</span><span> </span><span>subset_mset.sup.commute</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remove1_mset _ _&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span>subset_mset.sup.commute</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mset (_ &#8733; _)&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>         </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>mset_as_position_remove3</span><span>
</span><span>         </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ASSERT_leI</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>asm</span><span class="delimiter">)</span><span> </span><span>arena_lifting</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>vdom</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set p&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>N</span><span> </span><span class="delimiter">=</span><span> </span><span>x1b</span><span class="delimiter">,</span><span> </span><span>symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>isa_resolve_merge_conflict_gt2</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>         </span><span>&#119964;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st (x1a, x1b, x1c, x1d, x1e, NS, US, x1f, x2f)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>vdom</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set p&#8250;</span></span></span><span class="delimiter">,</span><span>
</span><span>       </span><span>THEN</span><span> </span><span>fref_to_Down_curry5</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>x1a</span><span> </span><span>x1b</span><span> </span><span>x2g</span><span> </span><span>x1c</span><span> </span><span>x1q</span><span> </span><span>x1t</span><span class="delimiter">,</span><span>
</span><span>       </span><span>THEN</span><span> </span><span>order_trans</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>merge_conflict_m_pre_def</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>counts_maximum_level_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>conc_fun_SPEC</span><span> </span><span>lookup_conflict_remove1_pre_def</span><span> </span><span>atms_of_def</span><span>
</span><span>           </span><span>option_lookup_clause_rel_def</span><span> </span><span>lookup_clause_rel_def</span><span> </span><span>resolve_cls_wl&#39;_def</span><span>
</span><span>           </span><span>merge_conflict_m_def</span><span> </span><span>lookup_conflict_remove1_def</span><span> </span><span>subset_mset.sup.commute</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mset (_ &#8733; _)&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>           </span><span>remove1_mset_union_distrib1</span><span> </span><span>remove1_mset_union_distrib2</span><span>
</span><span>         </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>mset_as_position_remove3</span><span>
</span><span>         </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ASSERT_leI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>rr</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(((x1g, x2g), x1h, x1i, (x1k, x1l, x2k), x1m, x1n, x1o, x1p, x1q,
         x1r, x1s, l, m, n, p, q, ra, s),
        (x1, x2), x1a, N, x1c, x1d, x1e, x1f, ha, ia, ja)
       &#8712; nat_lit_lit_rel &#215;<span class="hidden">&#8681;</span><sub>f</sub> nat_rel &#215;<span class="hidden">&#8681;</span><sub>f</sub> twl_st_heur_conflict_ana&#39; r &#10233;
       CLS = ((x1, x2), x1a, N, x1c, x1d, x1e, x1f, ha, ia, ja) &#10233;
       CLS&#39; =
       ((x1g, x2g), x1h, x1i, (x1k, x1l, x2k), x1m, x1n, x1o, x1p, x1q, x1r,
        x1s, l, m, n, p, q, ra, s) &#10233;
       update_confl_tl_wl_pre x1 x2
        (x1a, N, x1c, x1d, x1e, x1f, ha, ia, ja) &#10233;
       ((x1t, x2t :: bool list), x1b)
       &#8712; {((arena&#39;, lbd), N&#39;).
          valid_arena arena&#39; N&#39;
           (set (get_vdom
                  (snd ((x1g, x2g), x1h, x1i, (x1k, x1l, x2k), x1m, x1n,
                        x1o, x1p, x1q, x1r, x1s, l, m, n, p, q, ra, s)))) &#8743;
          N = N&#39; &#8743; length x1i = length arena&#39;} &#10233;
       1 &#8804; x1p &#10233;
       arena_is_valid_clause_idx x1t x2g &#10233;
       rr x1g x1h x1t x2g x1k x1l x2k x1p x1s
       &#8804; &#8659; {((C, clvls, outl), D). (C, Some D) &#8712; option_lookup_clause_rel (all_atms_st (x1a, x1b, x1c, x1d, x1e, x1f, ha, ia, ja))  &#8743;
          clvls = card_max_lvl x1a (remove1_mset x1 (mset (x1b &#8733; x2)) &#8746;# the x1c)  &#8743;
         out_learned x1a (Some (remove1_mset x1 (mset (x1b &#8733; x2)) &#8746;# the x1c)) (outl) &#8743;
         size (remove1_mset x1 (mset (x1b &#8733; x2)) &#8746;# the x1c) =
           size ((mset (x1b &#8733; x2)) &#8746;# the x1c - {#x1, -x1#}) + Suc 0 &#8743;
        D = resolve_cls_wl&#39; (x1a, x1b, x1c, x1d, x1e, x1f, ha, ia, ja) x2 x1}
       (RETURN (resolve_cls_wl&#39; (x1a, x1b, x1c, x1d, x1e, x1f, ha, ia, ja) x2 x1))&#8250;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>l</span><span> </span><span>m</span><span> </span><span>n</span><span> </span><span>p</span><span> </span><span>q</span><span> </span><span>ra</span><span> </span><span>s</span><span> </span><span>ha</span><span> </span><span>ia</span><span> </span><span>ja</span><span> </span><span>x1</span><span> </span><span>x2</span><span> </span><span>x1a</span><span> </span><span>x1b</span><span> </span><span>x1c</span><span> </span><span>x1d</span><span> </span><span>x1e</span><span> </span><span>x1f</span><span> </span><span>x1g</span><span> </span><span>x2g</span><span> </span><span>x1h</span><span> </span><span>x1i</span><span>
</span><span>       </span><span>x1k</span><span> </span><span>x1l</span><span> </span><span>x2k</span><span> </span><span>x1m</span><span> </span><span>x1n</span><span> </span><span>x1o</span><span> </span><span>x1p</span><span> </span><span>x1q</span><span> </span><span>x1r</span><span> </span><span>x1s</span><span> </span><span>N</span><span> </span><span>x1t</span><span> </span><span>x2t</span><span> </span><span>CLS</span><span> </span><span>CLS&#39;</span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>rr_def</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span> </span><span>lhs_step_If</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>isasat_lookup_merge_eq2_lookup_merge_eq2</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>        </span><span>vdom</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set (get_vdom (x1h, x1i, (x1k, x1l, x2k), x1m, x1n, x1o, x1p, x1q,
         x1r, x1s, l, m, n, p, q, ra, s))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>M</span><span> </span><span class="delimiter">=</span><span> </span><span>x1a</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>N</span><span> </span><span class="delimiter">=</span><span> </span><span>x1b</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>C</span><span> </span><span class="delimiter">=</span><span> </span><span>x1c</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>&#119964;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st (x1a, x1b, x1c, x1d, x1e, x1f, ha, ia, ja)&#8250;</span></span></span><span class="delimiter">,</span><span> </span><span>THEN</span><span> </span><span>order_trans</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Down_id_eq</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>lookup_merge_eq2_spec</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>M</span><span> </span><span class="delimiter">=</span><span> </span><span>x1a</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>C</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the x1c&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>&#119964;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st (x1a, x1b, x1c, x1d, x1e, x1f, ha, ia, ja)&#8250;</span></span></span><span class="delimiter">,</span><span> </span><span>THEN</span><span> </span><span>order_trans</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_mm_literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>counts_maximum_level_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_lifting</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_lifting</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>merge_conflict_m_eq2_def</span><span> </span><span>conc_fun_SPEC</span><span> </span><span>lookup_conflict_remove1_pre_def</span><span>
</span><span>           </span><span>atms_of_def</span><span>
</span><span>           </span><span>option_lookup_clause_rel_def</span><span> </span><span>lookup_clause_rel_def</span><span> </span><span>resolve_cls_wl&#39;_def</span><span> </span><span>lookup_conflict_remove1_def</span><span>
</span><span>           </span><span>remove1_mset_union_distrib1</span><span> </span><span>remove1_mset_union_distrib2</span><span> </span><span>subset_mset.sup.commute</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remove1_mset _ _&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span>subset_mset.sup.commute</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mset (_ &#8733; _)&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>         </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>mset_as_position_remove3</span><span>
</span><span>         </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ASSERT_leI</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>asm</span><span class="delimiter">)</span><span> </span><span>arena_lifting</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>vdom</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set n&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>N</span><span> </span><span class="delimiter">=</span><span> </span><span>x1b</span><span class="delimiter">,</span><span> </span><span>symmetric</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>isa_resolve_merge_conflict_gt2</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>         </span><span>&#119964;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st (x1a, x1b, x1c, x1d, x1e, x1f, ha, ia, ja)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>vdom</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set n&#8250;</span></span></span><span class="delimiter">,</span><span>
</span><span>       </span><span>THEN</span><span> </span><span>fref_to_Down_curry5</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>x1a</span><span> </span><span>x1b</span><span> </span><span>x2g</span><span> </span><span>x1c</span><span> </span><span>x1p</span><span> </span><span>x1s</span><span class="delimiter">,</span><span>
</span><span>       </span><span>THEN</span><span> </span><span>order_trans</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>merge_conflict_m_pre_def</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>counts_maximum_level_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>conc_fun_SPEC</span><span> </span><span>lookup_conflict_remove1_pre_def</span><span> </span><span>atms_of_def</span><span>
</span><span>           </span><span>option_lookup_clause_rel_def</span><span> </span><span>lookup_clause_rel_def</span><span> </span><span>resolve_cls_wl&#39;_def</span><span>
</span><span>           </span><span>merge_conflict_m_def</span><span> </span><span>lookup_conflict_remove1_def</span><span> </span><span>subset_mset.sup.commute</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mset (_ &#8733; _)&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>           </span><span>remove1_mset_union_distrib1</span><span> </span><span>remove1_mset_union_distrib2</span><span>
</span><span>         </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>mset_as_position_remove3</span><span>
</span><span>         </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ASSERT_leI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span><span> </span><span class="delimiter">[</span><span class="delimiter">[</span><span>goals_limit</span><span> </span><span class="delimiter">=</span><span> </span><span>1</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span><span> </span><span>RETURN_as_SPEC_refine</span><span class="delimiter">[</span><span>refine2</span><span> </span><span>del</span><span class="delimiter">]</span><span>
</span><span>       </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span class="delimiter">[</span><span>dest</span><span class="delimiter">!</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>frefI</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>CLS&#39;</span><span> </span><span>CLS</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>CLS&#39;</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span>CLS</span><span class="delimiter">;</span><span> </span><span>hypsubst</span><span class="delimiter">+</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>uncurry_def</span><span> </span><span>update_confl_tl_wl_heur_alt_def</span><span> </span><span>comp_def</span><span> </span><span>Let_def</span><span>
</span><span>        </span><span>update_confl_tl_wl_def</span><span> </span><span>mop_update_confl_tl_wl_alt_def</span><span> </span><span>prod.case</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_rcg</span><span> </span><span>calculate_LBD_heur_st_calculate_LBD_st</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>        </span><span>vdom</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set (get_vdom (snd CLS&#39;))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>&#119964;</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st (snd CLS)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">;</span><span> </span><span>remove_dummy_vars</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span>
</span><span>            </span><span>RES_RETURN_RES</span><span> </span><span>RETURN_def</span><span> </span><span>counts_maximum_level_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_is_valid_clause_idx_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_is_valid_clause_idx_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_nth</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;snd (fst CLS)&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;snd CLS&#8250;</span></span></span><span>
</span><span>         </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st (snd CLS)&#8250;</span></span></span><span class="delimiter">,</span><span> </span><span>simplified</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_is_valid_clause_idx_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span>
</span><span>            </span><span>RES_RETURN_RES</span><span> </span><span>RETURN_def</span><span> </span><span>counts_maximum_level_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_clauses_wl (snd CLS)&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set (get_vdom (snd CLS&#39;))&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_is_valid_clause_idx_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rr</span><span class="delimiter">;</span><span> </span><span>assumption</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>arena_act_pre_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>         </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_is_valid_clause_idx_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span>
</span><span>           </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>vmtf_unset_pre&#39;</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>m</span><span> </span><span>n</span><span> </span><span>p</span><span> </span><span>q</span><span> </span><span>ra</span><span> </span><span>s</span><span> </span><span>t</span><span> </span><span>ha</span><span> </span><span>ia</span><span> </span><span>ja</span><span> </span><span>x1</span><span> </span><span>x2</span><span> </span><span>x1a</span><span> </span><span>x1b</span><span> </span><span>x1c</span><span> </span><span>x1d</span><span> </span><span>x1e</span><span> </span><span>x1f</span><span> </span><span>x1g</span><span> </span><span>x2g</span><span> </span><span>x1h</span><span> </span><span>x1i</span><span>
</span><span>       </span><span>x1k</span><span> </span><span>x1l</span><span> </span><span>x2k</span><span> </span><span>x1m</span><span> </span><span>x1n</span><span> </span><span>x1o</span><span> </span><span>x1p</span><span> </span><span>x1q</span><span> </span><span>x1r</span><span> </span><span>x1t</span><span> </span><span>D</span><span> </span><span>x1v</span><span> </span><span>x1w</span><span> </span><span>x2v</span><span> </span><span>x1x</span><span> </span><span>x1y</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>tl_trailt_tr_pre</span><span class="delimiter">[</span><span>of</span><span> </span><span>x1a</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st (x1a, x1b, x1c, x1d, x1e, x1f, ha, ia, ja)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="delimiter">(</span><span>clarsimp_all</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre_update_confl_tl_wl_pre&#39;</span><span>
</span><span>             </span><span>simp</span><span class="delimiter">:</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span> </span><span>arena_is_valid_clause_idx_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span>
</span><span>             </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>tl_trailt_tr_pre</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>clarsimp</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>update_confl_tl_wl_pre&#39;_def</span><span>
</span><span>           </span><span>valid_arena_mark_used</span><span> </span><span>subset_mset.sup.commute</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remove1_mset _ _&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span>tl_trail_tr</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down_unRET</span><span class="delimiter">]</span><span> </span><span>resolve_cls_wl&#39;_def</span><span> </span><span>isa_vmtf_tl_isa_vmtf</span><span> </span><span>no_dup_tlD</span><span>
</span><span>          </span><span>counts_maximum_level_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>phase_saving_le</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;phase_saving &#119964; &#966; &#10233; A &#8712;# &#119964; &#10233; A &lt; length &#966;&#8250;</span></span></span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;phase_saving &#119964; &#966; &#10233; B &#8712;# &#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub> &#119964; &#10233; atm_of B &lt; length &#966;&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>phase_saving_def</span><span> </span><span>atms_of_&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_&#119964;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub></span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>isa_vmtf_le</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((a, b), M) &#8712; isa_vmtf &#119964; M&#39; &#10233; A &#8712;# &#119964; &#10233; A &lt; length a&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((a, b), M) &#8712; isa_vmtf &#119964; M&#39; &#10233; B &#8712;# &#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub> &#119964; &#10233; atm_of B &lt; length a&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span>  </span><span>isa_vmtf_def</span><span> </span><span>vmtf_def</span><span> </span><span>vmtf_&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_def</span><span> </span><span>atms_of_&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_&#119964;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub></span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>isa_vmtf_next_search_le</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((a, b, c, c&#39;, Some d), M) &#8712; isa_vmtf &#119964; M&#39; &#10233; d &lt; length a&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>isa_vmtf_def</span><span> </span><span>vmtf_def</span><span> </span><span>vmtf_&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_def</span><span> </span><span>atms_of_&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_&#119964;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub></span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>trail_pol_nempty</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;(([], aa, ab, ac, ad, b), L # ys) &#8712; trail_pol &#119964;&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>trail_pol_def</span><span> </span><span>ann_lits_split_reasons_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>is_decided_hd_trail_wl_heur</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;twl_st_wl_heur &#8658; bool&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_decided_hd_trail_wl_heur = (&#955;S. is_None (snd (last_trail_pol (get_trail_wl_heur S))))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>is_decided_hd_trail_wl_heur_hd_get_trail</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(RETURN o is_decided_hd_trail_wl_heur, RETURN o (&#955;M. is_decided (hd (get_trail_wl M))))
   &#8712; [&#955;M. get_trail_wl M &#8800; []]<span class="hidden">&#8681;</span><sub>f</sub> twl_st_heur_conflict_ana&#39; r &#8594; &#10216;bool_rel&#10217; nres_rel&#8250;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>frefI</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>is_decided_hd_trail_wl_heur_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span> </span><span>neq_Nil_conv</span><span>
</span><span>        </span><span>trail_pol_def</span><span> </span><span>ann_lits_split_reasons_def</span><span> </span><span>is_decided_no_proped_iff</span><span> </span><span>last_trail_pol_def</span><span>
</span><span>      </span><span>split</span><span class="delimiter">:</span><span> </span><span>option.splits</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>is_decided_hd_trail_wl_heur_pre</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_decided_hd_trail_wl_heur_pre =
    (&#955;S. fst (get_trail_wl_heur S) &#8800; [] &#8743; last_trail_pol_pre (get_trail_wl_heur S))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>skip_and_resolve_loop_wl_D_heur_inv</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;skip_and_resolve_loop_wl_D_heur_inv S<span class="hidden">&#8681;</span><sub>0</sub>&#39; =
    (&#955;(brk, S&#39;). &#8707;S S<span class="hidden">&#8681;</span><sub>0</sub>. (S&#39;, S) &#8712; twl_st_heur_conflict_ana &#8743; (S<span class="hidden">&#8681;</span><sub>0</sub>&#39;, S<span class="hidden">&#8681;</span><sub>0</sub>) &#8712; twl_st_heur_conflict_ana &#8743;
      skip_and_resolve_loop_wl_inv S<span class="hidden">&#8681;</span><sub>0</sub> brk S &#8743;
       length (get_clauses_wl_heur S&#39;) = length (get_clauses_wl_heur S<span class="hidden">&#8681;</span><sub>0</sub>&#39;))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>update_confl_tl_wl_heur_pre</span><span>
</span><span>   </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(nat &#215; nat literal) &#215; twl_st_wl_heur &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;update_confl_tl_wl_heur_pre =
  (&#955;((i, L), (M, N, D, W, Q, ((A, m, fst_As, lst_As, next_search), _), clvls, cach, lbd,
        outl, _)).
      i &gt; 0 &#8743;
      (fst M) &#8800; [] &#8743;
      atm_of ((last (fst M))) &lt; length A &#8743; (next_search &#8800; None &#10230;  the next_search &lt; length A) &#8743;
      L = (last (fst M))
      )&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>lit_and_ann_of_propagated_st_heur_pre</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;lit_and_ann_of_propagated_st_heur_pre = (&#955;((M, _, _, reasons, _), _). atm_of (last M) &lt; length reasons &#8743; M &#8800; [])&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>atm_is_in_conflict_st_heur_pre</span><span>
</span><span>   </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat literal &#215; twl_st_wl_heur &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_is_in_conflict_st_heur_pre  = (&#955;(L, (M,N,(_, (_, D)), _)). atm_of L &lt; length D)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>skip_and_resolve_loop_wl_D_heur</span><span>
</span><span>  </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;twl_st_wl_heur &#8658; twl_st_wl_heur nres&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;skip_and_resolve_loop_wl_D_heur S<span class="hidden">&#8681;</span><sub>0</sub> =
    do {
      (_, S) &#8592;
        WHILE<span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8663;</span><sup>skip_and_resolve_loop_wl_D_heur_inv S<span class="hidden">&#8681;</span><sub>0</sub><span class="hidden">&#8662;</span></sup>
        (&#955;(brk, S). &#172;brk &#8743; &#172;is_decided_hd_trail_wl_heur S)
        (&#955;(brk, S).
          do {
            ASSERT(&#172;brk &#8743; &#172;is_decided_hd_trail_wl_heur S);
            (L, C) &#8592; lit_and_ann_of_propagated_st_heur S;
            b &#8592; atm_is_in_conflict_st_heur (-L) S;
            if b then
	      tl_state_wl_heur S
            else do {
              b &#8592; maximum_level_removed_eq_count_dec_heur L S;
              if b
              then do {
                update_confl_tl_wl_heur L C S
              }
              else
                RETURN (True, S)
            }
          }
        )
        (False, S<span class="hidden">&#8681;</span><sub>0</sub>);
      RETURN S
    }
  &#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>atm_is_in_conflict_st_heur_is_in_conflict_st</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(uncurry (atm_is_in_conflict_st_heur), uncurry (mop_lit_notin_conflict_wl)) &#8712;
   [&#955;(L, S). True]<span class="hidden">&#8681;</span><sub>f</sub>
   Id &#215;<span class="hidden">&#8681;</span><sub>r</sub> twl_st_heur_conflict_ana &#8594; &#10216;Id&#10217; nres_rel&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;aaa &#8712;# &#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub> A &#10233; atm_of aaa  &#8712; atms_of (&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub> A)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>aaa</span><span> </span><span>A</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>atms_of_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>atm_is_in_conflict_st_heur_def</span><span> </span><span>twl_st_heur_def</span><span> </span><span>option_lookup_clause_rel_def</span><span> </span><span>uncurry_def</span><span> </span><span>comp_def</span><span>
</span><span>    </span><span>mop_lit_notin_conflict_wl_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>frefI</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>refine_rcg</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarsimp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>atm_in_conflict_lookup_pre</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_all_atms_all_lits</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>assumption</span><span class="delimiter">+</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>x1</span><span> </span><span>x2</span><span> </span><span>x1a</span><span> </span><span>x2a</span><span> </span><span>x1b</span><span> </span><span>x2b</span><span> </span><span>x1c</span><span> </span><span>x2c</span><span> </span><span>x1d</span><span> </span><span>x1e</span><span> </span><span>x2d</span><span> </span><span>x2e</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>atm_in_conflict_lookup_atm_in_conflict</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down_unRET_uncurry_Id</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;all_atms_st x2&#8250;</span></span></span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of x1&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (get_conflict_wl (snd y))&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_all_atms_all_lits</span><span> </span><span>atms_of_def</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_all_atms_all_lits</span><span> </span><span>atms_of_def</span><span> </span><span>option_lookup_clause_rel_def</span><span class="delimiter">)</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>atm_in_conflict_def</span><span> </span><span>atm_of_in_atms_of_iff</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>skip_and_resolve_loop_wl_alt_def</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;skip_and_resolve_loop_wl S<span class="hidden">&#8681;</span><sub>0</sub> =
    do {
      ASSERT(get_conflict_wl S<span class="hidden">&#8681;</span><sub>0</sub> &#8800; None);
      (_, S) &#8592;
        WHILE<span class="hidden">&#8681;</span><sub>T</sub><span class="hidden">&#8663;</span><sup>&#955;(brk, S). skip_and_resolve_loop_wl_inv S<span class="hidden">&#8681;</span><sub>0</sub> brk S<span class="hidden">&#8662;</span></sup>
        (&#955;(brk, S). &#172;brk &#8743; &#172;is_decided (hd (get_trail_wl S)))
        (&#955;(_, S).
          do {
            (L, C) &#8592; mop_hd_trail_wl S;
            b &#8592; mop_lit_notin_conflict_wl (-L) S;
            if b then
              mop_tl_state_wl S
            else do {
              b &#8592; mop_maximum_level_removed_wl L S;
              if b
              then do {
                mop_update_confl_tl_wl L C S
              }
              else
                do {RETURN (True, S)}
           }
          }
        )
        (False, S<span class="hidden">&#8681;</span><sub>0</sub>);
      RETURN S
    }&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>skip_and_resolve_loop_wl_def</span><span> </span><span>calculate_LBD_st_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>cong</span><span class="delimiter">:</span><span> </span><span>if_cong</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>skip_and_resolve_loop_wl_D_heur_skip_and_resolve_loop_wl_D</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(skip_and_resolve_loop_wl_D_heur, skip_and_resolve_loop_wl)
    &#8712; twl_st_heur_conflict_ana&#39; r &#8594;<span class="hidden">&#8681;</span><sub>f</sub> &#10216;twl_st_heur_conflict_ana&#39; r&#10217;nres_rel&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H</span><span class="delimiter">[</span><span>refine0</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(x, y) &#8712; twl_st_heur_conflict_ana &#10233;
           ((False, x), False, y)
           &#8712; bool_rel &#215;<span class="hidden">&#8681;</span><sub>f</sub>
              twl_st_heur_conflict_ana&#39; (length (get_clauses_wl_heur x))&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x</span><span> </span><span>y</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span><span> </span><span class="delimiter">[</span><span class="delimiter">[</span><span>goals_limit</span><span class="delimiter">=</span><span>1</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>skip_and_resolve_loop_wl_D_heur_def</span><span> </span><span>skip_and_resolve_loop_wl_alt_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>frefI</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span>
</span><span>        </span><span>update_confl_tl_wl_heur_update_confl_tl_wl</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down_curry2</span><span class="delimiter">,</span><span> </span><span>unfolded</span><span> </span><span>comp_def</span><span class="delimiter">]</span><span>
</span><span>        </span><span>maximum_level_removed_eq_count_dec_heur_maximum_level_removed_eq_count_dec</span><span>
</span><span>          </span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down_curry</span><span class="delimiter">]</span><span> </span><span>lit_and_ann_of_propagated_st_heur_lit_and_ann_of_propagated_st</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down</span><span class="delimiter">]</span><span>
</span><span>       </span><span>tl_state_wl_heur_tl_state_wl</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down</span><span class="delimiter">]</span><span>
</span><span>       </span><span>atm_is_in_conflict_st_heur_is_in_conflict_st</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>fref_to_Down_curry</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>S</span><span> </span><span>T</span><span> </span><span>brkS</span><span> </span><span>brkT</span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>skip_and_resolve_loop_wl_D_heur_inv_def</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>case_prod_beta</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;snd brkT&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;T&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>asm</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>surjective_pairing</span><span class="delimiter">[</span><span>of</span><span> </span><span>brkS</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>asm</span><span class="delimiter">)</span><span> </span><span>surjective_pairing</span><span class="delimiter">[</span><span>of</span><span> </span><span>brkT</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>prod_rel_iff</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>xa</span><span> </span><span>x&#39;</span><span> </span><span>x1</span><span> </span><span>x2</span><span> </span><span>x1a</span><span> </span><span>x2a</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>is_decided_hd_trail_wl_heur_hd_get_trail</span><span class="delimiter">[</span><span>of</span><span> </span><span>r</span><span class="delimiter">,</span><span> </span><span>THEN</span><span> </span><span>fref_to_Down_unRET_Id</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>x2a</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>skip_and_resolve_loop_wl_inv_def</span><span> </span><span>skip_and_resolve_loop_inv_l_def</span><span> </span><span>skip_and_resolve_loop_inv_def</span><span>
</span><span>       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>asm</span><span class="delimiter">)</span><span> </span><span>case_prod_beta</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>       </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>prod.case</span><span>
</span><span>       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>normalize_goal</span><span class="delimiter">+</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>-</span><span class="delimiter">)</span><span> </span><span>get_count_max_lvls_code</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;get_count_max_lvls_code = (&#955;(_, _, _, _, _, _, _, clvls, _). clvls)&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>is_decided_hd_trail_wl_heur_alt_def</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_decided_hd_trail_wl_heur = (&#955;(M, _). is_None (snd (last_trail_pol M)))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ext</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>is_decided_hd_trail_wl_heur_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>atm_of_in_atms_of</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of x &#8712; atms_of C &#10231; x &#8712;# C &#8744; -x &#8712;# C&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>atm_of_notin_atms_of_iff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>atm_is_in_conflict</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_is_in_conflict L D &#10231; atm_of L &#8712; atms_of (the D)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>is_in_option_lookup_conflict</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>is_in_option_lookup_conflict_def</span><span class="delimiter">[</span><span>simp</span><span> </span><span>del</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_in_option_lookup_conflict L (a, n, xs) &#10231; is_in_lookup_conflict (n, xs) L&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>is_in_option_lookup_conflict_atm_is_in_conflict_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;ba &#8800; None&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>aa</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;aa &#8712;# &#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub> &#119964;&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>uaa</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;- aa &#8713;# the ba&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((b, c, d), ba) &#8712; option_lookup_clause_rel &#119964;&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_in_option_lookup_conflict aa (b, c, d) =
         atm_is_in_conflict aa ba&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>yb</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ba</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;ba = Some yb&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mset_as_position d yb&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>le</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;L&#8712;atms_of (&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub> &#119964;). L &lt; length d&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;b&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>option_lookup_clause_rel_def</span><span> </span><span>lookup_clause_rel_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>aa_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of aa &lt; length d&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>uaa_d</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;atm_of (-aa) &lt; length d&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>le</span><span> </span><span>aa</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>in_&#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub>_atm_of_in_atms_of_iff</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>mset_as_position_in_iff_nth</span><span class="delimiter">[</span><span>OF</span><span> </span><span>map</span><span> </span><span>aa_d</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(aa &#8712;# yb) = (d ! atm_of aa = Some (is_pos aa))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>mset_as_position_in_iff_nth</span><span class="delimiter">[</span><span>OF</span><span> </span><span>map</span><span> </span><span>uaa_d</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>2</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(d ! atm_of aa &#8800; Some (is_pos (-aa)))&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>uaa</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>uaa</span><span> </span><span>1</span><span> </span><span>2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>is_in_lookup_conflict_def</span><span> </span><span>is_in_option_lookup_conflict_def</span><span> </span><span>atm_is_in_conflict_def</span><span>
</span><span>        </span><span>atm_of_in_atms_of</span><span> </span><span>is_neg_neg_not_is_neg</span><span>
</span><span>        </span><span>split</span><span class="delimiter">:</span><span> </span><span>option.splits</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>is_in_option_lookup_conflict_atm_is_in_conflict</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(uncurry (RETURN oo is_in_option_lookup_conflict), uncurry (RETURN oo atm_is_in_conflict))
   &#8712; [&#955;(L, D). D &#8800; None &#8743; L &#8712;# &#8466;<span class="hidden">&#8681;</span><sub>a</sub><span class="hidden">&#8681;</span><sub>l</sub><span class="hidden">&#8681;</span><sub>l</sub> &#119964; &#8743; -L &#8713;# the D]<span class="hidden">&#8681;</span><sub>f</sub>
      Id &#215;<span class="hidden">&#8681;</span><sub>f</sub> option_lookup_clause_rel &#119964; &#8594; &#10216;bool_rel&#10217;nres_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>intro</span><span> </span><span>frefI</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>case_tac</span><span> </span><span>x</span><span class="delimiter">,</span><span> </span><span>case_tac</span><span> </span><span>y</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>is_in_option_lookup_conflict_atm_is_in_conflict_iff</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>&#119964;</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>is_in_option_lookup_conflict_alt_def</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;RETURN oo is_in_option_lookup_conflict =
     RETURN oo (&#955;L (_, n, xs). is_in_lookup_conflict (n, xs) L)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>ext</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>is_in_option_lookup_conflict_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>skip_and_resolve_loop_wl_DI</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;skip_and_resolve_loop_wl_D_heur_inv S (b, T)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_decided_hd_trail_wl_heur_pre T&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>skip_and_resolve_loop_wl_inv_def</span><span> </span><span>skip_and_resolve_loop_inv_l_def</span><span> </span><span>skip_and_resolve_loop_inv_def</span><span>
</span><span>     </span><span>skip_and_resolve_loop_wl_D_heur_inv_def</span><span> </span><span>is_decided_hd_trail_wl_heur_pre_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span class="delimiter">(</span><span>asm</span><span class="delimiter">)</span><span> </span><span>case_prod_beta</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>prod.case</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>normalize_goal</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>clarsimp</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>twl_st_heur_def</span><span> </span><span>state_wl_l_def</span><span> </span><span>twl_st_l_def</span><span> </span><span>twl_st_heur_conflict_ana_def</span><span>
</span><span>    </span><span>trail_pol_alt_def</span><span> </span><span>last_trail_pol_pre_def</span><span> </span><span>last_rev</span><span> </span><span>hd_map</span><span> </span><span>literals_are_in_&#8466;<span class="hidden">&#8681;</span><sub>i</sub><span class="hidden">&#8681;</span><sub>n</sub>_trail_def</span><span> </span><span>simp</span><span> </span><span>flip</span><span class="delimiter">:</span><span> </span><span>rev_map</span><span>
</span><span>    </span><span>dest</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>case_tac</span><span> </span><span>x</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>clarsimp_all</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>ann_lits_split_reasons_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>isasat_fast_after_skip_and_resolve_loop_wl_D_heur_inv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;isasat_fast x &#10233;
       skip_and_resolve_loop_wl_D_heur_inv x
        (False, a2&#39;) &#10233; isasat_fast a2&#39;&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>skip_and_resolve_loop_wl_D_heur_inv_def</span><span> </span><span>isasat_fast_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>

</div>
</body>
<div class=body><footer><p><table border=0  width=700> <tr><th>Isabelle version:</th><th>AFP version:</th><th>IsaFoL version:</th><th>Last compilation:</th></tr>

<tr><td align="center">Isabelle2020 </td><td align="center">6b713b029127 </td><td align="center">6e93a5c7 </td><td align="center">Sat 25 Apr 2020 10:00:01 AM CEST </td></tr></table></p></footer></div>

</html>


