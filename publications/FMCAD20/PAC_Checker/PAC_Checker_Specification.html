<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory PAC_Checker_Specification (repository version)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory PAC_Checker_Specification</h1>

<span class="command">theory</span> <span class="name">PAC_Checker_Specification</span><br/>
<span class="keyword">imports</span> <a href="PAC_Specification.html"><span class="name">PAC_Specification</span></a> <a href="../../AFP/Sepref_IICF/IICF.html"><span class="name">IICF</span></a> <a href="Finite_Map_Multiset.html"><span class="name">Finite_Map_Multiset</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">theory</span></span><span> </span><span>PAC_Checker_Specification</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>PAC_Specification</span><span>
</span><span>    </span><span>Refine_Imperative_HOL.IICF</span><span>
</span><span>    </span><span>Finite_Map_Multiset</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Checker Algorithm&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;

In this level of refinement, we define the first level of the
implementation of the checker, both with the specification as
on ideals and the first version of the loop.

&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Specification&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">datatype</span></span><span> </span><span>status</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>is_failed</span><span class="delimiter">:</span><span> </span><span>FAILED</span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span>is_success</span><span class="delimiter">:</span><span> </span><span>SUCCESS</span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span>is_found</span><span class="delimiter">:</span><span> </span><span>FOUND</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>is_success_alt_def</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_success a &#10231; a = SUCCESS&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>a</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">datatype</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;a</span><span class="delimiter">,</span><span> </span><span class="tfree">&#39;b</span><span class="delimiter">,</span><span> </span><span class="tfree">&#39;lbls</span><span class="delimiter">)</span><span> </span><span>pac_step</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>Add</span><span> </span><span class="delimiter">(</span><span>pac_src1</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;lbls</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>pac_src2</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;lbls</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>new_id</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;lbls</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>pac_res</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;a</span><span class="delimiter">)</span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span>Mult</span><span> </span><span class="delimiter">(</span><span>pac_src1</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;lbls</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>pac_mult</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;a</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>new_id</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;lbls</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>pac_res</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;a</span><span class="delimiter">)</span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span>Extension</span><span> </span><span class="delimiter">(</span><span>new_id</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;lbls</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>new_var</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;b</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>pac_res</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;a</span><span class="delimiter">)</span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span>Del</span><span> </span><span class="delimiter">(</span><span>pac_src1</span><span class="delimiter">:</span><span> </span><span class="tfree">&#39;lbls</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span>  </span><span>pac_state</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(nat set &#215; int_poly multiset)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>PAC_checker_specification</span><span>
</span><span>  </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int_poly &#8658; int_poly multiset &#8658; (status &#215; nat set &#215; int_poly multiset) nres&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_checker_specification spec A = SPEC(&#955;(b, &#119985;, B).
      (&#172;is_failed b &#10230; restricted_ideal_to<span class="hidden">&#8681;</span><sub>I</sub> (&#8899;(vars ` set_mset A) &#8746; vars spec) B &#8838; restricted_ideal_to<span class="hidden">&#8681;</span><sub>I</sub> (&#8899;(vars ` set_mset A) &#8746; vars spec) A) &#8743;
      (is_found b &#10230; spec &#8712; pac_ideal (set_mset A)))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>PAC_checker_specification_spec</span><span>
</span><span>  </span><span class="delimiter">::</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int_poly &#8658; pac_state &#8658; (status &#215; pac_state) &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_checker_specification_spec spec = (&#955;(&#119985;, A) (b, B). (&#172;is_failed b &#10230; &#8899;(vars ` set_mset A) &#8838; &#119985;) &#8743;
       (is_success b &#10230; PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, A) B) &#8743;
       (is_found b &#10230; PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, A) B &#8743; spec &#8712; pac_ideal (set_mset A)))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>PAC_checker_specification2</span><span>
</span><span>  </span><span class="delimiter">::</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int_poly &#8658; (nat set &#215; int_poly multiset) &#8658; (status &#215; (nat set &#215; int_poly multiset)) nres&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_checker_specification2 spec A &#8801; SPEC(PAC_checker_specification_spec spec A)&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>PAC_checker_specification_step_spec</span><span>
</span><span>  </span><span class="delimiter">::</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;pac_state &#8658; int_poly &#8658; pac_state &#8658; (status &#215; pac_state) &#8658; bool&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_checker_specification_step_spec = (&#955;(&#119985;<span class="hidden">&#8681;</span><sub>0</sub>, A<span class="hidden">&#8681;</span><sub>0</sub>) spec (&#119985;, A) (b, B).
       (is_success b &#10230;
         &#8899;(vars ` set_mset A<span class="hidden">&#8681;</span><sub>0</sub>) &#8838; &#119985;<span class="hidden">&#8681;</span><sub>0</sub> &#8743;
          &#8899;(vars ` set_mset A) &#8838; &#119985; &#8743; PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;<span class="hidden">&#8681;</span><sub>0</sub>, A<span class="hidden">&#8681;</span><sub>0</sub>) (&#119985;, A) &#8743; PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, A) B) &#8743;
       (is_found b &#10230;
          &#8899;(vars ` set_mset A<span class="hidden">&#8681;</span><sub>0</sub>) &#8838; &#119985;<span class="hidden">&#8681;</span><sub>0</sub> &#8743;
          &#8899;(vars ` set_mset A) &#8838; &#119985; &#8743; PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;<span class="hidden">&#8681;</span><sub>0</sub>, A<span class="hidden">&#8681;</span><sub>0</sub>) (&#119985;, A) &#8743; PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, A) B &#8743;
         spec &#8712; pac_ideal (set_mset A<span class="hidden">&#8681;</span><sub>0</sub>)))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>PAC_checker_specification_step2</span><span>
</span><span>  </span><span class="delimiter">::</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;pac_state &#8658; int_poly &#8658; pac_state &#8658; (status &#215; pac_state) nres&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_checker_specification_step2 A<span class="hidden">&#8681;</span><sub>0</sub> spec A &#8801; SPEC(PAC_checker_specification_step_spec A<span class="hidden">&#8681;</span><sub>0</sub>  spec A)&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>normalize_poly_spec</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;_&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;normalize_poly_spec p = SPEC (&#955;r. p - r &#8712; ideal polynom_bool &#8743; vars r &#8838; vars p)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>normalize_poly_spec_alt_def</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;normalize_poly_spec p = SPEC (&#955;r. r - p &#8712; ideal polynom_bool &#8743; vars r &#8838; vars p)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>normalize_poly_spec_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>ideal.span_neg</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>mult_poly_spec</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int mpoly &#8658; int mpoly &#8658; int mpoly nres&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;mult_poly_spec p q = SPEC (&#955;r. p * q - r &#8712; ideal polynom_bool)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>check_add</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(nat, int mpoly) fmap &#8658; nat set &#8658; nat &#8658; nat &#8658; nat &#8658; int mpoly &#8658; bool nres&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;check_add A &#119985; p q i r =
     SPEC(&#955;b. b &#10230; p &#8712;# dom_m A &#8743; q &#8712;# dom_m A &#8743; i &#8713;# dom_m A &#8743; vars r &#8838; &#119985; &#8743;
            the (fmlookup A p) + the (fmlookup A q) - r &#8712;  ideal polynom_bool)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>check_mult</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(nat, int mpoly) fmap &#8658; nat set &#8658; nat &#8658; int mpoly &#8658; nat &#8658; int mpoly &#8658; bool nres&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;check_mult A &#119985; p q i r =
     SPEC(&#955;b. b &#10230; p &#8712;# dom_m A &#8743;i &#8713;# dom_m A &#8743; vars q &#8838; &#119985; &#8743; vars r &#8838; &#119985; &#8743;
            the (fmlookup A p) * q - r &#8712;  ideal polynom_bool)&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>check_extension</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(nat, int mpoly) fmap &#8658; nat set &#8658; nat &#8658; nat &#8658; int mpoly &#8658; (bool) nres&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;check_extension A &#119985; i v p =
     SPEC(&#955;b. b &#10230; (i &#8713;# dom_m A &#8743;
     (v &#8713; &#119985; &#8743;
           (p+Var v)<span class="hidden">&#8679;</span><sup>2</sup> - (p+Var v) &#8712; ideal polynom_bool &#8743;
            vars (p+Var v) &#8838; &#119985;)))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>merge_status</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status (FAILED) _ = FAILED&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status _ (FAILED) = FAILED&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status FOUND _ = FOUND&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status _ FOUND = FOUND&#8250;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status _ _ = SUCCESS&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span>fpac_step</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;nat set &#215; (nat, int_poly) fmap&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>check_del</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(nat, int mpoly) fmap &#8658; nat &#8658; bool nres&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;check_del A p =
     SPEC(&#955;b. b &#10230; True)&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Algorithm&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>PAC_checker_step</span><span>
</span><span>  </span><span class="delimiter">::</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int_poly &#8658; (status &#215; fpac_step) &#8658; (int_poly, nat, nat) pac_step &#8658;
    (status &#215; fpac_step) nres&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_checker_step = (&#955;spec (stat, (&#119985;, A)) st. case st of
     Add _ _ _ _ &#8658;
       do {
         r &#8592; normalize_poly_spec (pac_res st);
        eq &#8592; check_add A &#119985; (pac_src1 st) (pac_src2 st) (new_id st) r;
        st&#39; &#8592; SPEC(&#955;st&#39;. (&#172;is_failed st&#39; &#8743; is_found st&#39; &#10230; r - spec &#8712; ideal polynom_bool));
        if eq
        then RETURN (merge_status stat st&#39;,
          &#119985;, fmupd (new_id st) r A)
        else RETURN (FAILED, (&#119985;, A))
   }
   | Del _ &#8658;
       do {
        eq &#8592; check_del A (pac_src1 st);
        if eq
        then RETURN (stat, (&#119985;, fmdrop (pac_src1 st) A))
        else RETURN (FAILED, (&#119985;, A))
   }
   | Mult _ _ _ _ &#8658;
       do {
         r &#8592; normalize_poly_spec (pac_res st);
         q &#8592; normalize_poly_spec (pac_mult st);
        eq &#8592; check_mult A &#119985; (pac_src1 st) q (new_id st) r;
        st&#39; &#8592; SPEC(&#955;st&#39;. (&#172;is_failed st&#39; &#8743; is_found st&#39; &#10230; r - spec &#8712; ideal polynom_bool));
        if eq
        then RETURN (merge_status stat st&#39;,
          &#119985;, fmupd (new_id st) r A)
        else RETURN (FAILED, (&#119985;, A))
   }
   | Extension _ _ _ &#8658;
       do {
         r &#8592; normalize_poly_spec (pac_res st - Var (new_var st));
        (eq) &#8592; check_extension A &#119985; (new_id st) (new_var st) r;
        if eq
        then do {
         RETURN (stat,
          insert (new_var st) &#119985;, fmupd (new_id st) (r) A)}
        else RETURN (FAILED, (&#119985;, A))
   }
 )&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>polys_rel</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((nat, int mpoly)fmap &#215; _) set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;polys_rel = {(A, B). B = (ran_m A)}&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>polys_rel_full</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((nat set &#215; (nat, int mpoly)fmap) &#215; _) set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;polys_rel_full = {((&#119985;, A), (&#119985;&#39; , B)). (A, B) &#8712; polys_rel &#8743; &#119985; = &#119985;&#39;}&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>polys_rel_update_remove</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x13 &#8713;#dom_m A &#10233; x11 &#8712;# dom_m A &#10233; x12 &#8712;# dom_m A &#10233; x11 &#8800; x12 &#10233; (A,B) &#8712; polys_rel &#10233;
   (fmupd x13 r (fmdrop x11 (fmdrop x12 A)),
        add_mset r B - {#the (fmlookup A x11), the (fmlookup A x12)#})
       &#8712; polys_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x13 &#8713;#dom_m A &#10233; x11 &#8712;# dom_m A &#10233; (A,B) &#8712; polys_rel &#10233;
   (fmupd x13 r (fmdrop x11 A),add_mset r B - {#the (fmlookup A x11)#})
       &#8712; polys_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x13 &#8713;#dom_m A &#10233; (A,B) &#8712; polys_rel &#10233;
   (fmupd x13 r A, add_mset r B) &#8712; polys_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x13 &#8712;#dom_m A &#10233; (A,B) &#8712; polys_rel &#10233;
   (fmdrop x13 A, remove1_mset (the (fmlookup A x13)) B) &#8712; polys_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>distinct_mset_dom</span><span class="delimiter">[</span><span>of</span><span> </span><span>A</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>polys_rel_def</span><span> </span><span>ran_m_mapsto_upd</span><span> </span><span>ran_m_mapsto_upd_notin</span><span>
</span><span>    </span><span>ran_m_fmdrop</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>ran_m_mapsto_upd_notin</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>in_diffD</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>ran_m_fmdrop</span><span> </span><span>ran_m_fmdrop_If</span><span> </span><span>distinct_mset_remove1_All</span><span> </span><span>ran_m_def</span><span>
</span><span>      </span><span>add_mset_eq_add_mset</span><span> </span><span>removeAll_notin</span><span>
</span><span>    </span><span>split</span><span class="delimiter">:</span><span> </span><span>if_splits</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>image_mset_cong</span><span class="delimiter">)</span><span>
</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>count_inI</span><span> </span><span>diff_single_trivial</span><span> </span><span>fmlookup_drop</span><span> </span><span>image_mset_cong2</span><span> </span><span>replicate_mset_0</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>polys_rel_in_dom_inD</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A, B) &#8712; polys_rel &#10233;
    x12 &#8712;# dom_m A &#10233;
    the (fmlookup A x12) &#8712;# B&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>polys_rel_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>PAC_Format_add_and_remove</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;r - x14 &#8712; More_Modules.ideal polynom_bool &#10233;
       (A, B) &#8712; polys_rel &#10233;
       x12 &#8712;# dom_m A &#10233;
       x13 &#8713;# dom_m A &#10233;
       vars r &#8838; &#119985; &#10233;
       2 * the (fmlookup A x12) - r &#8712; More_Modules.ideal polynom_bool &#10233;
       PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, B) (&#119985;, remove1_mset (the (fmlookup A x12)) (add_mset r B))&#8250;</span></span></span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;r - x14 &#8712; More_Modules.ideal polynom_bool &#10233;
       (A, B) &#8712; polys_rel &#10233;
       the (fmlookup A x11) + the (fmlookup A x12) - r &#8712; More_Modules.ideal polynom_bool &#10233;
       x11 &#8712;# dom_m A &#10233;
       x12 &#8712;# dom_m A &#10233;
       vars r &#8838; &#119985; &#10233;
       PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, B) (&#119985;, add_mset r B)&#8250;</span></span></span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;r - x14 &#8712; More_Modules.ideal polynom_bool &#10233;
       (A, B) &#8712; polys_rel &#10233;
       x11 &#8712;# dom_m A &#10233;
       x12 &#8712;# dom_m A &#10233;
       the (fmlookup A x11) + the (fmlookup A x12) - r &#8712; More_Modules.ideal polynom_bool &#10233;
       vars r &#8838; &#119985; &#10233;
       x11 &#8800; x12 &#10233;
       PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, B)
        (&#119985;, add_mset r B - {#the (fmlookup A x11), the (fmlookup A x12)#})&#8250;</span></span></span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A, B) &#8712; polys_rel &#10233;
       r - x34 &#8712; More_Modules.ideal polynom_bool &#10233;
       x11 &#8712;# dom_m A &#10233;
       the (fmlookup A x11) * x32 - r &#8712; More_Modules.ideal polynom_bool &#10233;
       vars x32 &#8838; &#119985; &#10233;
       vars r &#8838; &#119985; &#10233;
       PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, B) (&#119985;, add_mset r B)&#8250;</span></span></span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A, B) &#8712; polys_rel &#10233;
       r - x34 &#8712; More_Modules.ideal polynom_bool &#10233;
       x11 &#8712;# dom_m A &#10233;
       the (fmlookup A x11) * x32 - r &#8712; More_Modules.ideal polynom_bool &#10233;
       vars x32 &#8838; &#119985; &#10233;
       vars r &#8838; &#119985; &#10233;
       PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, B) (&#119985;, remove1_mset (the (fmlookup A x11)) (add_mset r B))&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A, B) &#8712; polys_rel &#10233;
       x12 &#8712;# dom_m A &#10233;
       PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, B) (&#119985;, remove1_mset (the (fmlookup A x12)) B)&#8250;</span></span></span><span>
</span><span>   </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A, B) &#8712; polys_rel &#10233;
       (p&#39; + Var x)<span class="hidden">&#8679;</span><sup>2</sup> - (p&#39; + Var x) &#8712; ideal polynom_bool &#10233;
       x &#8713; &#119985; &#10233;
       x &#8713; vars(p&#39; + Var x) &#10233;
       vars(p&#39; + Var x) &#8838; &#119985; &#10233;
       PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;, B)
         (insert x &#119985;, add_mset p&#39; B)&#8250;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>converse_rtranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>PAC_Format.add</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span> </span><span>B</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>polys_rel_in_dom_inD</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>converse_rtranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>PAC_Format.del</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>polys_rel_in_dom_inD</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span>H2</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>converse_rtranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>PAC_Format.add</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x11)&#8250;</span></span></span><span> </span><span>B</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>polys_rel_in_dom_inD</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_trans</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>H2</span><span class="delimiter">;</span><span> </span><span>assumption</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>converse_rtranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>PAC_Format.del</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>polys_rel_in_dom_inD</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>converse_rtranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>PAC_Format.del</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x11)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>polys_rel_in_dom_inD</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>polys_rel_def</span><span> </span><span>ran_m_def</span><span> </span><span>add_mset_eq_add_mset</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span>H2</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>converse_rtranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>PAC_Format.mult</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x11)&#8250;</span></span></span><span> </span><span>B</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x32&#8250;</span></span></span><span> </span><span>r</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>polys_rel_in_dom_inD</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>rtranclp_trans</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>H2</span><span class="delimiter">;</span><span> </span><span>assumption</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>converse_rtranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>PAC_Format.del</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x11)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>polys_rel_in_dom_inD</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>converse_rtranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>PAC_Format.del</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span> </span><span>B</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>polys_rel_in_dom_inD</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>converse_rtranclp_into_rtranclp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>PAC_Format.extend_pos</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;p&#39; + Var x&#8250;</span></span></span><span> </span><span>_</span><span> </span><span>x</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>coeff_monomila_in_varsD</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;p&#39; - Var x&#8250;</span></span></span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>polys_rel_in_dom_inD</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>vars_in_right_only</span><span> </span><span>vars_subst_in_left_only</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subgoal_tac</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#119985; &#8746; {x&#39; &#8712; vars (p&#39;). x&#39; &#8713; &#119985;} = insert x &#119985;&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>coeff_monomila_in_varsD</span><span class="delimiter">[</span><span>of</span><span> </span><span>p&#39;</span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>vars_add_Var_subset</span><span> </span><span>vars_minus_Var_subset</span><span> </span><span>polys_rel_in_dom_inD</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>vars_subst_in_left_only_iff</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>vars_in_right_only</span><span> </span><span>vars_subst_in_left_only</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>status_rel</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(status &#215; status) set&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;status_rel &#8801; Id&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>is_merge_status</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_failed (merge_status a st&#39;) &#10231; is_failed a &#8744; is_failed st&#39;&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_found (merge_status a st&#39;) &#10231; &#172;is_failed a &#8743; &#172;is_failed st&#39; &#8743; (is_found a &#8744; is_found st&#39;)&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_success (merge_status a st&#39;) &#10231; (is_success a &#8743; is_success st&#39;)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>a</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span>st&#39;</span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>status_rel_merge_status</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(merge_status a b, SUCCESS) &#8713; status_rel &#10231;
    (a = FAILED) &#8744; (b = FAILED) &#8744;
    a = FOUND &#8744; (b = FOUND)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>a</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span>b</span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Ex_status_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#8707;a. P a) &#10231; P SUCCESS &#8744; P FOUND &#8744; (P (FAILED))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>case_tac</span><span> </span><span>a</span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>is_failed_alt_def</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;is_failed st&#39; &#10231; &#172;is_success st&#39; &#8743; &#172;is_found st&#39;&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>st&#39;</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>merge_status_eq_iff</span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status a SUCCESS = SUCCESS &#10231; a = SUCCESS&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status a SUCCESS = FOUND &#10231; a = FOUND&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status SUCCESS a = SUCCESS &#10231; a = SUCCESS&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status SUCCESS a = FOUND &#10231; a = FOUND&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status SUCCESS a = FAILED &#10231; a = FAILED&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status a SUCCESS = FAILED &#10231; a = FAILED&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status FOUND a = FAILED &#10231; a = FAILED&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status a FOUND = FAILED &#10231; a = FAILED&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status a FOUND = SUCCESS &#10231; False&#8250;</span></span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status a b = FOUND &#10231; (a = FOUND &#8744; b = FOUND) &#8743; (a &#8800; FAILED &#8743; b &#8800; FAILED)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>a</span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>a</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span>b</span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>fmdrop_irrelevant</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x11 &#8713;# dom_m A &#10233; fmdrop x11 A = A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fmap_ext</span><span> </span><span>in_dom_m_lookup_iff</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>PAC_checker_step_PAC_checker_specification2</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>a</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;status&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>AB</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;((&#119985;, A),(&#119985;<span class="hidden">&#8681;</span><sub>B</sub>, B)) &#8712; polys_rel_full&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172;is_failed a&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;a = FOUND &#10233; spec &#8712; pac_ideal (set_mset A<span class="hidden">&#8681;</span><sub>0</sub>)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>A<span class="hidden">&#8681;</span><sub>0</sub>B</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_Format<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> (&#119985;<span class="hidden">&#8681;</span><sub>0</sub>, A<span class="hidden">&#8681;</span><sub>0</sub>) (&#119985;, B)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>spec<span class="hidden">&#8681;</span><sub>0</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;vars spec &#8838; &#119985;<span class="hidden">&#8681;</span><sub>0</sub>&#8250;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>vars_A<span class="hidden">&#8681;</span><sub>0</sub></span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8899; (vars ` set_mset A<span class="hidden">&#8681;</span><sub>0</sub>) &#8838; &#119985;<span class="hidden">&#8681;</span><sub>0</sub>&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_checker_step spec (a, (&#119985;, A)) st &#8804; &#8659; (status_rel &#215;<span class="hidden">&#8681;</span><sub>r</sub> polys_rel_full) (PAC_checker_specification_step2 (&#119985;<span class="hidden">&#8681;</span><sub>0</sub>, A<span class="hidden">&#8681;</span><sub>0</sub>) spec (&#119985;, B))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#119985;<span class="hidden">&#8681;</span><sub>B</sub> = &#119985;&#8250;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A, B) &#8712; polys_rel&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>AB</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>polys_rel_full_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249; x12 &#8712;# dom_m A &#10233;
       2 * the (fmlookup A x12) - r &#8712; More_Modules.ideal polynom_bool &#10233;
       r - spec &#8712; More_Modules.ideal polynom_bool &#10233;
       vars spec &#8838; vars r &#10233;
       spec &#8712; pac_ideal (set_mset B)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x12</span><span> </span><span>r</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A,B) &#8712; polys_rel&#8250;</span></span></span><span>
</span><span>      </span><span>ideal.span_add</span><span class="delimiter">[</span><span>OF</span><span> </span><span>ideal.span_add</span><span class="delimiter">[</span><span>OF</span><span> </span><span>ideal.span_neg</span><span> </span><span>ideal.span_neg</span><span class="delimiter">,</span><span>
</span><span>         </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span> </span><span>_</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span>
</span><span>      </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset B &#8746; polynom_bool&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;2 * the (fmlookup A x12) - r&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>polys_rel_def</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subgoal_tac</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;r &#8712; pac_ideal (set_mset B)&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>ran_m_def</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>diff_in_polynom_bool_pac_idealI</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>ab_semigroup_mult_class.mult.commute</span><span> </span><span>diff_in_polynom_bool_pac_idealI</span><span>
</span><span>       </span><span>ideal.span_base</span><span> </span><span>pac_idealI3</span><span> </span><span>set_image_mset</span><span> </span><span>set_mset_add_mset_insert</span><span> </span><span>union_single_eq_member</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H2</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x11 &#8712;# dom_m A &#10233;
       x12 &#8712;# dom_m A &#10233;
       the (fmlookup A x11) + the (fmlookup A x12) - r
       &#8712; More_Modules.ideal polynom_bool &#10233;
       r - spec &#8712; More_Modules.ideal polynom_bool &#10233;
       spec &#8712; pac_ideal (set_mset B)&#8250;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x12</span><span> </span><span>r</span><span> </span><span>x11</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A,B) &#8712; polys_rel&#8250;</span></span></span><span>
</span><span>      </span><span>ideal.span_add</span><span class="delimiter">[</span><span>OF</span><span> </span><span>ideal.span_add</span><span class="delimiter">[</span><span>OF</span><span> </span><span>ideal.span_neg</span><span> </span><span>ideal.span_neg</span><span class="delimiter">,</span><span>
</span><span>         </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x11)&#8250;</span></span></span><span> </span><span>_</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span>
</span><span>      </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset B &#8746; polynom_bool&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x11) + the (fmlookup A x12) - r&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>polys_rel_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subgoal_tac</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;r &#8712; pac_ideal (set_mset B)&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>ran_m_def</span><span> </span><span>ideal.span_base</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>diff_in_polynom_bool_pac_idealI</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Un_insert_left</span><span> </span><span>diff_diff_eq2</span><span> </span><span>diff_in_polynom_bool_pac_idealI</span><span> </span><span>diff_zero</span><span>
</span><span>       </span><span>ideal.span_diff</span><span> </span><span>ideal.span_neg</span><span> </span><span>minus_diff_eq</span><span> </span><span>pac_idealI1</span><span> </span><span>pac_ideal_def</span><span> </span><span>set_image_mset</span><span>
</span><span>       </span><span>set_mset_add_mset_insert</span><span> </span><span>union_single_eq_member</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H3</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x12 &#8712;# dom_m A &#10233;
       the (fmlookup A x12) * q - r &#8712; More_Modules.ideal polynom_bool &#10233;
       r - spec &#8712; More_Modules.ideal polynom_bool &#10233;
       spec &#8712; pac_ideal (set_mset B)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x12</span><span> </span><span>r</span><span> </span><span>q</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A,B) &#8712; polys_rel&#8250;</span></span></span><span>
</span><span>      </span><span>ideal.span_add</span><span class="delimiter">[</span><span>OF</span><span> </span><span>ideal.span_add</span><span class="delimiter">[</span><span>OF</span><span> </span><span>ideal.span_neg</span><span> </span><span>ideal.span_neg</span><span class="delimiter">,</span><span>
</span><span>         </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span> </span><span>_</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;the (fmlookup A x12)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span>
</span><span>      </span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset B &#8746; polynom_bool&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;2 * the (fmlookup A x12) - r&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>polys_rel_def</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subgoal_tac</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;r &#8712; pac_ideal (set_mset B)&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>ran_m_def</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>diff_in_polynom_bool_pac_idealI</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>ab_semigroup_mult_class.mult.commute</span><span> </span><span>diff_in_polynom_bool_pac_idealI</span><span>
</span><span>       </span><span>ideal.span_base</span><span> </span><span>pac_idealI3</span><span> </span><span>set_image_mset</span><span> </span><span>set_mset_add_mset_insert</span><span> </span><span>union_single_eq_member</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;spec &#8712; pac_ideal (set_mset B) &#10233; spec &#8712; pac_ideal (set_mset A<span class="hidden">&#8681;</span><sub>0</sub>)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>vars_B</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8899; (vars ` set_mset B) &#8838; &#119985;&#8250;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>vars_B</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8899; (vars ` set_mset (ran_m A)) &#8838; &#119985;&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtranclp_PAC_Format_subset_ideal</span><span class="delimiter">[</span><span>OF</span><span> </span><span>A<span class="hidden">&#8681;</span><sub>0</sub>B</span><span>  </span><span>vars_A<span class="hidden">&#8681;</span><sub>0</sub></span><span class="delimiter">]</span><span> </span><span>spec<span class="hidden">&#8681;</span><sub>0</sub></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A, B) &#8712; polys_rel&#8250;</span></span></span><span class="delimiter">[</span><span>unfolded</span><span> </span><span>polys_rel_def</span><span class="delimiter">,</span><span> </span><span>simplified</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>in_mono</span><span> </span><span>mem_Collect_eq</span><span> </span><span>restricted_ideal_to_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_successI</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;st&#39; &#8800; FAILED &#10233;
       st&#39; &#8800; FOUND &#10233; st&#39; = SUCCESS&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>st&#39;</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>st&#39;</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>vars_diff_inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;vars (Var x2 - r) = vars (r - Var x2 :: int mpoly)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x2</span><span> </span><span>r</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>vars_uminus</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Var x2 - r&#8250;</span></span></span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span>vars_uminus</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>vars_add_inv</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;vars (Var x2 + r) = vars (r + Var x2 :: int mpoly)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x2</span><span> </span><span>r</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>add.commute</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Var x2&#8250;</span></span></span><span> </span><span>r</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="delimiter">[</span><span>iff</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;a &#8800; FAILED&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;a &#8800; SUCCESS &#10233; a = FOUND&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;merge_status a FOUND = FOUND&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>a</span><span class="delimiter">;</span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span class="delimiter">[</span><span class="delimiter">[</span><span>goals_limit</span><span class="delimiter">=</span><span>1</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>PAC_checker_step_def</span><span> </span><span>PAC_checker_specification_step_spec_def</span><span>
</span><span>      </span><span>normalize_poly_spec_alt_def</span><span> </span><span>check_mult_def</span><span> </span><span>check_add_def</span><span>
</span><span>      </span><span>check_extension_def</span><span> </span><span>polys_rel_full_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>st</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarsimp_all</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x11</span><span> </span><span>x12</span><span> </span><span>x13</span><span> </span><span>x14</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span> </span><span>lhs_step_If</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>r</span><span> </span><span>eqa</span><span> </span><span>st&#39;</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>vars_B</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RETURN_SPEC_refine</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule_tac</span><span> </span><span>x</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(merge_status a st&#39;,&#119985;,add_mset r B)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>exI</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>polys_rel_update_remove</span><span> </span><span>ran_m_mapsto_upd_notin</span><span>
</span><span>          </span><span>intro</span><span class="delimiter">:</span><span> </span><span>PAC_Format_add_and_remove</span><span> </span><span>H2</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>rtranclp_PAC_Format_subset_ideal</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RETURN_SPEC_refine</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>Ex_status_iff</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>rtranclp_PAC_Format_subset_ideal</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x11</span><span> </span><span>x12</span><span> </span><span>x13</span><span> </span><span>x14</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span> </span><span>lhs_step_If</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>r</span><span> </span><span>q</span><span> </span><span>eqa</span><span> </span><span>st&#39;</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>vars_B</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RETURN_SPEC_refine</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule_tac</span><span> </span><span>x</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(merge_status a st&#39;,&#119985;,add_mset r B)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>exI</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>polys_rel_update_remove</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>PAC_Format_add_and_remove</span><span class="delimiter">(</span><span>3</span><span>-</span><span class="delimiter">)</span><span> </span><span>H3</span><span>
</span><span>           </span><span>dest</span><span class="delimiter">:</span><span> </span><span>rtranclp_PAC_Format_subset_ideal</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RETURN_SPEC_refine</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>Ex_status_iff</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x31</span><span> </span><span>x32</span><span> </span><span>x34</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span> </span><span>lhs_step_If</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>r</span><span> </span><span>x</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>vars_B</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RETURN_SPEC_refine</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule_tac</span><span> </span><span>x</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(a,insert x32 &#119985;, add_mset r B)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>exI</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>polys_rel_update_remove</span><span> </span><span>PAC_Format_add_and_remove</span><span class="delimiter">(</span><span>5</span><span>-</span><span class="delimiter">)</span><span>
</span><span>           </span><span>dest</span><span class="delimiter">:</span><span> </span><span>rtranclp_PAC_Format_subset_ideal</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RETURN_SPEC_refine</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>Ex_status_iff</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>x11</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>check_del_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span> </span><span>lhs_step_If</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>eq</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>vars_B</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RETURN_SPEC_refine</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x11 &#8712;# dom_m A&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule_tac</span><span> </span><span>x</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(a,&#119985;, remove1_mset (the (fmlookup A x11)) B)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>exI</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>polys_rel_update_remove</span><span> </span><span>PAC_Format_add_and_remove</span><span>
</span><span>               </span><span>is_failed_def</span><span> </span><span>is_success_def</span><span> </span><span>is_found_def</span><span>
</span><span>            </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>eq_successI</span><span>
</span><span>            </span><span>split</span><span class="delimiter">:</span><span> </span><span>if_splits</span><span>
</span><span>            </span><span>dest</span><span class="delimiter">:</span><span> </span><span>rtranclp_PAC_Format_subset_ideal</span><span>
</span><span>            </span><span>intro</span><span class="delimiter">:</span><span> </span><span>PAC_Format_add_and_remove</span><span> </span><span>H3</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule_tac</span><span> </span><span>x</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(a,&#119985;, B)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>exI</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>fmdrop_irrelevant</span><span>
</span><span>               </span><span>is_failed_def</span><span> </span><span>is_success_def</span><span> </span><span>is_found_def</span><span>
</span><span>            </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>eq_successI</span><span>
</span><span>            </span><span>split</span><span class="delimiter">:</span><span> </span><span>if_splits</span><span>
</span><span>            </span><span>dest</span><span class="delimiter">:</span><span> </span><span>rtranclp_PAC_Format_subset_ideal</span><span>
</span><span>            </span><span>intro</span><span class="delimiter">:</span><span> </span><span>PAC_Format_add_and_remove</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RETURN_SPEC_refine</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>Ex_status_iff</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>PAC_checker</span><span>
</span><span>  </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int_poly &#8658; fpac_step &#8658; status &#8658; (int_poly, nat, nat) pac_step list &#8658;
    (status &#215; fpac_step) nres&#8250;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_checker spec A b st = do {
    (S, _) &#8592; WHILE<span class="hidden">&#8681;</span><sub>T</sub>
       (&#955;((b :: status, A :: fpac_step), st). &#172;is_failed b &#8743; st &#8800; [])
       (&#955;((bA), st). do {
          ASSERT(st &#8800; []);
          S &#8592; PAC_checker_step spec (bA) (hd st);
          RETURN (S, tl st)
        })
      ((b, A), st);
    RETURN S
  }&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>PAC_checker_specification_spec_trans</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;PAC_checker_specification_spec spec A (st, x2) &#10233;
    PAC_checker_specification_step_spec A spec x2 (st&#39;, x1a) &#10233;
    PAC_checker_specification_spec spec A (st&#39;, x1a)&#8250;</span></span></span><span>
</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>PAC_checker_specification_spec_def</span><span>
</span><span>   </span><span>PAC_checker_specification_step_spec_def</span><span>
</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>is_failed_alt_def</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RES_SPEC_eq</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;RES &#934; = SPEC(&#955;P. P &#8712; &#934;)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>is_failed_is_success_completeD</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#172; is_failed x &#10233; &#172;is_success x &#10233; is_found x&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>x</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>PAC_checker_PAC_checker_specification2</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A, B) &#8712;  polys_rel_full &#10233;
    &#172;is_failed a &#10233;
    (a = FOUND &#10233; spec &#8712; pac_ideal (set_mset (snd B))) &#10233;
    &#8899;(vars ` set_mset (ran_m (snd A))) &#8838; fst B &#10233;
    vars spec &#8838; fst B &#10233;
  PAC_checker spec A a st &#8804; &#8659; (status_rel &#215;<span class="hidden">&#8681;</span><sub>r</sub> polys_rel_full) (PAC_checker_specification2 spec B)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>PAC_checker_def</span><span> </span><span>conc_fun_RES</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>RES_SPEC_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span> </span><span>WHILET_rule</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>      </span><span>I</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;((bB), st). bB &#8712; (status_rel &#215;<span class="hidden">&#8681;</span><sub>r</sub> polys_rel_full)&#175; ``
                      Collect (PAC_checker_specification_spec spec B)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>R</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;measure (&#955;(_, st).  Suc (length st))&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>PAC_checker_specification_spec_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>B</span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span>A</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span>polys_rel_def</span><span> </span><span>polys_rel_full_def</span><span> </span><span>Image_iff</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span>
</span><span>     </span><span>PAC_checker_step_PAC_checker_specification2</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;fst B&#8250;</span></span></span><span class="delimiter">,</span><span> </span><span>THEN</span><span> </span><span>order_trans</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>assumption</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>assumption</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>PAC_checker_specification_spec_trans</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>conc_fun_RES</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>PAC_checker_specification_spec_def</span><span> </span><span>polys_rel_full_def</span><span> </span><span>polys_rel_def</span><span>
</span><span>       </span><span>dest</span><span class="delimiter">:</span><span> </span><span>PAC_Format_subset_ideal</span><span>
</span><span>       </span><span>dest</span><span class="delimiter">:</span><span> </span><span>is_failed_is_success_completeD</span><span class="delimiter">;</span><span> </span><span>fail</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>Image_iff</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>PAC_checker_specification_spec_trans</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>PAC_checker_specification_spec_trans</span><span> </span><span>mem_Collect_eq</span><span> </span><span>old.prod.case</span><span>
</span><span>       </span><span>polys_rel_def</span><span> </span><span>polys_rel_full_def</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>remap_polys_polynom_bool</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int mpoly &#8658; nat set &#8658; (nat, int_poly) fmap &#8658; (status &#215; fpac_step) nres&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remap_polys_polynom_bool spec = (&#955;&#119985; A.
   SPEC(&#955;(st, &#119985;&#39;, A&#39;). (&#172;is_failed st &#10230;
      dom_m A = dom_m A&#39; &#8743;
      (&#8704;i &#8712;# dom_m A. the (fmlookup A i) - the (fmlookup A&#39; i) &#8712; ideal polynom_bool) &#8743;
      &#8899;(vars ` set_mset (ran_m A)) &#8838; &#119985;&#39; &#8743;
      &#8899;(vars ` set_mset (ran_m A&#39;)) &#8838; &#119985;&#39;) &#8743;
    (st = FOUND &#10230; spec &#8712;# ran_m A&#39;)))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>remap_polys_change_all</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int mpoly &#8658; nat set &#8658; (nat, int_poly) fmap &#8658; (status &#215; fpac_step) nres&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remap_polys_change_all spec = (&#955;&#119985; A. SPEC (&#955;(st, &#119985;&#39;, A&#39;).
    (&#172;is_failed st &#10230;
      pac_ideal (set_mset (ran_m A)) = pac_ideal (set_mset (ran_m A&#39;)) &#8743;
      &#8899;(vars ` set_mset (ran_m A)) &#8838; &#119985;&#39; &#8743;
      &#8899;(vars ` set_mset (ran_m A&#39;)) &#8838; &#119985;&#39;) &#8743;
    (st = FOUND &#10230; spec &#8712;# ran_m A&#39;)))&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>fmap_eq_dom_iff</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;A = A&#39; &#10231; dom_m A = dom_m A&#39; &#8743; (&#8704;i &#8712;# dom_m A. the (fmlookup A i) = the (fmlookup A&#39; i))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fmap_ext</span><span> </span><span>in_dom_m_lookup_iff</span><span> </span><span>option.collapse</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ideal_remap_incl</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;finite A&#39; &#10233; (&#8704;a&#39;&#8712;A&#39;. &#8707;a&#8712;A. a-a&#39; &#8712; B) &#10233; ideal (A&#39; &#8746; B) &#8838; ideal (A &#8746; B)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>A&#39;</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>finite_induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">:</span><span> </span><span>ideal.span_mono</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ideal.span_mono</span><span> </span><span>sup_ge2</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;a</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>F</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xa</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;a</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;a</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a &#8712; A&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a - x &#8712; B&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xa &#8712; More_Modules.ideal (insert x (F &#8746; B))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;More_Modules.ideal (F &#8746; B) &#8838; More_Modules.ideal (A &#8746; B)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x &#8712; More_Modules.ideal (A &#8746; B)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Un_upper1</span><span> </span><span>Un_upper2</span><span> </span><span>add_diff_cancel_left&#39;</span><span> </span><span>diff_add_cancel</span><span>
</span><span>        </span><span>ideal.module_axioms</span><span> </span><span>ideal.span_diff</span><span> </span><span>in_mono</span><span> </span><span>module.span_superset</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xa &#8712; More_Modules.ideal (A &#8746; B)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>a3</span><span> </span><span>ideal.span_insert_subset</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pac_ideal_remap_eq</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dom_m b = dom_m ba &#10233;
       &#8704;i&#8712;#dom_m ba.
          the (fmlookup b i) - the (fmlookup ba i)
          &#8712; More_Modules.ideal polynom_bool &#10233;
     pac_ideal ((&#955;x. the (fmlookup b x)) ` set_mset (dom_m ba)) = pac_ideal ((&#955;x. the (fmlookup ba x)) ` set_mset (dom_m ba))&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>pac_ideal_alt_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>standard</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ideal_remap_incl</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span>
</span><span>      </span><span>dest</span><span class="delimiter">:</span><span> </span><span>ideal.span_neg</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>ideal.span_neg</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ideal_remap_incl</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>remap_polys_polynom_bool_remap_polys_change_all</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remap_polys_polynom_bool spec &#119985; A &#8804; remap_polys_change_all spec &#119985; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>remap_polys_polynom_bool_def</span><span> </span><span>remap_polys_change_all_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ideal.span_zero</span><span> </span><span>fmap_eq_dom_iff</span><span> </span><span>ideal.span_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>multi_member_split</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>ran_m_def</span><span> </span><span>ideal.span_base</span><span> </span><span>pac_ideal_remap_eq</span><span>
</span><span>    </span><span>add_mset_eq_add_mset</span><span>
</span><span>    </span><span>eq_commute</span><span class="delimiter">[</span><span>of</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;add_mset _ _&#8250;</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;dom_m (A :: (nat, int mpoly)fmap)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>A</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>remap_polys</span><span> </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int mpoly &#8658; nat set &#8658; (nat, int_poly) fmap &#8658; (status &#215; fpac_step) nres&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remap_polys spec = (&#955;&#119985; A. do{
   dom &#8592; SPEC(&#955;dom. set_mset (dom_m A) &#8838; dom &#8743; finite dom);

   failed &#8592; SPEC(&#955;_::bool. True);
   if failed
   then do {
      RETURN (FAILED, &#119985;, fmempty)
   }
   else do {
     (b, N) &#8592; FOREACH dom
       (&#955;i (b, &#119985;, A&#39;).
          if i &#8712;# dom_m A
          then do {
            p &#8592; SPEC(&#955;p. the (fmlookup A i) - p &#8712; ideal polynom_bool &#8743; vars p &#8838; vars (the (fmlookup A i)));
            eq &#8592; SPEC(&#955;eq. eq &#10230; p = spec);
            &#119985; &#8592; SPEC(&#955;&#119985;&#39;. &#119985; &#8746; vars (the (fmlookup A i)) &#8838; &#119985;&#39;);
            RETURN(b &#8744; eq, &#119985;, fmupd i p A&#39;)
          } else RETURN (b, &#119985;, A&#39;))
       (False, &#119985;, fmempty);
       RETURN (if b then FOUND else SUCCESS, N)
     }
   })&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>remap_polys_spec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;remap_polys spec &#119985; A &#8804; remap_polys_polynom_bool spec &#119985; A&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>remap_polys_def</span><span> </span><span>remap_polys_polynom_bool_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span> </span><span>FOREACH_rule</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>I</span><span> </span><span class="delimiter">=</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#955;dom (b, &#119985;, A&#39;).
      set_mset (dom_m A&#39;) =  set_mset (dom_m A) - dom &#8743;
      (&#8704;i &#8712; set_mset (dom_m A) - dom. the (fmlookup A i) - the (fmlookup A&#39; i) &#8712; ideal polynom_bool) &#8743;
     &#8899;(vars ` set_mset (ran_m (fmrestrict_set (set_mset (dom_m A&#39;)) A))) &#8838; &#119985; &#8743;
     &#8899;(vars ` set_mset (ran_m A&#39;)) &#8838; &#119985; &#8743;
      (b &#10230; spec &#8712;# ran_m A&#39;)&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ideal.span_add</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>clarsimp</span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span><span class="delimiter">[</span><span class="delimiter">[</span><span>goals_limit</span><span class="delimiter">=</span><span>1</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ran_m_mapsto_upd_notin</span><span> </span><span>dom_m_fmrestrict_set&#39;</span><span> </span><span>subset_eq</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span><span class="delimiter">[</span><span class="delimiter">[</span><span>goals_limit</span><span class="delimiter">=</span><span>1</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ran_m_mapsto_upd_notin</span><span> </span><span>dom_m_fmrestrict_set&#39;</span><span> </span><span>subset_eq</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>ran_m_mapsto_upd_notin</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ran_m_mapsto_upd_notin</span><span> </span><span>dom_m_fmrestrict_set&#39;</span><span> </span><span>subset_eq</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ran_m_mapsto_upd_notin</span><span> </span><span>dom_m_fmrestrict_set&#39;</span><span> </span><span>subset_eq</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>distinct_set_mset_eq_iff</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>distinct_mset_dom</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>distinct_set_mset_eq_iff</span><span class="delimiter">[</span><span>symmetric</span><span class="delimiter">]</span><span> </span><span>distinct_mset_dom</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ran_m_mapsto_upd_notin</span><span> </span><span>dom_m_fmrestrict_set&#39;</span><span> </span><span>subset_eq</span><span>
</span><span>       </span><span>fmlookup_restrict_set_id&#39;</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ran_m_mapsto_upd_notin</span><span> </span><span>dom_m_fmrestrict_set&#39;</span><span> </span><span>subset_eq</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ran_m_mapsto_upd_notin</span><span> </span><span>dom_m_fmrestrict_set&#39;</span><span> </span><span>subset_eq</span><span>
</span><span>       </span><span>fmlookup_restrict_set_id&#39;</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Full Checker&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>full_checker</span><span>
</span><span>  </span><span class="delimiter">::</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;int_poly &#8658; (nat, int_poly) fmap &#8658; (int_poly, nat,nat) pac_step list &#8658; (status &#215; _) nres&#8250;</span></span></span><span>
</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full_checker spec0 A pac = do {
     spec &#8592; normalize_poly_spec spec0;
     (st, &#119985;, A) &#8592; remap_polys_change_all spec {} A;
     if is_failed st then
     RETURN (st, &#119985;, A)
     else do {
       &#119985; &#8592; SPEC(&#955;&#119985;&#39;. &#119985; &#8746; vars spec0 &#8838; &#119985;&#39;);
       PAC_checker spec (&#119985;, A) st pac
    }
}&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>restricted_ideal_to_mono</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;restricted_ideal_to<span class="hidden">&#8681;</span><sub>I</sub> &#119985; I &#8838; restricted_ideal_to<span class="hidden">&#8681;</span><sub>I</sub> &#119985;&#39; J &#10233;
  &#119984; &#8838; &#119985; &#10233;
   restricted_ideal_to<span class="hidden">&#8681;</span><sub>I</sub> &#119984; I &#8838; restricted_ideal_to<span class="hidden">&#8681;</span><sub>I</sub> &#119984;  J&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>restricted_ideal_to_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>full_checker_spec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(A, A&#39;) &#8712; polys_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>      </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;full_checker spec A pac &#8804; &#8659;{((st, G), (st&#39;, G&#39;)). (st, st&#39;) &#8712; status_rel &#8743;
           (st &#8800; FAILED &#10230; (G, G&#39;) &#8712; polys_rel_full)}
        (PAC_checker_specification spec (A&#39;))&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>H</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;set_mset b &#8838; pac_ideal (set_mset (ran_m A)) &#10233;
       x &#8712; pac_ideal (set_mset b) &#10233; x &#8712; pac_ideal (set_mset A&#39;)&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>b</span><span> </span><span>x</span><span>
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>polys_rel_def</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>ideal.span_subset_spanI</span><span> </span><span>ideal.span_superset</span><span> </span><span>le_sup_iff</span><span> </span><span>pac_ideal_alt_def</span><span> </span><span>subsetD</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; {(st, &#119985;&#39;, A&#39;).
          ( &#172; is_failed st &#10230; pac_ideal (set_mset (ran_m x2)) =
              pac_ideal (set_mset (ran_m A&#39;)) &#8743;
              &#8899; (vars ` set_mset (ran_m ABC)) &#8838; &#119985;&#39; &#8743;
              &#8899; (vars ` set_mset (ran_m A&#39;)) &#8838; &#119985;&#39;) &#8743; 
            (st = FOUND &#10230; speca &#8712;# ran_m A&#39;)} &#10233;
         x = (st, x&#39;) &#10233; x&#39; = (&#119985;, Aa) &#10233;((&#119985;&#39;, Aa), &#119985;&#39;, ran_m Aa) &#8712; polys_rel_full&#8250;</span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>Aa</span><span> </span><span>speca</span><span> </span><span>x2</span><span> </span><span>st</span><span> </span><span>x</span><span> </span><span>&#119985;&#39;</span><span> </span><span>&#119985;</span><span> </span><span>x&#39;</span><span> </span><span>ABC</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>polys_rel_def</span><span> </span><span>polys_rel_full_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span><span class="delimiter">[</span><span class="delimiter">[</span><span>goals_limit</span><span class="delimiter">=</span><span>1</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>full_checker_def</span><span> </span><span>normalize_poly_spec_def</span><span>
</span><span>      </span><span>PAC_checker_specification_def</span><span> </span><span>remap_polys_change_all_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>refine_vcg</span><span> </span><span>PAC_checker_PAC_checker_specification2</span><span class="delimiter">[</span><span>THEN</span><span> </span><span>order_trans</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span class="delimiter">]</span><span>
</span><span>      </span><span>lhs_step_If</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>is_failed_def</span><span> </span><span>RETURN_RES_refine_iff</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>1</span><span class="delimiter">;</span><span> </span><span>assumption</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fmap_ext</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span class="delimiter">:</span><span> </span><span>polys_rel_def</span><span> </span><span>ran_m_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span><span> </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>speca</span><span> </span><span>x1</span><span> </span><span>x2</span><span> </span><span>x</span><span> </span><span>x1a</span><span> </span><span>x2a</span><span> </span><span>x1b</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ref_two_step</span><span class="delimiter">[</span><span>OF</span><span> </span><span>conc_fun_R_mono</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>PAC_checker_specification_spec_def</span><span> </span><span>conc_fun_RES</span><span> </span><span>polys_rel_def</span><span> </span><span>polys_rel_full_def</span><span>
</span><span>        </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>rtranclp_PAC_Format_subset_ideal</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>is_failed_is_success_completeD</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>restricted_ideal_to_mono</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8899; (vars ` set_mset (ran_m A)) &#8746; vars spec&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>group_eq_aux</span><span> </span><span>ideal.span_add</span><span> </span><span>ideal.span_base</span><span> </span><span>in_mono</span><span> </span><span>pac_ideal_alt_def</span><span> </span><span>sup.cobounded2</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>le_sup_iff</span><span> </span><span>restricted_ideal_to_mono</span><span> </span><span>subsetD</span><span> </span><span>subset_trans</span><span> </span><span>sup_ge1</span><span> </span><span>sup_ge2</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>cancel_comm_monoid_add_class.diff_cancel</span><span> </span><span>diff_add_eq</span><span>
</span><span>        </span><span>diff_in_polynom_bool_pac_idealI</span><span> </span><span>group_eq_aux</span><span> </span><span>ideal.span_add_eq2</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>restricted_ideal_to_mono</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8899; (vars ` set_mset (ran_m A)) &#8746; vars spec&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>le_sup_iff</span><span> </span><span>restricted_ideal_to_mono</span><span> </span><span>subsetD</span><span> </span><span>subset_trans</span><span> </span><span>sup_ge1</span><span> </span><span>sup_ge2</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>restricted_ideal_to_mono</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8899; (vars ` set_mset (ran_m A)) &#8746; vars spec&#8250;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>group_eq_aux</span><span> </span><span>ideal.span_add</span><span> </span><span>ideal.span_base</span><span> </span><span>in_mono</span><span> </span><span>pac_ideal_alt_def</span><span> </span><span>sup.cobounded2</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>le_sup_iff</span><span> </span><span>restricted_ideal_to_mono</span><span> </span><span>subsetD</span><span> </span><span>subset_trans</span><span> </span><span>sup_ge1</span><span> </span><span>sup_ge2</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>group_eq_aux</span><span> </span><span>ideal.span_add</span><span> </span><span>ideal.span_base</span><span> </span><span>in_mono</span><span> </span><span>pac_ideal_alt_def</span><span> </span><span>sup.cobounded2</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>full_checker_spec&#39;</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(uncurry2 full_checker, uncurry2 (&#955;spec A _. PAC_checker_specification spec A)) &#8712;
       (Id &#215;<span class="hidden">&#8681;</span><sub>r</sub> polys_rel) &#215;<span class="hidden">&#8681;</span><sub>r</sub> Id &#8594;<span class="hidden">&#8681;</span><sub>f</sub> &#10216;{((st, G), (st&#39;, G&#39;)). (st, st&#39;) &#8712; status_rel &#8743;
           (st &#8800; FAILED &#10230; (G, G&#39;) &#8712; polys_rel_full)}&#10217;nres_rel&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>full_checker_spec</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>intro</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>frefI</span><span> </span><span>nres_relI</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span></pre>

</div>
</body>
</html>
